<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Pythonçˆ¬è™«å­¦ä¹ ç¬”è®° | é˜³å…‰å°é¥ºå­çš„ç©ºé—´</title><meta name="author" content="å¯çˆ±çš„Wyang"><meta name="copyright" content="å¯çˆ±çš„Wyang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Pythonçˆ¬è™«">
<meta property="og:type" content="article">
<meta property="og:title" content="Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°">
<meta property="og:url" content="https://ysnsn.github.io/python-spider.html">
<meta property="og:site_name" content="é˜³å…‰å°é¥ºå­çš„ç©ºé—´">
<meta property="og:description" content="Pythonçˆ¬è™«">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg">
<meta property="article:published_time" content="2021-07-24T05:13:54.000Z">
<meta property="article:modified_time" content="2021-07-24T08:28:20.000Z">
<meta property="article:author" content="å¯çˆ±çš„Wyang">
<meta property="article:tag" content="æ•™ç¨‹">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°",
  "url": "https://ysnsn.github.io/python-spider.html",
  "image": "https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg",
  "datePublished": "2021-07-24T05:13:54.000Z",
  "dateModified": "2021-07-24T08:28:20.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "å¯çˆ±çš„Wyang",
      "url": "https://Ysnsn.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ysnsn.github.io/python-spider.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç°¡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/mikutap/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-cocktail"></i><span> å“”å“©å“”å“©</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-inbox"></i><span> åŸºåœ°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ysnsn.herokuapp.com/"><i class="fa-fw fas fa-cloud-download-alt"></i><span> ç½‘ç›˜OM</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://tc.Ysnsn.github.io/"><i class="fa-fw fas fa-paper-plane"></i><span> ç«‹å³å‰å¾€</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://zz.Ysnsn.github.io/"><i class="fa-fw fas fa-feather"></i><span> Donate</span></a></li><li><a class="site-page child" href="/sitemap.xml"><i class="fa-fw fas fa-map-marked-alt"></i><span> sitemap</span></a></li><li><a class="site-page child" href="/baidusitemap.xml"><i class="fa-fw fas fa-map-marker-alt"></i><span> baidusitemap</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-gavel"></i><span> å°åº”ç”¨</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/silk%20/silk/"><i class="fa-fw fas fa-signature"></i><span> ä¸ç”»</span></a></li><li><a class="site-page child" href="/caidie/"><i class="fa-fw fas fa-bug"></i><span> å½©è¶</span></a></li><li><a class="site-page child" href="/%E6%B6%B2%E4%BD%93/"><i class="fa-fw fas fa-bullseye"></i><span> æ¶²ä½“</span></a></li><li><a class="site-page child" href="/smail/"><i class="fa-fw fas fa-democrat"></i><span> ç¬‘è„¸æ»‘ç¨½</span></a></li><li><a class="site-page child" href="/dog/"><i class="fa-fw fas fa-dog"></i><span> å°ç‹—</span></a></li><li><a class="site-page child" href="/dudu/"><i class="fa-fw fas fa-heart"></i><span> æœæœ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> èœå•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/sc/"><i class="fa-fw fas fa-key"></i><span> æ¯æ—¥è¯—è¯</span></a></li><li><a class="site-page child" href="/wysp/"><i class="fa-fw fas fa-fire"></i><span> ç½‘æ˜“çƒ­è¯„</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">é˜³å…‰å°é¥ºå­çš„ç©ºé—´</span></a><a class="nav-page-title" href="/"><span class="site-name">Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/mikutap/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-cocktail"></i><span> å“”å“©å“”å“©</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-inbox"></i><span> åŸºåœ°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://ysnsn.herokuapp.com/"><i class="fa-fw fas fa-cloud-download-alt"></i><span> ç½‘ç›˜OM</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://tc.Ysnsn.github.io/"><i class="fa-fw fas fa-paper-plane"></i><span> ç«‹å³å‰å¾€</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="http://zz.Ysnsn.github.io/"><i class="fa-fw fas fa-feather"></i><span> Donate</span></a></li><li><a class="site-page child" href="/sitemap.xml"><i class="fa-fw fas fa-map-marked-alt"></i><span> sitemap</span></a></li><li><a class="site-page child" href="/baidusitemap.xml"><i class="fa-fw fas fa-map-marker-alt"></i><span> baidusitemap</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-gavel"></i><span> å°åº”ç”¨</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/silk%20/silk/"><i class="fa-fw fas fa-signature"></i><span> ä¸ç”»</span></a></li><li><a class="site-page child" href="/caidie/"><i class="fa-fw fas fa-bug"></i><span> å½©è¶</span></a></li><li><a class="site-page child" href="/%E6%B6%B2%E4%BD%93/"><i class="fa-fw fas fa-bullseye"></i><span> æ¶²ä½“</span></a></li><li><a class="site-page child" href="/smail/"><i class="fa-fw fas fa-democrat"></i><span> ç¬‘è„¸æ»‘ç¨½</span></a></li><li><a class="site-page child" href="/dog/"><i class="fa-fw fas fa-dog"></i><span> å°ç‹—</span></a></li><li><a class="site-page child" href="/dudu/"><i class="fa-fw fas fa-heart"></i><span> æœæœ</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> èœå•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera"></i><span> ç›¸å†Œ</span></a></li><li><a class="site-page child" href="/sc/"><i class="fa-fw fas fa-key"></i><span> æ¯æ—¥è¯—è¯</span></a></li><li><a class="site-page child" href="/wysp/"><i class="fa-fw fas fa-fire"></i><span> ç½‘æ˜“çƒ­è¯„</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-07-24T05:13:54.000Z" title="å‘è¡¨äº 2021-07-24 13:13:54">2021-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-07-24T08:28:20.000Z" title="æ›´æ–°äº 2021-07-24 16:28:20">2021-07-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%A3%9F%E7%94%A8%E6%95%99%E7%A8%8B/">é£Ÿç”¨æ•™ç¨‹</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2021-07-24 16:28:20&quot;}" hidden></div><blockquote>
<blockquote>
<p>çœŸä¸æˆ³ï¼ï¼ï¼ğŸ™„</p>
</blockquote>
</blockquote>
<blockquote>
<p>ZY.Zhang</p>
<p>æœ¬æ–‡æ¡£åŸºäº<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yh411o7Sz?p=1">Bç«™è§†é¢‘æ•™ç¨‹</a></p>
</blockquote>
<h1 id="ä¸€ã€çˆ¬è™«åŸºç¡€ç®€ä»‹"><a href="#ä¸€ã€çˆ¬è™«åŸºç¡€ç®€ä»‹" class="headerlink" title="ä¸€ã€çˆ¬è™«åŸºç¡€ç®€ä»‹"></a>ä¸€ã€çˆ¬è™«åŸºç¡€ç®€ä»‹</h1><h2 id="1-çˆ¬è™«ç®€ä»‹"><a href="#1-çˆ¬è™«ç®€ä»‹" class="headerlink" title="1. çˆ¬è™«ç®€ä»‹"></a>1. çˆ¬è™«ç®€ä»‹</h2><p><strong>ä»€ä¹ˆæ˜¯çˆ¬è™«ï¼š</strong>é€šè¿‡ç¼–å†™ç¨‹åºï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨ä¸Šç½‘ï¼Œç„¶åè®©å…¶å»äº’è”ç½‘ä¸ŠæŠ“å–æ•°æ®çš„è¿‡ç¨‹ã€‚</p>
<h2 id="2-çˆ¬è™«åˆæ³•æ€§æ¢ç©¶"><a href="#2-çˆ¬è™«åˆæ³•æ€§æ¢ç©¶" class="headerlink" title="2. çˆ¬è™«åˆæ³•æ€§æ¢ç©¶"></a>2. çˆ¬è™«åˆæ³•æ€§æ¢ç©¶</h2><p><strong>çˆ¬è™«ç©¶ç«Ÿæ˜¯åˆæ³•è¿˜æ˜¯è¿æ³•çš„ï¼Ÿ</strong></p>
<ul>
<li>åœ¨æ³•å¾‹ä¸­æ˜¯ä¸è¢«ç¦æ­¢çš„</li>
<li>å…·æœ‰è¿æ³•é£é™©</li>
<li>å–„æ„çˆ¬è™« &amp; æ¶æ„çˆ¬è™«</li>
</ul>
<p><strong>çˆ¬è™«å¸¦æ¥çš„é£é™©å¯ä»¥ä½“ç°åœ¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</strong></p>
<ol>
<li>çˆ¬è™«å¹²æ‰°äº†è¢«è®¿é—®ç½‘ç«™çš„æ­£å¸¸è¿è¥</li>
<li>çˆ¬è™«æŠ“å–äº†å—åˆ°æ³•å¾‹ä¿æŠ¤çš„ç‰¹å®šç±»å‹çš„æ•°æ®æˆ–ä¿¡æ¯</li>
</ol>
<p><strong>å¦‚ä½•åœ¨ç¼–å†™ä½¿ç”¨çš„è¿‡ç¨‹ä¸­é¿å…è¿›å…¥å±€å­çš„å„è¿ï¼Ÿ</strong></p>
<ul>
<li>æ—¶å¸¸ä¼˜åŒ–è‡ªå·±çš„ç¨‹åºï¼Œé¿å…å¹²æ‰°è¢«è®¿é—®ç½‘ç«™çš„æ­£å¸¸è¿è¡Œ</li>
<li>åœ¨ä½¿ç”¨ï¼Œä¼ æ’­çˆ¬å–åˆ°çš„æ•°æ®æ—¶ï¼Œå®¡æŸ¥æŠ“å–åˆ°çš„å†…å®¹ï¼Œå¦‚æœå‘ç°äº†æ¶‰åŠåˆ°ç”¨æˆ·éšç§æˆ–è€…å•†ä¸šæœºå¯†ç­‰æ•æ„Ÿå†…å®¹ï¼Œéœ€è¦åŠæ—¶åœæ­¢çˆ¬å–æˆ–è€…ä¼ æ’­ã€‚</li>
</ul>
<h2 id="3-çˆ¬è™«åˆè¯•æ·±å…¥"><a href="#3-çˆ¬è™«åˆè¯•æ·±å…¥" class="headerlink" title="3. çˆ¬è™«åˆè¯•æ·±å…¥"></a>3. çˆ¬è™«åˆè¯•æ·±å…¥</h2><p><strong>çˆ¬è™«åœ¨ä½¿ç”¨åœºæ™¯ä¸­çš„åˆ†ç±»ï¼š</strong></p>
<ul>
<li><p><strong>é€šç”¨çˆ¬è™«ï¼š</strong>æŠ“å–ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æŠ“å–çš„æ˜¯ä¸€æ•´å¼ é¡µé¢æ•°æ®ã€‚</p>
</li>
<li><p><strong>èšç„¦çˆ¬è™«ï¼š</strong>æ˜¯å»ºç«‹åœ¨é€šç”¨çˆ¬è™«çš„åŸºç¡€ä¹‹ä¸Šã€‚æŠ“å–çš„æ˜¯é¡µé¢ä¸­ç‰¹å®šçš„å±€éƒ¨å†…å®¹ã€‚</p>
</li>
<li><p><strong>å¢é‡å¼çˆ¬è™«ï¼š</strong>ç›‘æµ‹ç½‘ç«™ä¸­æ•°æ®æ›´æ–°çš„æƒ…å†µã€‚åªä¼šæŠ“å–ç½‘ç«™ä¸­æœ€æ–°æ›´æ–°å‡ºæ¥çš„æ•°æ®ã€‚</p>
</li>
</ul>
<p><strong>çˆ¬è™«çš„çŸ›ä¸ç›¾ï¼š</strong></p>
<ul>
<li><p><strong>åçˆ¬æœºåˆ¶ï¼š</strong>é—¨æˆ·ç½‘ç«™ï¼Œå¯ä»¥é€šè¿‡åˆ¶å®šç›¸åº”çš„ç­–ç•¥æˆ–è€…æŠ€æœ¯æ‰‹æ®µï¼Œé˜²æ­¢çˆ¬è™«ç¨‹åºè¿›è¡Œç½‘ç«™æ•°æ®çš„çˆ¬å–ã€‚</p>
</li>
<li><p><strong>ååçˆ¬ç­–ç•¥ï¼š</strong>çˆ¬è™«ç¨‹åºï¼Œå¯ä»¥é€šè¿‡åˆ¶å®šç›¸å…³çš„ç­–ç•¥æˆ–è€…æŠ€æœ¯æ‰‹æ®µï¼Œç ´è§£é—¨æˆ·ç½‘ç«™ä¸­å…·å¤‡çš„åçˆ¬æœºåˆ¶ï¼Œä»è€Œå¯ä»¥è·å–é—¨æˆ·ç½‘ç«™ä¸­ç›¸å…³çš„æ•°æ®ã€‚</p>
</li>
</ul>
<p><strong>robots.txtåè®®ï¼š</strong>å›å­åè®®ã€‚è§„å®šäº†ç½‘ç«™ä¸­é‚£äº›æ•°æ®å¯ä»¥è¢«çˆ¬è™«çˆ¬å–ï¼Œé‚£äº›æ•°æ®ä¸å…è®¸è¢«çˆ¬å–ã€‚</p>
<p>ä¾‹å¦‚ï¼š<a target="_blank" rel="noopener" href="https://www.tabao.com/robots.txt">www.tabao.com/robots.txt</a></p>
<h2 id="4-http-amp-httpsåè®®"><a href="#4-http-amp-httpsåè®®" class="headerlink" title="4. http&amp;httpsåè®®"></a>4. http&amp;httpsåè®®</h2><h3 id="ï¼ˆ1ï¼‰httpåè®®"><a href="#ï¼ˆ1ï¼‰httpåè®®" class="headerlink" title="ï¼ˆ1ï¼‰httpåè®®"></a>ï¼ˆ1ï¼‰httpåè®®</h3><p><strong>æ¦‚å¿µï¼š</strong>å°±æ˜¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯è¿›è¡Œæ•°æ®äº¤äº’çš„ä¸€ç§å½¢å¼ã€‚</p>
<p><strong>å¸¸ç”¨è¯·æ±‚å¤´ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>User-Agentï¼š</strong>è¯·æ±‚è½½ä½“çš„èº«ä»½æ ‡è¯†</li>
<li><strong>Connectionï¼š</strong>è¯·æ±‚å®Œæ¯•åï¼Œæ˜¯æ–­å¼€è¿æ¥è¿˜æ˜¯ä¿æŒè¿æ¥</li>
</ul>
<p><strong>å¸¸ç”¨å“åº”å¤´ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>Content-Typeï¼š</strong>æœåŠ¡å™¨å“åº”å›å®¢æˆ·ç«¯çš„æ•°æ®ç±»å‹</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰httpsåè®®"><a href="#ï¼ˆ2ï¼‰httpsåè®®" class="headerlink" title="ï¼ˆ2ï¼‰httpsåè®®"></a>ï¼ˆ2ï¼‰httpsåè®®</h3><p><strong>æ¦‚å¿µï¼š</strong>å®‰å…¨çš„è¶…æ–‡æœ¬ä¼ è¾“åè®®</p>
<h3 id="ï¼ˆ3ï¼‰åŠ å¯†æ–¹å¼"><a href="#ï¼ˆ3ï¼‰åŠ å¯†æ–¹å¼" class="headerlink" title="ï¼ˆ3ï¼‰åŠ å¯†æ–¹å¼"></a>ï¼ˆ3ï¼‰åŠ å¯†æ–¹å¼</h3><ul>
<li><p><strong>å¯¹ç§°ç§˜é’¥åŠ å¯†</strong></p>
<p>  <img src="/../PythonProjects/Typora_image/image-20210224142616421.png" alt="image-20210224142616421"></p>
</li>
<li><p><strong>éå¯¹ç§°ç§˜é’¥åŠ å¯†</strong></p>
<p>  å­˜åœ¨ç¼ºç‚¹ï¼šç¬¬ä¸€ä¸ªæ˜¯å¦‚ä½•ä¿è¯æ¥æ”¶ç«¯å‘å‘é€ç«¯å‘å‡ºå…¬å¼€ç§˜é’¥çš„æ—¶å€™ï¼Œå‘é€ç«¯ç¡®ä¿æ”¶åˆ°çš„æ˜¯é¢„å…ˆè¦å‘é€çš„ï¼Œè€Œä¸ä¼šè¢«æŒŸæŒï¼Œåªè¦æ˜¯å‘é€ç§˜é’¥ï¼Œå°±æœ‰å¯èƒ½æœ‰è¢«æŒŸæŒçš„é£é™©ï¼›ç¬¬äºŒä¸ªæ˜¯éå¯¹ç§°ç§˜é’¥åŠ å¯†æ–¹å¼æ•ˆç‡æ¯”è¾ƒä½ï¼Œå¤„ç†èµ·æ¥æ›´ä¸ºå¤æ‚ï¼Œé€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨å°±æœ‰ä¸€å®šçš„æ•ˆç‡é—®é¢˜è€Œå½±å“é€šä¿¡é€Ÿåº¦ã€‚</p>
<p>  <img src="/../PythonProjects/Typora_image/image-20210224142728145.png" alt="image-20210224142728145"></p>
</li>
<li><p><strong>è¯ä¹¦ç§˜é’¥åŠ å¯†ï¼š</strong></p>
<ul>
<li>æœåŠ¡å™¨çš„å¼€å‘è€…æºå¸¦å…¬å¼€å¯†é’¥ï¼Œå‘æ•°å­—è¯ä¹¦è®¤è¯æœºæ„æå‡ºå…¬å¼€å¯†é’¥çš„ç”³è¯·ï¼Œæ•°å­—è¯ä¹¦è®¤è¯æœºæ„åœ¨è®¤æ¸…ç”³è¯·è€…çš„èº«ä»½å®¡æ ¸é€šè¿‡ä»¥åï¼Œä¼šå¯¹å¼€å‘è€…ç”³è¯·çš„å…¬å¼€å¯†é’¥åšæ•°å­—ç­¾åï¼Œç„¶ååˆ†é…è¿™ä¸ªå·²ç­¾åçš„å…¬å¼€å¯†é’¥ï¼Œå¹¶å°†å¯†é’¥æ”¾åœ¨è¯ä¹¦é‡Œé¢ï¼Œç»‘å®šåœ¨ä¸€èµ·ï¼›</li>
<li>æœåŠ¡å™¨å°†è¿™ä»½æ•°å­—è¯ä¹¦å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¹Ÿè®¤å¯è¯ä¹¦æœºæ„ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡æ•°å­—è¯ä¹¦ä¸­çš„æ•°å­—ç­¾åæ¥éªŒè¯å…¬é’¥çš„çœŸä¼ªï¼Œæ¥ç¡®ä¿æœåŠ¡å™¨ä¼ è¿‡æ¥çš„å…¬å¼€å¯†é’¥æ˜¯çœŸå®çš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯ä¹¦çš„æ•°å­—ç­¾åæ˜¯å¾ˆéš¾è¢«ä¼ªé€ çš„ï¼Œè¿™å–å†³äºè®¤è¯æœºæ„çš„å…¬ä¿¡åŠ›ã€‚ä¸€æ—¦ç¡®è®¤ä¿¡æ¯æ— è¯¯ä¹‹åï¼Œå®¢æˆ·ç«¯å°±ä¼šé€šè¿‡å…¬é’¥å¯¹æŠ¥æ–‡è¿›è¡ŒåŠ å¯†å‘é€ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°ä»¥åç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ã€‚</li>
</ul>
<p>  <img src="/../PythonProjects/Typora_image/image-20210224143442798.png" alt="image-20210224143442798"></p>
</li>
</ul>
<hr>
<h1 id="äºŒã€requestsæ¨¡å—åŸºç¡€"><a href="#äºŒã€requestsæ¨¡å—åŸºç¡€" class="headerlink" title="äºŒã€requestsæ¨¡å—åŸºç¡€"></a>äºŒã€requestsæ¨¡å—åŸºç¡€</h1><h2 id="1-requestsç¬¬ä¸€è¡€"><a href="#1-requestsç¬¬ä¸€è¡€" class="headerlink" title="1. requestsç¬¬ä¸€è¡€"></a>1. requestsç¬¬ä¸€è¡€</h2><p><strong>requestsæ¨¡å—ï¼š</strong>Pythonä¸­åŸç”Ÿçš„ä¸€æ¬¾åŸºäºç½‘ç»œè¯·æ±‚çš„æ¨¡å—ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œç®€å•ä¾¿æ·ï¼Œæ•ˆç‡æé«˜ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong>æ¨¡æ‹Ÿæµè§ˆå™¨å‘è¯·æ±‚ã€‚</p>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼šï¼ˆrequestsæ¨¡å—çš„ç¼–ç æµç¨‹ï¼‰</strong></p>
<ul>
<li>æŒ‡å®š url</li>
<li>å‘èµ·è¯·æ±‚</li>
<li>è·å–å“åº”æ•°æ®</li>
<li>æŒä¹…åŒ–å­˜å‚¨</li>
</ul>
<p><strong>ç¯å¢ƒçš„å®‰è£…ï¼š</strong><code>pip install requests</code></p>
<p><strong>å®æˆ˜ç¼–ç ï¼š</strong></p>
<ul>
<li>éœ€æ±‚ï¼šçˆ¬å–æœç‹—é¦–é¡µçš„æ•°æ®</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#step1 æŒ‡å®šurl</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.sogou.com/&#x27;</span></span><br><span class="line">    <span class="comment">#step2 å‘èµ·è¯·æ±‚</span></span><br><span class="line">    <span class="comment">#getæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå“åº”å¯¹è±¡</span></span><br><span class="line">    response = requests.get(url = url)</span><br><span class="line">    <span class="comment">#step3 è·å–å“åº”æ•°æ®ï¼Œtextè¿”å›çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®</span></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="built_in">print</span>(page_text)</span><br><span class="line">    <span class="comment">#step4 æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./sogou.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding = <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;çˆ¬å–æ•°æ®ç»“æŸï¼&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-requestså·©å›ºæ·±å…¥æ¡ˆä¾‹ä»‹ç»"><a href="#2-requestså·©å›ºæ·±å…¥æ¡ˆä¾‹ä»‹ç»" class="headerlink" title="2. requestså·©å›ºæ·±å…¥æ¡ˆä¾‹ä»‹ç»"></a>2. requestså·©å›ºæ·±å…¥æ¡ˆä¾‹ä»‹ç»</h2><h3 id="ï¼ˆ1ï¼‰ç®€æ˜“ç½‘é¡µé‡‡é›†å™¨"><a href="#ï¼ˆ1ï¼‰ç®€æ˜“ç½‘é¡µé‡‡é›†å™¨" class="headerlink" title="ï¼ˆ1ï¼‰ç®€æ˜“ç½‘é¡µé‡‡é›†å™¨"></a>ï¼ˆ1ï¼‰ç®€æ˜“ç½‘é¡µé‡‡é›†å™¨</h3><ul>
<li>UAæ£€æµ‹</li>
<li>UAä¼ªè£…</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#UAï¼šUser-Agentè¯·æ±‚è½½ä½“çš„èº«ä»½æ ‡è¯†</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;UAæ£€æµ‹ï¼šé—¨æˆ·ç½‘ç«™çš„æœåŠ¡å™¨ä¼šç›‘æµ‹å¯¹åº”è¯·æ±‚çš„è½½ä½“èº«ä»½æ ‡è¯†ï¼Œ</span></span><br><span class="line"><span class="string">å¦‚æœæ£€æµ‹åˆ°è¯·æ±‚è½½ä½“èº«ä»½æ ‡è¯†æ˜¯æŸä¸€æ¬¾æµè§ˆå™¨,è¯´æ˜è¯¥è¯·æ±‚æ—¶ä¸€ä¸ªæ­£å¸¸çš„è¯·æ±‚ï¼›</span></span><br><span class="line"><span class="string">ä½†æ˜¯ï¼Œå¦‚æœæ£€æµ‹åˆ°è¯·æ±‚çš„è½½ä½“èº«ä»½ä¸æ˜¯åŸºäºæŸä¸€æ¬¾æµè§ˆå™¨çš„ï¼Œåˆ™è¡¨ç¤ºè¯¥è¯·æ±‚ä¸ºä¸æ­£å¸¸è¯·æ±‚ï¼ˆçˆ¬è™«ï¼‰,</span></span><br><span class="line"><span class="string">åˆ™æœåŠ¡å™¨å¾ˆæœ‰å¯èƒ½æ‹’ç»è¯¥æ¬¡è¯·æ±‚&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#UAä¼ªè£…ï¼šè®©çˆ¬è™«å¯¹åº”çš„è¯·æ±‚è½½ä½“èº«ä»½æ ‡è¯†ä¼ªè£…æˆæŸä¸€æ¬¾æµè§ˆå™¨ï¼Œèº²è¿‡UAæ£€æµ‹</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#UAä¼ªè£…ï¼šå°†å¯¹åº”çš„User-Agentå°è£…åˆ°ä¸€ä¸ªå­—å…¸ä¸­</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#step1 æŒ‡å®šurl query</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.sogou.com/web&#x27;</span></span><br><span class="line">    <span class="comment">#å¤„ç†urlæºå¸¦çš„å‚æ•° å°è£…åˆ°å­—å…¸ä¸­</span></span><br><span class="line">    kw = <span class="built_in">input</span>(<span class="string">&#x27;Enter a word:&#x27;</span>)</span><br><span class="line">    param =&#123;</span><br><span class="line">        <span class="string">&#x27;query&#x27;</span>:kw</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#step2 å¯¹æŒ‡å®šçš„urlå‘èµ·è¯·æ±‚ï¼Œå¯¹åº”çš„urlæ˜¯æºå¸¦å‚æ•°çš„ï¼Œå¹¶ä¸”å¤„ç†è¿‡ç¨‹ä¸­å¤„ç†äº†å‚æ•°</span></span><br><span class="line">    response = requests.get(url = url,params = param,headers = headers)</span><br><span class="line">    <span class="comment">#step3</span></span><br><span class="line">    page_text = response.text</span><br><span class="line">    <span class="comment">#step4</span></span><br><span class="line">    fileName = kw + <span class="string">&#x27;.html&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(fileName,<span class="string">&#x27;w&#x27;</span>,encoding =<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(page_text)</span><br><span class="line">    <span class="built_in">print</span>(fileName,<span class="string">&#x27;ä¿å­˜æˆåŠŸï¼ï¼&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ2ï¼‰ç ´è§£ç™¾åº¦ç¿»è¯‘"><a href="#ï¼ˆ2ï¼‰ç ´è§£ç™¾åº¦ç¿»è¯‘" class="headerlink" title="ï¼ˆ2ï¼‰ç ´è§£ç™¾åº¦ç¿»è¯‘"></a>ï¼ˆ2ï¼‰ç ´è§£ç™¾åº¦ç¿»è¯‘</h3><ul>
<li>postè¯·æ±‚ï¼ˆæºå¸¦äº†å‚æ•°ï¼‰</li>
<li>å“åº”æ•°æ®æ˜¯ä¸€ç»„jsonæ•°æ®</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#step1 æŒ‡å®šURL</span></span><br><span class="line">    post_url = <span class="string">&#x27;https://fanyi.baidu.com/sug&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step2 è¿›è¡ŒUAä¼ªè£…</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step3 postè¯·æ±‚å‚æ•°å¤„ç†ï¼ˆåŒgetè¯·æ±‚ç±»ä¼¼ï¼‰</span></span><br><span class="line">    word = <span class="built_in">input</span>(<span class="string">&#x27;Enter a word:\n&#x27;</span>)</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;kw&#x27;</span>:word</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step4 è¯·æ±‚å‘é€</span></span><br><span class="line">    response = requests.post(url = post_url,data = data,headers = headers)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step5 è·å–å“åº”æ•°æ®:json()æ–¹æ³•è¿”å›çš„æ˜¯obj  (å¦‚æœç¡®è®¤å“åº”æ•°æ®æ˜¯jsonç±»å‹--&gt;é€šè¿‡Content-Typeåˆ†è¾¨ï¼Œæ‰å¯ä»¥ç›´æ¥ç”¨jsonæ–¹æ³•)</span></span><br><span class="line">    dict_obj = response.json()</span><br><span class="line">    <span class="built_in">print</span>(dict_obj)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step6 æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    fileName = word + <span class="string">&#x27;.json&#x27;</span></span><br><span class="line">    fp = <span class="built_in">open</span>(fileName,<span class="string">&#x27;w&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(dict_obj,fp = fp,ensure_ascii = <span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Over!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ3ï¼‰è±†ç“£ç”µå½±"><a href="#ï¼ˆ3ï¼‰è±†ç“£ç”µå½±" class="headerlink" title="ï¼ˆ3ï¼‰è±†ç“£ç”µå½±"></a>ï¼ˆ3ï¼‰è±†ç“£ç”µå½±</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&#x27;https://movie.douban.com/j/chart/top_list&#x27;</span></span><br><span class="line">    param = &#123;</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>:<span class="string">&#x27;24&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;interval_id&#x27;</span>:<span class="string">&#x27;100:90&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;action&#x27;</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;start&#x27;</span>:<span class="string">&#x27;0&#x27;</span>,	<span class="comment">#ä»åº“ä¸­çš„ç¬¬å‡ éƒ¨ç”µå½±å»å–</span></span><br><span class="line">        <span class="string">&#x27;limit&#x27;</span>:<span class="string">&#x27;20&#x27;</span>	<span class="comment">#ä¸€æ¬¡å–å‡ºçš„ä¸ªæ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url = url,params = param,headers = headers)</span><br><span class="line">    list_data = response.json()</span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&#x27;./douban.json&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding = <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(list_data,fp = fp,ensure_ascii = <span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Over!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-ä½œä¸šâ€”è‚¯å¾·åŸºé¤å…æŸ¥è¯¢"><a href="#3-ä½œä¸šâ€”è‚¯å¾·åŸºé¤å…æŸ¥è¯¢" class="headerlink" title="3. ä½œä¸šâ€”è‚¯å¾·åŸºé¤å…æŸ¥è¯¢"></a>3. ä½œä¸šâ€”è‚¯å¾·åŸºé¤å…æŸ¥è¯¢</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;https://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=keyword&#x27;</span></span><br><span class="line">    keyword = <span class="built_in">input</span>(<span class="string">&#x27;è¯·è¾“å…¥è¦æŸ¥è¯¢çš„åŸå¸‚ï¼š&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    data =&#123;</span><br><span class="line">        <span class="string">&#x27;cname&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pid&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;keyword&#x27;</span>: keyword,</span><br><span class="line">        <span class="string">&#x27;pageindex&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pageSize&#x27;</span>: <span class="string">&#x27;10&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url = post_url, data = data, headers = headers)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">    <span class="comment"># page_text = response.text</span></span><br><span class="line">    <span class="comment"># fileName = keyword + &#x27;.html&#x27;</span></span><br><span class="line">    <span class="comment"># with open(fileName, &#x27;w&#x27;, encoding= &#x27;utf-8&#x27;) as fp:</span></span><br><span class="line">    <span class="comment">#     fp.write(page_text)</span></span><br><span class="line">    <span class="comment"># print(fileName, &#x27;Over!&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç›´æ¥æ‰“å°å‡ºæ¥</span></span><br><span class="line">    page = response.json()</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">dict</span> <span class="keyword">in</span> page[<span class="string">&#x27;Table1&#x27;</span>]:</span><br><span class="line">        StoreName = <span class="built_in">dict</span>[<span class="string">&#x27;storeName&#x27;</span>]</span><br><span class="line">        address = <span class="built_in">dict</span>[<span class="string">&#x27;addressDetail&#x27;</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;StoreName:&#x27;</span> + StoreName, <span class="string">&#x27;address:&#x27;</span> + address + <span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-ç»¼åˆç»ƒä¹ â€”è¯ç›‘æ€»å±€"><a href="#4-ç»¼åˆç»ƒä¹ â€”è¯ç›‘æ€»å±€" class="headerlink" title="4. ç»¼åˆç»ƒä¹ â€”è¯ç›‘æ€»å±€"></a>4. ç»¼åˆç»ƒä¹ â€”è¯ç›‘æ€»å±€</h2><ul>
<li><p>çˆ¬å–å›½å®¶è¯å“ç›‘ç£ç®¡ç†æ€»å±€ä¸­<strong>åŸºäºä¸­åäººæ°‘å…±å’Œå›½åŒ–å¦†å“ç”Ÿäº§è®¸å¯è¯ç›¸å…³æ•°æ®</strong>ï¼ˆ<a target="_blank" rel="noopener" href="http://scxk.nmpa.gov.cn:81/xk/%EF%BC%89">http://scxk.nmpa.gov.cn:81/xk/ï¼‰</a></p>
</li>
<li><p><strong>åŠ¨æ€åŠ è½½æ•°æ®ï¼š</strong>é¦–é¡µä¸­å¯¹åº”çš„ä¼ä¸šä¿¡æ¯æ˜¯é€šè¿‡ <code>ajax</code> åŠ¨æ€è¯·æ±‚åˆ°çš„</p>
</li>
<li><p>é€šè¿‡å¯¹è¯¦æƒ…é¡µurlçš„è§‚å¯Ÿå‘ç°ï¼š</p>
<ul>
<li>urlçš„åŸŸåéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰æºå¸¦çš„å‚æ•°ï¼ˆidï¼‰ä¸ä¸€æ ·</li>
<li>idå€¼å¯ä»¥ä»é¦–é¡µå¯¹åº”çš„ <code>ajax</code> è¯·æ±‚åˆ°çš„ <code>json</code> ä¸²ä¸­è·å–</li>
<li>åŸŸåå’Œidå€¼æ‹¼æ¥å‡ºä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šå¯¹åº”çš„è¯¦æƒ…é¡µçš„url</li>
</ul>
</li>
<li><p><strong>è¯¦æƒ…é¡µçš„ä¼ä¸šè¯¦æƒ…æ•°æ®ä¹Ÿæ˜¯åŠ¨æ€åŠ è½½å‡ºæ¥çš„ï¼ï¼ï¼</strong></p>
<ul>
<li>è§‚å¯Ÿåå‘ç°ï¼Œæ‰€æœ‰ <code>post</code> è¯·æ±‚çš„urléƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰å‚æ•°idå€¼ä¸åŒ</li>
<li>å¦‚æœæˆ‘ä»¬å¯ä»¥æ‰¹é‡è·å–å¤šå®¶ä¼ä¸šçš„idåï¼Œå°±å¯ä»¥å°±idå’Œurlå½¢æˆä¸€ä¸ªå®Œæ•´çš„è¯¦æƒ…é¡µå¯¹åº”è¯¦æƒ…æ•°æ®çš„ <code>ajax</code> è¯·æ±‚çš„url</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    id_list = []  <span class="comment"># å­˜å‚¨ä¼ä¸šçš„id</span></span><br><span class="line">    all_data_list = []  <span class="comment"># å­˜å‚¨ä¼ä¸šæ‰€æœ‰çš„è¯¦æƒ…æ•°æ®</span></span><br><span class="line">    <span class="comment"># æ‰¹é‡è·å–ä¸åŒä¼ä¸šçš„idå€¼</span></span><br><span class="line">    url = <span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsList&#x27;</span></span><br><span class="line">    <span class="comment"># å‚æ•°çš„å°è£…</span></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        page = <span class="built_in">str</span>(page)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;on&#x27;</span>: <span class="string">&#x27;true&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;page&#x27;</span>: page,</span><br><span class="line">            <span class="string">&#x27;pageSize&#x27;</span>: <span class="string">&#x27;15&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;productName&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;conditionType&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;applyname&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;applysn&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    json_ids = requests.post(url=url, headers=headers, data=data).json()</span><br><span class="line">    <span class="comment"># ä» json_ids å­—å…¸ä¸­æ‹¿åˆ° list å¯¹åº”çš„ value å€¼ï¼Œå¯¹ value å€¼åˆ—è¡¨è¿›è¡Œéå†</span></span><br><span class="line">    <span class="keyword">for</span> dic <span class="keyword">in</span> json_ids[<span class="string">&#x27;list&#x27;</span>]:</span><br><span class="line">        id_list.append(dic[<span class="string">&#x27;ID&#x27;</span>])</span><br><span class="line">    <span class="comment"># print(id_list,&#x27;\n&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è·å–ä¼ä¸šè¯¦æƒ…æ•°æ®,ä¹Ÿæ˜¯åŠ¨æ€åŠ è½½å‡ºæ¥çš„ï¼Œæºå¸¦ä¸€ä¸ªå‚æ•° idï¼Œå…¶å€¼å¯ä»¥é€šè¿‡å‰ä¸€æ­¥ç”Ÿæˆçš„ idåˆ—è¡¨æå–</span></span><br><span class="line">    post_url = <span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsById&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">id</span> <span class="keyword">in</span> id_list:</span><br><span class="line">        data = &#123;</span><br><span class="line">        <span class="string">&#x27;id&#x27;</span>: <span class="built_in">id</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        json_detail = requests.post(url=post_url, data=data, headers=headers).json()</span><br><span class="line">        <span class="comment">#print(json_detail, &#x27;-------------END----------&#x27;)</span></span><br><span class="line">        all_data_list.append(json_detail )</span><br><span class="line">        all_data_list.append(<span class="string">&#x27;---------------------------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–å­˜å‚¨all_data_list</span></span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&#x27;./allData.json&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    json.dump(all_data_list, fp=fp, ensure_ascii=<span class="literal">False</span>, indent= <span class="literal">True</span>)  <span class="comment"># indent è‡ªåŠ¨æ’ç‰ˆ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Over!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ä¸‰ã€æ•°æ®è§£æ"><a href="#ä¸‰ã€æ•°æ®è§£æ" class="headerlink" title="ä¸‰ã€æ•°æ®è§£æ"></a>ä¸‰ã€æ•°æ®è§£æ</h1><h2 id="1-æ•°æ®è§£ææ¦‚è¿°"><a href="#1-æ•°æ®è§£ææ¦‚è¿°" class="headerlink" title="1. æ•°æ®è§£ææ¦‚è¿°"></a>1. æ•°æ®è§£ææ¦‚è¿°</h2><ul>
<li><strong>èšç„¦çˆ¬è™«ï¼š</strong>çˆ¬å–é¡µé¢ä¸­æŒ‡å®šçš„é¡µé¢å†…å®¹ã€‚<ul>
<li>ç¼–ç æµç¨‹ï¼š1. æŒ‡å®šURL â†’ 2. å‘èµ·è¯·æ±‚ â†’ 3. è·å–å“åº”æ•°æ® â†’ 4. æ•°æ®è§£æ â†’ 5. æŒä¹…åŒ–å­˜å‚¨</li>
</ul>
</li>
<li><strong>æ•°æ®è§£æåˆ†ç±»ï¼š</strong><ul>
<li>æ­£åˆ™è¡¨è¾¾å¼</li>
<li><code>bs4</code> è§£æ</li>
<li><code>xpath</code> è§£æï¼ˆé‡ç‚¹ï¼‰</li>
</ul>
</li>
<li><strong>æ•°æ®è§£æåŸç†æ¦‚è¿°ï¼š</strong>è§£æçš„å±€éƒ¨çš„æ–‡æœ¬å†…å®¹éƒ½ä¼šåœ¨æ ‡ç­¾å¯¹åº”çš„å±æ€§ä¸­è¿›è¡Œå­˜å‚¨ã€‚<ul>
<li>è¿›è¡ŒæŒ‡å®šæ ‡ç­¾çš„å®šä½</li>
<li>æ ‡ç­¾æˆ–è€…æ ‡ç­¾å¯¹åº”çš„å±æ€§ä¸­å­˜å‚¨çš„æ•°æ®å€¼è¿›è¡Œæå–ï¼ˆè§£æï¼‰</li>
</ul>
</li>
</ul>
<h2 id="2-å›¾ç‰‡æ•°æ®çˆ¬å–â€”æ­£åˆ™è¡¨è¾¾å¼"><a href="#2-å›¾ç‰‡æ•°æ®çˆ¬å–â€”æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="2. å›¾ç‰‡æ•°æ®çˆ¬å–â€”æ­£åˆ™è¡¨è¾¾å¼"></a>2. å›¾ç‰‡æ•°æ®çˆ¬å–â€”æ­£åˆ™è¡¨è¾¾å¼</h2><table>
<thead>
<tr>
<th align="center"><strong>æ“ä½œç¬¦</strong></th>
<th align="center"><strong>è¯´æ˜</strong></th>
<th align="center"><strong>å®ä¾‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>.</strong></td>
<td align="center">è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>[ ]</strong></td>
<td align="center">å­—ç¬¦é›†ï¼Œå¯¹å•ä¸ªå­—ç¬¦ç»™å‡ºå–å€¼èŒƒå›´</td>
<td align="center">[abc]è¡¨ç¤ºa,b,c,[a-z]è¡¨ç¤ºa-zçš„</td>
</tr>
<tr>
<td align="center"><strong>[^ ]</strong></td>
<td align="center">éå­—ç¬¦é›†ï¼Œå¯¹å•ä¸ªå­—ç¬¦ç»™å‡ºæ’é™¤èŒƒå›´</td>
<td align="center">[^abc]è¡¨ç¤ºéaæˆ–bæˆ–cçš„å•ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td align="center">*****</td>
<td align="center">å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–æ— é™æ¬¡æ‰©å±•</td>
<td align="center">abc* è¡¨ç¤ºabã€abcã€abccã€abcccç­‰</td>
</tr>
<tr>
<td align="center"><strong>+</strong></td>
<td align="center">å‰ä¸€ä¸ªå­—ç¬¦1æ¬¡æˆ–æ— é™æ¬¡æ‰©å±•</td>
<td align="center">abc+ è¡¨ç¤ºabcã€abccã€abcccç­‰</td>
</tr>
<tr>
<td align="center"><strong>?</strong></td>
<td align="center">å‰ä¸€ä¸ªå­—ç¬¦0æ¬¡æˆ–1æ¬¡æ‰©å±•</td>
<td align="center">abcï¼Ÿ è¡¨ç¤ºabã€abc</td>
</tr>
<tr>
<td align="center"><strong>|</strong></td>
<td align="center">å·¦å³è¡¨è¾¾å¼ä»»æ„ä¸€ä¸ª</td>
<td align="center">abc|def è¡¨ç¤ºabcã€def</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center"><strong>{m}</strong></th>
<th align="center">æ‰©å±•å‰ä¸€ä¸ªå­—ç¬¦mæ¬¡</th>
<th align="center">ab{2}cè¡¨ç¤ºabbc</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>{m,n}</strong></td>
<td align="center">æ‰©å±•å‰ä¸€ä¸ªå­—ç¬¦mè‡³næ¬¡ï¼ˆå«nï¼‰</td>
<td align="center">ab{1ï¼Œ2}cè¡¨ç¤ºabcã€abbc</td>
</tr>
<tr>
<td align="center"><strong>^</strong></td>
<td align="center">åŒ¹é…å­—ç¬¦ä¸²å¼€å¤´</td>
<td align="center">^abcè¡¨ç¤ºabcä¸”åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼€å¤´</td>
</tr>
<tr>
<td align="center"><strong>$</strong></td>
<td align="center">åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾</td>
<td align="center">abc$è¡¨ç¤ºabcä¸”åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“å°¾</td>
</tr>
<tr>
<td align="center"><strong>( )</strong></td>
<td align="center">åˆ†ç»„æ ‡è®°ï¼Œå†…éƒ¨åªèƒ½ä½¿ç”¨|æ“ä½œç¬¦</td>
<td align="center">(abc)è¡¨ç¤ºabcï¼Œ(abc|def)è¡¨ç¤ºabcã€def</td>
</tr>
<tr>
<td align="center"><strong>\d</strong></td>
<td align="center">æ•°å­—ï¼Œç­‰ä»·äº[0-9]</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>\w</strong></td>
<td align="center">å•è¯å­—ç¬¦ï¼Œç­‰ä»·äº[A-Za-z0-9_]</td>
<td align="center"></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">å‡½æ•°</th>
<th align="center">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>re.search()</strong></td>
<td align="center">åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœç´¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œ<strong>è¿”å›matchå¯¹è±¡</strong></td>
</tr>
<tr>
<td align="center"><strong>re.match()</strong></td>
<td align="center">ä»å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®èµ·åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ï¼Œ<strong>è¿”å›matchå¯¹è±¡</strong></td>
</tr>
<tr>
<td align="center"><strong>re.findall()</strong></td>
<td align="center">æœæœå­—ç¬¦ä¸²ï¼Œä»¥åˆ—è¡¨ç±»å‹è¿”å›å…¨éƒ¨èƒ½åŒ¹é…çš„å­ä¸²</td>
</tr>
<tr>
<td align="center"><strong>re.split()</strong></td>
<td align="center">å°†ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç»“æœè¿›è¡Œåˆ†å‰²ï¼Œ<strong>è¿”å›åˆ—è¡¨ç±»å‹</strong></td>
</tr>
<tr>
<td align="center"><strong>re.finditer()</strong></td>
<td align="center">æœç´¢å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªåŒ¹é…ç»“æœçš„è¿­ä»£ç±»å‹ï¼Œ<strong>æ¯ä¸ªè¿­ä»£å…ƒç´ æ˜¯matchå¯¹è±¡</strong></td>
</tr>
<tr>
<td align="center"><strong>re.sub()</strong></td>
<td align="center">åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ›¿æ¢æ‰€æœ‰åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å­ä¸²ï¼Œè¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">ä¿®é¥°ç¬¦</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">re.I</td>
<td align="center">ä½¿åŒ¹é…å¯¹å¤§å°å†™ä¸æ•æ„Ÿ</td>
</tr>
<tr>
<td align="center">re.L</td>
<td align="center">åšæœ¬åœ°åŒ–è¯†åˆ«åŒ¹é…</td>
</tr>
<tr>
<td align="center">re.M</td>
<td align="center">å¤šè¡ŒåŒ¹é…ï¼Œå½±å“^å’Œ$</td>
</tr>
<tr>
<td align="center">re.S</td>
<td align="center">ä½¿.åŒ¹é…åŒ…æ‹¬æ¢è¡Œåœ¨å†…çš„æ‰€æœ‰å­—ç¬¦</td>
</tr>
<tr>
<td align="center">re.U</td>
<td align="center">æ ¹æ®Unicodeå­—ç¬¦é›†è§£æå­—ç¬¦ï¼Œè¿™ä¸ªæ ‡å¿—å½±å“\w,\W,\b,\B</td>
</tr>
<tr>
<td align="center">re.X</td>
<td align="center">è¯¥æ ‡å¿—é€šè¿‡ç»™äºˆä½ è·Ÿçµæ´»çš„æ ¼å¼ä»¥ä¾¿ä½ å°†æ­£åˆ™è¡¨è¾¾å¼å†™å¾—æ›´æ˜“äºç†è§£</td>
</tr>
</tbody></table>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">å¸¸ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼</span><br><span class="line"></span><br><span class="line">å•å­—ç¬¦ï¼š</span><br><span class="line"><span class="code">			.	:	é™¤æ¢è¡Œä»¥å¤–æ‰€æœ‰å­—ç¬¦</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			[ ]	: 	[aoe]  [a-w] åŒ¹é…é›†åˆä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\d	:	æ•°å­— [0-9]</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\D	:	éæ•°å­—</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\w	:	æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€ä¸­æ–‡</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\W	:	é\w</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\s	 :	æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦åŒ…ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ï¼Œç­‰ä»·äº[ \f \n \r \t \v ]</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\S	:	éç©ºç™½</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">æ•°é‡ä¿®é¥°ï¼š</span><br><span class="line"><span class="code">			 \*	:	ä»»æ„å¤šæ¬¡	&gt;=0</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			\+	:	è‡³å°‘ä¸€æ¬¡	&gt;=1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			?	:	å¯æœ‰å¯æ— 	0æ¬¡æˆ–è€…1æ¬¡</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">		&#123;m&#125;	:	å›ºå®šmæ¬¡	hello&#123;3,&#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">		&#123;m,&#125;	:	è‡³å°‘mæ¬¡</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">		&#123;m,n&#125;	:	m-næ¬¡</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">è¾¹ç•Œï¼š</span><br><span class="line"><span class="code">			\$	:	ä»¥æŸæŸç»“å°¾</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">			^	:	ä»¥æŸæŸå¼€å¤´</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">åˆ†ç»„ï¼š</span><br><span class="line"><span class="code">			(ab)</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">è´ªå©ªæ¨¡å¼ï¼š	.\*</span><br><span class="line"></span><br><span class="line">éè´ªå©ªï¼ˆæƒ°æ€§ï¼‰æ¨¡å¼ï¼š	.\<span class="emphasis">*?</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">re.I	:	å¿½ç•¥å¤§å°å†™</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">re.M	:	å¤šè¡ŒåŒ¹é…</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">re.S	:	å•è¡ŒåŒ¹é…</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">re.sub	:	æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å†…å®¹ï¼Œå­—ç¬¦ä¸²</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;æ­£åˆ™ç»ƒä¹ &#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#æå–å‡ºpython</span></span><br><span class="line">key = <span class="string">&quot;javapythonc++php&quot;</span></span><br><span class="line">re.findall(<span class="string">&#x27;python&#x27;</span>, key)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æå–å‡ºhello world</span></span><br><span class="line">key = <span class="string">&quot;&lt;html&gt;&lt;h1&gt;&lt;hello world&gt;&lt;h1&gt;&lt;/html&gt;&quot;</span></span><br><span class="line">re.findall(<span class="string">&#x27;&lt;h1&gt;(.*)&lt;h1&gt;&#x27;</span>, key)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#æå–170</span></span><br><span class="line">string = <span class="string">&#x27;æˆ‘å–œæ¬¢èº«é«˜ä¸º170çš„å¥³å­©â€™</span></span><br><span class="line"><span class="string">re.findall(&#x27;</span>\d+<span class="string">&#x27;, string)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æå–å‡ºhttp://å’Œhttps://</span></span><br><span class="line"><span class="string">key = &#x27;</span>http://www.baidu.com <span class="keyword">and</span> https://boob.com<span class="string">&#x27;</span></span><br><span class="line"><span class="string">re.findall(&#x27;</span>https?://<span class="string">&#x27;, key)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æå–å‡ºhello</span></span><br><span class="line"><span class="string">key = &#x27;</span>lalala&lt;hTml&gt;&lt;hello&gt;&lt;/HtMl&gt;hahah<span class="string">&#x27; 	#è¾“å‡º&lt;hTml&gt;&lt;hello&gt;&lt;/HtMl&gt;</span></span><br><span class="line"><span class="string">re.findall(&#x27;</span>&lt;[Hh][Tt][mM][lL]&gt;(.*)&lt;/[Hh][Tt][mM][lL]&gt;<span class="string">&#x27;, key)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#æå–å‡ºhit.</span></span><br><span class="line"><span class="string">key = &#x27;</span>bobo@hit.edu.com<span class="string">&#x27;	#æƒ³è¦åŒ¹é…åˆ°hit</span></span><br><span class="line"><span class="string">re.findall(&#x27;</span>h.*?\.<span class="string">&#x27;, key)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#åŒ¹é…saså’Œsaas</span></span><br><span class="line"><span class="string">key = &#x27;</span>sasa <span class="keyword">and</span> sas <span class="keyword">and</span> saaas<span class="string">&#x27;</span></span><br><span class="line"><span class="string">re.findall(&#x27;</span>sa&#123;<span class="number">1</span>,<span class="number">2</span>&#125;s<span class="string">&#x27;, key)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#å¦‚ä½•çˆ¬å–å›¾ç‰‡</span></span><br><span class="line">    url = <span class="string">&#x27;https://pic.qiushibaike.com/system/pictures/12409/124098453/medium/YNPHJQC101MS31E1.jpg&#x27;</span></span><br><span class="line">    <span class="comment">#contentè¿”å›çš„æ˜¯äºŒè¿›åˆ¶å½¢å¼çš„å›¾ç‰‡æ•°æ®</span></span><br><span class="line">    <span class="comment">#text(å­—ç¬¦ä¸²)  content(äºŒè¿›åˆ¶)	json(é˜Ÿå½¢)</span></span><br><span class="line">    img_data = requests.get(url = url).content</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./qiutu.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(img_data)</span><br></pre></td></tr></table></figure>

<h2 id="3-æ­£åˆ™è§£ææ¡ˆä¾‹"><a href="#3-æ­£åˆ™è§£ææ¡ˆä¾‹" class="headerlink" title="3. æ­£åˆ™è§£ææ¡ˆä¾‹"></a>3. æ­£åˆ™è§£ææ¡ˆä¾‹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€æ±‚ï¼šçˆ¬å–ç³—äº‹ç™¾ç§‘ä¸­ç³—å›¾æ¿å—ä¸‹æ‰€æœ‰çš„ç³—å›¾å›¾ç‰‡</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;&lt;div class=&quot;thumb&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;a href=&quot;/article/124098472&quot; target=&quot;_blank&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;img src=&quot;//pic.qiushibaike.com/system/pictures/12409/124098472/medium/HSN2WWN0TP1VUPNG.jpg&quot; alt=&quot;ç³—äº‹#124098472&quot; class=&quot;illustration&quot; width=&quot;100%&quot; height=&quot;auto&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¿å­˜æ‰€æœ‰çš„å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./qiutuLibs&#x27;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&#x27;./qiutuLibs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&#x27;https://www.qiushibaike.com/imgrank/ &#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># ä½¿ç”¨é€šç”¨çˆ¬è™«å¯¹urlå¯¹åº”çš„ä¸€æ•´å¼ é¡µé¢è¿›è¡Œçˆ¬å–</span></span><br><span class="line">    page_text = requests.get(url=url, headers=headers).text</span><br><span class="line">    <span class="comment">#print(page_text)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä½¿ç”¨èšç„¦çˆ¬è™«å°†é¡µé¢ä¸­æ‰€æœ‰çš„ç³—å›¾è¿›è¡Œè§£ææå–</span></span><br><span class="line">    ex = <span class="string">&#x27;&lt;div class=&quot;thumb&quot;&gt;.*?&lt;img src=&quot;(.*?)&quot; alt=.*?&lt;/div&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">    img_src_list = re.findall(ex, page_text, re.S)</span><br><span class="line">    <span class="built_in">print</span>(img_src_list)</span><br><span class="line">    <span class="keyword">for</span> src <span class="keyword">in</span> img_src_list:</span><br><span class="line">        <span class="comment">#æ‹¼æ¥å‡ºå®Œæ•´çš„å›¾ç‰‡url</span></span><br><span class="line">        src = <span class="string">&#x27;https:&#x27;</span> + src</span><br><span class="line">        img_data = requests.get(url = src, headers = headers).content</span><br><span class="line">        <span class="comment">#ç”Ÿæˆå›¾ç‰‡åç§°</span></span><br><span class="line">        img_name = src.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        imgPath = <span class="string">&#x27;./qiutuLibs/&#x27;</span> + img_name</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(imgPath, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            fp.write(img_data)</span><br><span class="line">        <span class="built_in">print</span>(img_name, <span class="string">&#x27;ä¸‹è½½æˆåŠŸ!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼Œä½¿å¾—èƒ½å¤Ÿåˆ†é¡µçˆ¬å–å›¾ç‰‡</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¿å­˜æ‰€æœ‰çš„å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./qiutuLibs&#x27;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&#x27;./qiutuLibs&#x27;</span>)</span><br><span class="line">    <span class="comment"># è®¾ç½®ä¸€ä¸ªé€šç”¨çš„urlæ¨¡æ¿</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.qiushibaike.com/imgrank/page/%d/&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> pageNum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        <span class="comment"># å¯¹åº”é¡µç çš„ url</span></span><br><span class="line">        new_url = <span class="built_in">format</span>(url % pageNum)</span><br><span class="line">        headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># ä½¿ç”¨é€šç”¨çˆ¬è™«å¯¹urlå¯¹åº”çš„ä¸€æ•´å¼ é¡µé¢è¿›è¡Œçˆ¬å–</span></span><br><span class="line">        page_text = requests.get(url=new_url, headers=headers).text</span><br><span class="line">        <span class="comment">#print(page_text)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#ä½¿ç”¨èšç„¦çˆ¬è™«å°†é¡µé¢ä¸­æ‰€æœ‰çš„ç³—å›¾è¿›è¡Œè§£ææå–</span></span><br><span class="line">        ex = <span class="string">&#x27;&lt;div class=&quot;thumb&quot;&gt;.*?&lt;img src=&quot;(.*?)&quot; alt=.*?&lt;/div&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">        img_src_list = re.findall(ex, page_text, re.S)</span><br><span class="line">        <span class="built_in">print</span>(img_src_list)</span><br><span class="line">        <span class="keyword">for</span> src <span class="keyword">in</span> img_src_list:</span><br><span class="line">            <span class="comment">#æ‹¼æ¥å‡ºå®Œæ•´çš„å›¾ç‰‡url</span></span><br><span class="line">            src = <span class="string">&#x27;https:&#x27;</span> + src</span><br><span class="line">            img_data = requests.get(url = src, headers = headers).content</span><br><span class="line">            <span class="comment">#ç”Ÿæˆå›¾ç‰‡åç§°</span></span><br><span class="line">            img_name = src.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">            imgPath = <span class="string">&#x27;./qiutuLibs/&#x27;</span> + img_name</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(imgPath, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                fp.write(img_data)</span><br><span class="line">            <span class="built_in">print</span>(img_name, <span class="string">&#x27;ä¸‹è½½æˆåŠŸ!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="4-bs4è§£ææ¦‚è¿°"><a href="#4-bs4è§£ææ¦‚è¿°" class="headerlink" title="4. bs4è§£ææ¦‚è¿°"></a>4. bs4è§£ææ¦‚è¿°</h2><ul>
<li><p><strong>æ•°æ®è§£æçš„åŸç†ï¼š</strong></p>
<ul>
<li><ol>
<li>æ ‡ç­¾å®šä½</li>
<li>æå–æ ‡ç­¾ã€æ ‡ç­¾å±æ€§ä¸­å­˜å‚¨çš„æ•°æ®å€¼</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>bs4æ•°æ®è§£æçš„åŸç†ï¼š</strong></p>
<ul>
<li><ol>
<li>å®ä¾‹åŒ–ä¸€ä¸ª<code>BeautifulSoup</code>å¯¹è±¡ï¼Œå¹¶ä¸”å°†é¡µé¢æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­</li>
<li>é€šè¿‡è°ƒç”¨<code>BeautifulSoup</code>å¯¹è±¡ä¸­ç›¸å…³çš„å±æ€§æˆ–è€…æ–¹æ³•è¿›è¡Œæ ‡ç­¾å®šä½å’Œæ•°æ®æå–</li>
</ol>
</li>
</ul>
</li>
<li><p><strong>ç¯å¢ƒå®‰è£…ï¼š</strong><code>pip install bs4</code>         <code>pip  install  lxml</code></p>
</li>
</ul>
<h2 id="5-bs4-è§£æå…·ä½“è®²è§£"><a href="#5-bs4-è§£æå…·ä½“è®²è§£" class="headerlink" title="5. bs4 è§£æå…·ä½“è®²è§£"></a>5. bs4 è§£æå…·ä½“è®²è§£</h2><ul>
<li><strong>å¦‚ä½•å®ä¾‹åŒ– BeautifulSoup å¯¹è±¡ï¼š</strong></li>
<li>å¯¼åŒ…ï¼Œ<code>from bs4 import BeautifulSoup</code><ul>
<li>å¯¹è±¡çš„å®ä¾‹åŒ–ï¼š<ul>
<li>ï¼ˆ1ï¼‰å°†æœ¬åœ°çš„ html æ–‡æ¡£ä¸­çš„æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ï¼›</li>
<li>ï¼ˆ2ï¼‰å°†äº’è”ç½‘ä¸Šè·å–çš„é¡µé¢æºç åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ã€‚</li>
</ul>
</li>
<li>æä¾›çš„ç”¨äºæ•°æ®è§£æçš„æ–¹æ³•å’Œå±æ€§ï¼š<ul>
<li><code>soup.tagName</code>ï¼šè¿”å›çš„æ˜¯æ–‡æ¡£ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ <code>tagName</code> æ ‡ç­¾ï¼›</li>
<li><code>soup.find(tagName)</code>ï¼šå¯ä»¥ç­‰åŒäº<code>soup.tagName</code>ï¼›ä¹Ÿå¯ä»¥è¿›è¡Œå±æ€§å®šä½ï¼›</li>
<li><code>soup.find_all( )</code>ï¼šè¿”å›ç¬¦åˆè¦æ±‚çš„æ‰€æœ‰æ ‡ç­¾ï¼›</li>
<li><code>select(&#39;æŸç§é€‰æ‹©å™¨(id,class,æ ‡ç­¾...é€‰æ‹©å™¨)&#39;)</code>è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼›å±‚çº§é€‰æ‹©å™¨</li>
</ul>
</li>
<li>è·å–æ ‡ç­¾ä¹‹é—´çš„æ–‡æœ¬æ•°æ®ï¼š<code>soup.a.text/string/get_text( )</code><ul>
<li><code>text/get_text( )</code>ï¼šå¯ä»¥è·å–æŸä¸€ä¸ªæ ‡ç­¾ä¸­æ‰€æœ‰çš„æ–‡æœ¬å†…å®¹</li>
<li><code>string</code>ï¼šåªå¯ä»¥è·å–è¯¥æ ‡ç­¾ä¸‹é¢ç›´ç³»çš„æ–‡æœ¬å†…å®¹</li>
</ul>
</li>
<li><strong>è·å–æ ‡ç­¾ä¸­çš„å±æ€§å€¼ï¼š</strong><code>soup.a[&#39;href&#39;]</code></li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>æµ‹è¯•bs4<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>ç™¾é‡Œå®ˆçº¦<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;song&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>ææ¸…ç…§<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>ç‹å®‰çŸ³<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>è‹è½¼<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">p</span>&gt;</span>æŸ³å®—å…ƒ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.song.com/&quot;</span> <span class="attr">title</span>=<span class="string">&quot;èµµåŒ¡èƒ¤&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_self&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span>&gt;</span>this is span<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">		å®‹æœæ˜¯æœ€å¼ºå¤§çš„ç‹æœï¼Œä¸æ˜¯å†›é˜Ÿçš„å¼ºå¤§ï¼Œè€Œæ˜¯ç»æµå¾ˆå¼ºå¤§ï¼Œå›½æ°‘éƒ½å¾ˆæœ‰é’±<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>æ€»ä¸ºæµ®äº‘èƒ½è”½æ—¥,é•¿å®‰ä¸è§ä½¿äººæ„<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://www.baidu.com/meinv.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tang&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">title</span>=<span class="string">&quot;qing&quot;</span>&gt;</span>æ¸…æ˜æ—¶èŠ‚é›¨çº·çº·,è·¯ä¸Šè¡Œäººæ¬²æ–­é­‚,å€Ÿé—®é…’å®¶ä½•å¤„æœ‰,ç‰§ç«¥é¥æŒ‡æèŠ±æ‘<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.163.com&quot;</span> <span class="attr">title</span>=<span class="string">&quot;qin&quot;</span>&gt;</span>ç§¦æ—¶æ˜æœˆæ±‰æ—¶å…³,ä¸‡é‡Œé•¿å¾äººæœªè¿˜,ä½†ä½¿é¾™åŸé£å°†åœ¨,ä¸æ•™èƒ¡é©¬åº¦é˜´å±±<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.126.com&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;qi&quot;</span>&gt;</span>å²ç‹å®…é‡Œå¯»å¸¸è§,å´”ä¹å ‚å‰å‡ åº¦é—»,æ­£æ˜¯æ±Ÿå—å¥½é£æ™¯,è½èŠ±æ—¶èŠ‚åˆé€¢å›<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.sina.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>æœç”«<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.dudu.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;du&quot;</span>&gt;</span>æœç‰§<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>æœå°æœˆ<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>åº¦èœœæœˆ<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.haha.com&quot;</span> <span class="attr">id</span>=<span class="string">&quot;feng&quot;</span>&gt;</span>å‡¤å‡°å°ä¸Šå‡¤å‡°æ¸¸,å‡¤å»å°ç©ºæ±Ÿè‡ªæµ,å´å®«èŠ±è‰åŸ‹å¹½å¾„,æ™‹ä»£è¡£å† æˆå¤ä¸˜<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># å°†æœ¬åœ°çš„htmlæ–‡æ¡£ä¸­çš„æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­</span></span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&#x27;./test.html&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    soup = BeautifulSoup(fp, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="comment"># print(soup)</span></span><br><span class="line">    <span class="comment"># page_text = response.text</span></span><br><span class="line">    <span class="comment"># soup = BeautifulSoup(page_text,&#x27;lxml&#x27;)</span></span><br><span class="line">    <span class="built_in">print</span>(soup.a)  <span class="comment"># soup.tagName è¿”å›çš„æ˜¯htmlä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„tagNameæ ‡ç­¾</span></span><br><span class="line">    <span class="built_in">print</span>(soup.div)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(soup.find(<span class="string">&#x27;div&#x27;</span>))  <span class="comment"># find(tagName) ç­‰åŒäº soup.div</span></span><br><span class="line">    <span class="built_in">print</span>(soup.find(<span class="string">&#x27;div&#x27;</span>, class_=<span class="string">&#x27;song&#x27;</span>))  <span class="comment"># å±æ€§å®šä½</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(soup.find_all(<span class="string">&#x27;a&#x27;</span>))  <span class="comment"># è¿”å›ç¬¦åˆè¦æ±‚çš„æ‰€æœ‰æ ‡ç­¾ï¼ˆåˆ—è¡¨ï¼‰</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang&#x27;</span>))  <span class="comment"># è¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨</span></span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul &gt; li &gt; a&#x27;</span>)[<span class="number">0</span>])  <span class="comment"># å±‚çº§é€‰æ‹©å™¨   &gt; è¡¨ç¤ºä¸€ä¸ªå±‚çº§</span></span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul  a&#x27;</span>)[<span class="number">0</span>])  <span class="comment"># ç©ºæ ¼è¡¨ç¤ºå¤šä¸ªå±‚çº§</span></span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul  a&#x27;</span>)[<span class="number">0</span>].text)</span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul  a&#x27;</span>)[<span class="number">0</span>].get_text())</span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul  a&#x27;</span>)[<span class="number">0</span>].string)</span><br><span class="line">    <span class="built_in">print</span>(soup.select(<span class="string">&#x27;.tang &gt; ul  a&#x27;</span>)[<span class="number">0</span>][<span class="string">&#x27;href&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h2 id="6-bs4-è§£ææ¡ˆä¾‹å®æˆ˜"><a href="#6-bs4-è§£ææ¡ˆä¾‹å®æˆ˜" class="headerlink" title="6. bs4 è§£ææ¡ˆä¾‹å®æˆ˜"></a>6. bs4 è§£ææ¡ˆä¾‹å®æˆ˜</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€æ±‚ï¼šçˆ¬å–ä¸‰å›½æ¼”ä¹‰å°è¯´æ‰€æœ‰çš„ç« èŠ‚æ ‡é¢˜å’Œç« èŠ‚å†…å®¹</span></span><br><span class="line"><span class="comment"># https://www.shicimingju.com/book/sanguoyanyi.html</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#å¯¹é¦–é¡µçš„é¡µé¢æ•°æ®è¿›è¡Œçˆ¬å–</span></span><br><span class="line">    headers = &#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">&#x27;https://www.shicimingju.com/book/sanguoyanyi.html&#x27;</span></span><br><span class="line"></span><br><span class="line">    response = requests.get(url = url, headers = headers)</span><br><span class="line">    response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    page_text = response.text</span><br><span class="line"></span><br><span class="line">    <span class="comment">#åœ¨é¦–é¡µä¸­è§£æå‡ºç« èŠ‚çš„æ ‡é¢˜å’Œè¯¦æƒ…é¡µçš„url</span></span><br><span class="line">    <span class="comment">#å®ä¾‹åŒ–BeautifulSoupå¯¹è±¡ï¼Œéœ€è¦å°†é¡µé¢æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­</span></span><br><span class="line">    soup = BeautifulSoup(page_text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">    <span class="comment"># è§£æç« èŠ‚æ ‡é¢˜å’Œè¯¦æƒ…é¡µçš„url</span></span><br><span class="line">    li_list = soup.select(<span class="string">&#x27;.book-mulu &gt; ul &gt; li&#x27;</span>)</span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&#x27;./sanguo.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding = <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">        title = li.a.string</span><br><span class="line">        detail_url =<span class="string">&#x27;http://www.shicimingju.com&#x27;</span> + li.a[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">        <span class="comment">#å¯¹è¯¦æƒ…é¡µå‘èµ·è¯·æ±‚ï¼Œè§£æå‡ºç« èŠ‚å†…å®¹</span></span><br><span class="line">        detail_response = requests.get(url = detail_url, headers = headers)</span><br><span class="line">        detail_response.encoding = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">        detail_page_text = detail_response.text</span><br><span class="line">        <span class="comment">#è§£æå‡ºè¯¦æƒ…é¡µä¸­ç›¸å…³çš„ç« èŠ‚å†…å®¹</span></span><br><span class="line">        detail_soup = BeautifulSoup(detail_page_text, <span class="string">&#x27;lxml&#x27;</span>)</span><br><span class="line">        div_tag = detail_soup.find(<span class="string">&#x27;div&#x27;</span>, class_ = <span class="string">&#x27;chapter_content&#x27;</span>)</span><br><span class="line">        <span class="comment">#è§£æåˆ°äº†ç« èŠ‚çš„å†…å®¹</span></span><br><span class="line">        content = div_tag.text</span><br><span class="line">        fp.write(title + <span class="string">&#x27;:&#x27;</span> + content + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(title, <span class="string">&#x27;çˆ¬å–æˆåŠŸï¼&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="7-xpathè§£æåŸºç¡€"><a href="#7-xpathè§£æåŸºç¡€" class="headerlink" title="7. xpathè§£æåŸºç¡€"></a>7. xpathè§£æåŸºç¡€</h2><ul>
<li><strong>xpathè§£æï¼š</strong>æœ€å¸¸ç”¨ä¸”æœ€ä¾¿æ·é«˜æ•ˆçš„ä¸€ç§è§£ææ–¹å¼ã€‚é€šç”¨æ€§ã€‚</li>
<li><strong>xpathè§£æåŸç†ï¼š</strong><ul>
<li>ï¼ˆ1ï¼‰å®ä¾‹åŒ–ä¸€ä¸ªetreeçš„å¯¹è±¡ï¼Œä¸”éœ€è¦å°†è¢«è§£æçš„é¡µé¢æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ï¼›</li>
<li>ï¼ˆ2ï¼‰è°ƒç”¨etreeå¯¹è±¡ä¸­çš„xpathæ–¹æ³•ç»“åˆç€xpathè¡¨è¾¾å¼å®ç°æ ‡ç­¾çš„å®šä½å’Œå†…å®¹çš„æ•è·ã€‚</li>
</ul>
</li>
<li><strong>ç¯å¢ƒçš„å®‰è£…ï¼š</strong><code>pip install lxml</code>       (lxmlè§£æå™¨)</li>
<li><strong>å¦‚ä½•å®ä¾‹åŒ–ä¸€ä¸ªetreeå¯¹è±¡ï¼š</strong><code>from lxml import etree</code><ul>
<li>ï¼ˆ1ï¼‰å°†æœ¬åœ°çš„htmlæ–‡æ¡£ä¸­çš„æºç æ•°æ®åŠ è½½åˆ°etreeå¯¹è±¡ä¸­ï¼š<code>etree.parse(filePath)</code></li>
<li>ï¼ˆ2ï¼‰å¯ä»¥å°†ä»äº’è”ç½‘ä¸Šè·å–çš„æºç æ•°æ®åŠ è½½åˆ°è¯¥å¯¹è±¡ä¸­ï¼š<code>etree.HTML(&#39;page_text&#39;)</code></li>
</ul>
</li>
<li><strong>xpath(â€˜xpathè¡¨è¾¾å¼â€™)ï¼š</strong><ul>
<li>å…¶ä¸­ &#x2F; è¡¨ç¤ºä»æ ¹èŠ‚ç‚¹å®šä½æˆ–è€…è¡¨ç¤ºä¸€ä¸ªå±‚çº§ï¼› </li>
<li>&#x2F;&#x2F; è¡¨ç¤ºå¤šä¸ªå±‚çº§æˆ–è€…ä»ä»»æ„ä½ç½®å¼€å§‹å®šä½ï¼›</li>
<li>å±æ€§å®šä½ï¼š<code>tag[@attrName=&quot;attrValue&quot;]</code>ï¼›</li>
<li>ç´¢å¼•å®šä½ï¼š<code>tag[@attrName=&quot;attrValue&quot;]/p[3]</code>ï¼Œæ³¨æ„ç´¢å¼•ä»1å¼€å§‹</li>
<li>å–æ–‡æœ¬ï¼š<code>/text( )</code>  ï¼šè·å–çš„æ˜¯æ ‡ç­¾ä¸­ç›´ç³»çš„æ–‡æœ¬å†…å®¹ï¼›<code>//text( )</code>  ï¼šæ ‡ç­¾ä¸­éç›´ç³»çš„æ–‡æœ¬å†…å®¹ï¼ˆæ‰€æœ‰çš„æ–‡æœ¬å†…å®¹ï¼‰</li>
<li>å–å±æ€§ï¼š<code>/@attrName   ==&gt;  img/@src</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#å®ä¾‹åŒ–å¥½äº†ä¸€ä¸ªetreeå¯¹è±¡ï¼Œä¸”å°†è¢«è§£æçš„æºç åŠ è½½åˆ°äº†è¯¥å¯¹è±¡ä¸­</span></span><br><span class="line">    tree = etree.parse(<span class="string">&#x27;test.html&#x27;</span>)</span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;/html/body/div&#x27;)</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;/html//div&#x27;)</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;//div&#x27;)</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;//div[@class=&quot;song&quot;]&#x27;)</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;//div[@class=&quot;tang&quot;]//li[5]/a/text()&#x27;)[0]</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;//li[7]//text()&#x27;)</span></span><br><span class="line">    <span class="comment"># r = tree.xpath(&#x27;//div[@class=&quot;tang&quot;]//text()&#x27;)</span></span><br><span class="line">    r = tree.xpath(<span class="string">&#x27;//div[@class=&quot;song&quot;]/img/@src&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure>

<h2 id="8-xpathå®æˆ˜-58äºŒæ‰‹æˆ¿"><a href="#8-xpathå®æˆ˜-58äºŒæ‰‹æˆ¿" class="headerlink" title="8. xpathå®æˆ˜-58äºŒæ‰‹æˆ¿"></a>8. xpathå®æˆ˜-58äºŒæ‰‹æˆ¿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éœ€æ±‚ï¼šçˆ¬å–58äºŒæ‰‹æˆ¿ä¸­çš„æˆ¿æºä¿¡æ¯</span></span><br><span class="line"><span class="comment">#ä½œè€…æé†’ï¼šæ­¤å¤„ä»£ç ä¸è§†é¢‘è¯¾ä¸­æœ‰å·®åˆ«ï¼ŒåŸå› æ˜¯è§†é¢‘è¯¾æ‹æ‘„æ—¶çš„ç½‘é¡µæºç å’Œä½œè€…å®é™…å­¦ä¹ æ—¶ç½‘é¡µæºç æœ‰å˜åŒ–ï¼Œä½œè€…ä»£ç äº2021/02/26è¿è¡Œæ­£å¸¸ã€‚</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: </span><br><span class="line">    headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">#çˆ¬å–é¡µé¢æºç æ•°æ®</span></span><br><span class="line">    url = <span class="string">&#x27;https://bj.58.com/ershoufang/&#x27;</span></span><br><span class="line">    page_text = requests.get(url = url,headers = headers).text</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#æ•°æ®è§£æ</span></span><br><span class="line">    tree = etree.HTML(page_text)</span><br><span class="line">    <span class="comment">#å­˜å‚¨çš„æ˜¯æ ‡ç­¾å¯¹è±¡</span></span><br><span class="line">    div_list = tree.xpath(<span class="string">&#x27;//section[@class=&quot;list&quot;]/div&#x27;</span>)</span><br><span class="line">    fp = <span class="built_in">open</span>(<span class="string">&#x27;58.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding = <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">        <span class="comment">#é¡µé¢æ•°æ®çš„å±€éƒ¨è§£æ</span></span><br><span class="line">        title = div.xpath(<span class="string">&#x27;./a/div[2]//h3/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        fp.write(title + <span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;---------------Over!------------------&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="9-xpathè§£ææ¡ˆä¾‹"><a href="#9-xpathè§£ææ¡ˆä¾‹" class="headerlink" title="9. xpathè§£ææ¡ˆä¾‹"></a>9. xpathè§£ææ¡ˆä¾‹</h2><h3 id="ï¼ˆ1ï¼‰4kå›¾ç‰‡è§£æä¸‹è½½"><a href="#ï¼ˆ1ï¼‰4kå›¾ç‰‡è§£æä¸‹è½½" class="headerlink" title="ï¼ˆ1ï¼‰4kå›¾ç‰‡è§£æä¸‹è½½"></a>ï¼ˆ1ï¼‰4kå›¾ç‰‡è§£æä¸‹è½½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#éœ€æ±‚ï¼šè§£æä¸‹è½½å›¾ç‰‡æ•°æ® http://pic.netbian.com/4kmeinv/</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    url = <span class="string">&#x27;http://pic.netbian.com/4kmeinv/&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="comment"># æ‰‹åŠ¨è®¾å®šå“åº”æ•°æ®çš„ç¼–ç æ ¼å¼</span></span><br><span class="line">    <span class="comment"># response.encoding = &#x27;utf-8&#x27;</span></span><br><span class="line">    page_text = response.text</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ•°æ®è§£æï¼šsrcçš„å±æ€§å€¼  altå±æ€§</span></span><br><span class="line">    tree = etree.HTML(page_text)</span><br><span class="line">    li_list = tree.xpath(<span class="string">&#x27;//div[@class=&quot;slist&quot;]/ul/li&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./picLibs&#x27;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&#x27;./picLibs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">        img_src = <span class="string">&#x27;http://pic.netbian.com&#x27;</span>+li.xpath(<span class="string">&#x27;./a/img/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        img_name = li.xpath(<span class="string">&#x27;./a/img/@alt&#x27;</span>)[<span class="number">0</span>]+<span class="string">&#x27;.jpg&#x27;</span></span><br><span class="line">        <span class="comment">#é€šç”¨å¤„ç†ä¸­æ–‡ä¹±ç çš„è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">        img_name = img_name.encode(<span class="string">&#x27;iso-8859-1&#x27;</span>).decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(img_name,img_src)</span></span><br><span class="line">        <span class="comment"># è¯·æ±‚å›¾ç‰‡è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">        img_data = requests.get(url=img_src, headers=headers).content</span><br><span class="line">        img_path = <span class="string">&#x27;picLibs/&#x27;</span>+img_name</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(img_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            fp.write(img_data)</span><br><span class="line">            <span class="built_in">print</span>(img_name, <span class="string">&#x27;ä¸‹è½½æˆåŠŸï¼ï¼ï¼&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------OVER!---------------------------------&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ2ï¼‰å…¨å›½åŸå¸‚åç§°çˆ¬å–"><a href="#ï¼ˆ2ï¼‰å…¨å›½åŸå¸‚åç§°çˆ¬å–" class="headerlink" title="ï¼ˆ2ï¼‰å…¨å›½åŸå¸‚åç§°çˆ¬å–"></a>ï¼ˆ2ï¼‰å…¨å›½åŸå¸‚åç§°çˆ¬å–</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€æ±‚ï¼šè§£æå‡ºæ‰€æœ‰åŸå¸‚åç§°  https://www.aqistudy.cn/historydata/</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;headers = &#123;</span></span><br><span class="line"><span class="string">    &#x27;User-Agent&#x27;:&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    url = &#x27;https://www.aqistudy.cn/historydata/&#x27;</span></span><br><span class="line"><span class="string">    page_text = requests.get(url=url,headers=headers).text</span></span><br><span class="line"><span class="string">    tree = etree.HTML(page_text)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    #æ•°æ®è§£æ</span></span><br><span class="line"><span class="string">    hot_li_list = tree.xpath(&#x27;//div[@class=&quot;bottom&quot;]/ul/li&#x27;)</span></span><br><span class="line"><span class="string">    all_city_names = []</span></span><br><span class="line"><span class="string">    #è§£æçƒ­é—¨åŸå¸‚åå­—</span></span><br><span class="line"><span class="string">    for li in hot_li_list:</span></span><br><span class="line"><span class="string">        hot_city_names = li.xpath(&#x27;./a/text()&#x27;)[0]</span></span><br><span class="line"><span class="string">        all_city_names.append(hot_city_names)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    #è§£æå…¨éƒ¨åŸå¸‚åå­—ï¼š</span></span><br><span class="line"><span class="string">    city_names_list = tree.xpath(&#x27;.//div[@class=&quot;bottom&quot;]/ul/div[2]/li&#x27;)</span></span><br><span class="line"><span class="string">    for li in city_names_list:</span></span><br><span class="line"><span class="string">        city_name = li.xpath(&#x27;./a/text()&#x27;)[0]</span></span><br><span class="line"><span class="string">        all_city_names.append(city_name)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    print(all_city_names,len(all_city_names))&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç¬¬äºŒç§æ–¹æ³•ï¼Œä¸€èµ·è§£æ</span></span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">&#x27;https://www.aqistudy.cn/historydata/&#x27;</span></span><br><span class="line">    page_text = requests.get(url=url, headers=headers).text</span><br><span class="line"></span><br><span class="line">    tree = etree.HTML(page_text)</span><br><span class="line">    <span class="comment"># æ•°æ®è§£æ  è§£æåˆ°çƒ­é—¨åŸå¸‚å’Œå…¨éƒ¨åŸå¸‚å¯¹åº”çš„aæ ‡ç­¾</span></span><br><span class="line">    <span class="comment"># çƒ­é—¨åŸå¸‚æ ‡ç­¾å±‚çº§div/ul/li/a</span></span><br><span class="line">    <span class="comment"># å…¨éƒ¨åŸå¸‚æ ‡ç­¾å±‚çº§div/ul/div[2]/li/a</span></span><br><span class="line">    a_list = tree.xpath(<span class="string">&#x27;//div[@class=&quot;bottom&quot;]/ul/li/a | //div[@class=&quot;bottom&quot;]/ul/div[2]/li/a &#x27;</span>)</span><br><span class="line">    all_city_names = []</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> a_list:</span><br><span class="line">        a_name = a.xpath(<span class="string">&#x27;./text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">        all_city_names.append(a_name)</span><br><span class="line">    <span class="built_in">print</span>(all_city_names, <span class="built_in">len</span>(all_city_names))</span><br></pre></td></tr></table></figure>

<h2 id="10-xpathä½œä¸šâ€”çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹ç®€å†æ¨¡æ¿"><a href="#10-xpathä½œä¸šâ€”çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹ç®€å†æ¨¡æ¿" class="headerlink" title="10. xpathä½œä¸šâ€”çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹ç®€å†æ¨¡æ¿"></a>10. xpathä½œä¸šâ€”çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹ç®€å†æ¨¡æ¿</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹çš„ç®€å†æ¨¡æ¿  https://sc.chinaz.com/jianli/free.html</span></span><br><span class="line"><span class="comment"># ä»£ç å‚è€ƒï¼šhttps://blog.csdn.net/nanke_nk/article/details/108966854</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./jianli&#x27;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&#x27;./jianli&#x27;</span>)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    url = <span class="string">&#x27;https://sc.chinaz.com/jianli/free_%d.html&#x27;</span></span><br><span class="line">    page = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;æ‚¨ä¸€å…±æƒ³è¦çˆ¬å–å¤šå°‘é¡µï¼š&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> pageNum <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, page):</span><br><span class="line">        <span class="keyword">if</span> pageNum == <span class="number">1</span>:</span><br><span class="line">            new_url = <span class="string">&#x27;https://sc.chinaz.com/jianli/free.html&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new_url = <span class="built_in">format</span>(url%pageNum)</span><br><span class="line">        page_text = requests.get(url = new_url, headers = headers).text</span><br><span class="line">        tree = etree.HTML(page_text)</span><br><span class="line">        url_div_list = tree.xpath(<span class="string">&#x27;//*[@id=&quot;container&quot;]/div&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> detail_url <span class="keyword">in</span> url_div_list:</span><br><span class="line">            detail_url = <span class="string">&#x27;https:&#x27;</span> + detail_url.xpath(<span class="string">&#x27;./a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">            detail_page_text = requests.get(url = detail_url, headers =headers).text</span><br><span class="line">            tree = etree.HTML(detail_page_text)</span><br><span class="line">            name = tree.xpath(<span class="string">&#x27;//h1/text()&#x27;</span>)[<span class="number">0</span>].encode(<span class="string">&#x27;iso-8859-1&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            download_url = tree.xpath(<span class="string">&#x27;//*[@id=&quot;down&quot;]/div[2]/ul/li[1]/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            file_path = <span class="string">&#x27;jianli/&#x27;</span> + name + <span class="string">&#x27;.rar&#x27;</span></span><br><span class="line">            download_content = requests.get(url = download_url, headers = headers).content</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                fp.write(download_content)</span><br><span class="line">            <span class="built_in">print</span>(name, <span class="string">&#x27;ä¸‹è½½å®Œæˆ&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-------------------------------OVER!---------------------------------------&#x27;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å››ã€éªŒè¯ç "><a href="#å››ã€éªŒè¯ç " class="headerlink" title="å››ã€éªŒè¯ç "></a>å››ã€éªŒè¯ç </h1><h2 id="1-éªŒè¯ç è¯†åˆ«ç®€ä»‹"><a href="#1-éªŒè¯ç è¯†åˆ«ç®€ä»‹" class="headerlink" title="1. éªŒè¯ç è¯†åˆ«ç®€ä»‹"></a>1. éªŒè¯ç è¯†åˆ«ç®€ä»‹</h2><p><strong>éªŒè¯ç å’Œçˆ¬è™«ä¹‹é—´çš„çˆ±æ¨æƒ…ä»‡ï¼š</strong></p>
<ul>
<li>åçˆ¬æœºåˆ¶ï¼šéªŒè¯ç ã€‚è¯†åˆ«éªŒè¯ç å›¾ç‰‡ä¸­çš„æ•°æ®ï¼Œç”¨äºæ¨¡æ‹Ÿç™»å½•æ“ä½œã€‚</li>
</ul>
<p><strong>è¯†åˆ«éªŒè¯ç çš„æ“ä½œï¼š</strong></p>
<ul>
<li>äººå·¥è‚‰çœ¼è¯†åˆ«ï¼ˆä¸æ¨èï¼‰</li>
<li>ç¬¬ä¸‰æ–¹è‡ªåŠ¨è¯†åˆ«ï¼ˆæ¨èï¼‰</li>
</ul>
<h2 id="2-äº‘æ‰“ç ä½¿ç”¨æµç¨‹"><a href="#2-äº‘æ‰“ç ä½¿ç”¨æµç¨‹" class="headerlink" title="2. äº‘æ‰“ç ä½¿ç”¨æµç¨‹"></a>2. äº‘æ‰“ç ä½¿ç”¨æµç¨‹</h2><!--ä½œè€…å­¦ä¹ æœŸé—´ï¼Œè¯¥å¹³å°å·²ç»æŒ‚æ‰ï¼Œæ•…è€Œä½¿ç”¨è¶…çº§é¹°è¿›è¡Œä»£æ›¿ã€‚åŒç±»æ‰“ç å¹³å°å¯ä»¥è‡ªè¡Œç™¾åº¦é€‰æ‹©-->

<ul>
<li>æ³¨å†Œï¼šç”¨æˆ·ä¸­å¿ƒèº«ä»½</li>
<li>ç™»å½•ï¼šç”¨æˆ·ä¸­å¿ƒèº«ä»½<ul>
<li>æŸ¥è¯¢ä½™é¢ï¼Œé¢˜åˆ†æ˜¯å¦è¶³å¤Ÿï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œç»‘å®šå¾®ä¿¡å³å¯å…è´¹è·èµ 1000é¢˜åˆ†ï¼›éé¦–æ¬¡ä½¿ç”¨ï¼Œå»ºè®®å°é¢å……å€¼ï¼Œ1å…ƒå³å¯ï¼‰</li>
<li>åˆ›å»ºè½¯ä»¶IDâ€”â€”ç”¨æˆ·ä¸­å¿ƒå·¦ä¸‹è§’</li>
<li>ä¸‹è½½ç¤ºä¾‹ä»£ç  â€”â€”å¼€å‘æ–‡æ¡£</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chaojiying_Client</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password, soft_id</span>):</span><br><span class="line">		self.username = username</span><br><span class="line">		password =  password.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">		self.password = md5(password).hexdigest()</span><br><span class="line">		self.soft_id = soft_id</span><br><span class="line">		self.base_params = &#123;</span><br><span class="line">			<span class="string">&#x27;user&#x27;</span>: self.username,</span><br><span class="line">			<span class="string">&#x27;pass2&#x27;</span>: self.password,</span><br><span class="line">			<span class="string">&#x27;softid&#x27;</span>: self.soft_id,</span><br><span class="line">		&#125;</span><br><span class="line">		self.headers = &#123;</span><br><span class="line">			<span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;Keep-Alive&#x27;</span>,</span><br><span class="line">			<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)&#x27;</span>,</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">PostPic</span>(<span class="params">self, im, codetype</span>):</span><br><span class="line">		<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">		im: å›¾ç‰‡å­—èŠ‚</span></span><br><span class="line"><span class="string">		codetype: é¢˜ç›®ç±»å‹ å‚è€ƒ http://www.chaojiying.com/price.html</span></span><br><span class="line"><span class="string">		&quot;&quot;&quot;</span></span><br><span class="line">		params = &#123;</span><br><span class="line">			<span class="string">&#x27;codetype&#x27;</span>: codetype,</span><br><span class="line">		&#125;</span><br><span class="line">		params.update(self.base_params)</span><br><span class="line">		files = &#123;<span class="string">&#x27;userfile&#x27;</span>: (<span class="string">&#x27;ccc.jpg&#x27;</span>, im)&#125;</span><br><span class="line">		r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/Processing.php&#x27;</span>, data=params, files=files, headers=self.headers)</span><br><span class="line">		<span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">def</span> <span class="title function_">ReportError</span>(<span class="params">self, im_id</span>):</span><br><span class="line">		<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">		im_id:æŠ¥é”™é¢˜ç›®çš„å›¾ç‰‡ID</span></span><br><span class="line"><span class="string">		&quot;&quot;&quot;</span></span><br><span class="line">		params = &#123;</span><br><span class="line">			<span class="string">&#x27;id&#x27;</span>: im_id,</span><br><span class="line">		&#125;</span><br><span class="line">		params.update(self.base_params)</span><br><span class="line">		r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/ReportError.php&#x27;</span>, data=params, headers=self.headers)</span><br><span class="line">		<span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tranformImgCode</span>(<span class="params">imgPath,imgType</span>):</span><br><span class="line">	chaojiying = Chaojiying_Client(<span class="string">&#x27;æ­¤å¤„æ˜¯è´¦æˆ·&#x27;</span>, <span class="string">&#x27;æ­¤å¤„æ˜¯å¯†ç &#x27;</span>, <span class="string">&#x27;æ­¤å¤„æ˜¯è½¯ä»¶ID&#x27;</span>)	<span class="comment">#ç”¨æˆ·ä¸­å¿ƒ&gt;&gt;è½¯ä»¶ID ç”Ÿæˆä¸€ä¸ªæ›¿æ¢ </span></span><br><span class="line">	im = <span class="built_in">open</span>(imgPath, <span class="string">&#x27;rb&#x27;</span>).read()	</span><br><span class="line">	<span class="keyword">return</span> chaojiying.PostPic(im,imgType)[<span class="string">&#x27;pic_str&#x27;</span>]	<span class="comment">#1902 éªŒè¯ç ç±»å‹  å®˜æ–¹ç½‘ç«™&gt;&gt;ä»·æ ¼ä½“ç³» 3.4+ç‰ˆ </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tranformImgCode(<span class="string">&#x27;./a.jpg&#x27;</span>,<span class="number">1902</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-å¤è¯—æ–‡ç½‘éªŒè¯ç è¯†åˆ«"><a href="#3-å¤è¯—æ–‡ç½‘éªŒè¯ç è¯†åˆ«" class="headerlink" title="3. å¤è¯—æ–‡ç½‘éªŒè¯ç è¯†åˆ«"></a>3. å¤è¯—æ–‡ç½‘éªŒè¯ç è¯†åˆ«</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####å°†æœ¬éƒ¨åˆ†ä»£ç å¤åˆ¶åˆ°ä¸Šä¸€èŠ‚ä»£ç ä¹‹åï¼Œå› ä¸ºè¦è°ƒç”¨ä¸Šè¿°å°è£…çš„tranformImgCodeæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯†åˆ«éªŒè¯ç å›¾ä¸‹è½½</span></span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;https://so.gushiwen.cn/user/login.aspx?from=http://so.gushiwen.cn/user/collect.aspx&#x27;</span></span><br><span class="line">page_text = session.get(url=url, headers=headers).text</span><br><span class="line"><span class="comment"># è§£æéªŒè¯ç å›¾ç‰‡çš„åœ°å€</span></span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">img_src = <span class="string">&#x27;https://so.gushiwen.org&#x27;</span> + tree.xpath(<span class="string">&#x27;//*[@id=&quot;imgCode&quot;]/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># å°†éªŒè¯ç å›¾ç‰‡ä¿å­˜æœ¬åœ°</span></span><br><span class="line">img_data = session.get(img_src, headers=headers).content</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./code.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">	fp.write(img_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯†åˆ«éªŒè¯ç </span></span><br><span class="line">code_text = tranformImgCode(<span class="string">&#x27;./code.jpg&#x27;</span>, <span class="number">1902</span>)</span><br><span class="line"><span class="built_in">print</span>(code_text)</span><br><span class="line">login_url = <span class="string">&#x27;https://so.gushiwen.cn/user/login.aspx?from=http%3a%2f%2fso.gushiwen.cn%2fuser%2fcollect.aspx&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">	<span class="string">&#x27;__VIEWSTATE&#x27;</span>: <span class="string">&#x27;f1ECt6+6MPtdTZMJtYOYS/7ww2d/DPy9t8JQcIt1QuOneLTbNQuYqPcCjZNbDAbfb9vj3k6f0M7EKTf0YqElM1k1A5ELwyTvUzBii+9LDRBbIMmc/jb0DJPsYfI=&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;__VIEWSTATEGENERATOR&#x27;</span>: <span class="string">&#x27;C93BE1AE&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;from&#x27;</span>: <span class="string">&#x27;http://so.gushiwen.cn/user/collect.aspx&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;è´¦å·&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;pwd&#x27;</span>: <span class="string">&#x27;å¯†ç &#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;code&#x27;</span>: code_text,  <span class="comment"># åŠ¨æ€å˜åŒ–</span></span><br><span class="line">	<span class="string">&#x27;denglu&#x27;</span>: <span class="string">&#x27;ç™»å½•&#x27;</span>,</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment"># å¯¹ç‚¹å‡»ç™»å½•æŒ‰é’®å‘èµ·è¯·æ±‚</span></span><br><span class="line">page_text_login = session.post(url=login_url, headers=headers, data=data).text</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./gushiwen.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">	fp.write(page_text_login)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åœ¨è¯·æ±‚å‚æ•°ä¸­å¦‚æœçœ‹åˆ°äº†ä¸€ç»„ä¹±åºçš„è¯·æ±‚å‚æ•°ï¼Œæœ€å¥½å»éªŒè¯è¿™ç»„è¯·æ±‚å‚æ•°æ˜¯å¦ä¸ºåŠ¨æ€å˜åŒ–</p>
<ul>
<li>å¤„ç†ï¼š<ul>
<li>æ–¹å¼1ï¼šå¸¸è§„æ¥è®²ä¸€èˆ¬åŠ¨æ€å˜åŒ–çš„è¯·æ±‚å‚æ•°ä¼šè¢«éšè—åœ¨å‰å°é¡µé¢ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦å»å‰å°é¡µé¢æºç ä¸­å¯»æ‰¾ï¼›</li>
<li>æ–¹å¼2ï¼šå¦‚æœå‰å°é¡µé¢æ²¡æœ‰çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŸºäºæŠ“åŒ…å·¥å…·è¿›è¡Œå…¨å±€æœç´¢ã€‚</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>åŸºäºç™¾åº¦AIå®ç°çš„çˆ¬è™«ç»™åŠŸèƒ½ï¼š</strong></p>
<ul>
<li>å›¾åƒè¯†åˆ«</li>
<li>è¯­éŸ³è¯†åˆ«&amp;åˆæˆ</li>
<li>è‡ªç„¶è¯­è¨€å¤„ç†</li>
</ul>
</li>
<li><p><strong>ä½¿ç”¨æµç¨‹ï¼š</strong></p>
<ul>
<li><p>ç‚¹å‡»æ§åˆ¶å°è¿›è¡Œç™»å½•</p>
</li>
<li><p>é€‰æ‹©æƒ³è¦å®ç°çš„åŠŸèƒ½</p>
</li>
<li><p>å®ç°åŠŸèƒ½ä¸‹åˆ›å»ºä¸€ä¸ªapp</p>
</li>
<li><p>é€‰æ‹©å¯¹åº”çš„ pythonSDK æ–‡æ¡£è¿›è¡Œä»£ç å®ç°</p>
<blockquote>
<p>éœ€æ±‚ï¼š<a target="_blank" rel="noopener" href="https://duanziwang.com/">https://duanziwang.com/</a></p>
<p>è®²æ®µå­ç‹ä¸­çš„æ®µå­å†…å®¹çˆ¬å–åˆ°æœ¬åœ°ï¼Œç„¶ååŸºäºè¯­éŸ³åˆæˆä¸ºmp3çš„éŸ³é¢‘æ–‡ä»¶ï¼Œç„¶åè‡ªå·±æ­å»ºä¸€ä¸ªwebæœåŠ¡å™¨ï¼Œçº¿ä¸Šå®æ—¶æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="äº”ã€requestsæ¨¡å—é«˜çº§"><a href="#äº”ã€requestsæ¨¡å—é«˜çº§" class="headerlink" title="äº”ã€requestsæ¨¡å—é«˜çº§"></a>äº”ã€requestsæ¨¡å—é«˜çº§</h1><h2 id="1-æ¨¡æ‹Ÿç™»å½•å®ç°æµç¨‹æ¢³ç†"><a href="#1-æ¨¡æ‹Ÿç™»å½•å®ç°æµç¨‹æ¢³ç†" class="headerlink" title="1. æ¨¡æ‹Ÿç™»å½•å®ç°æµç¨‹æ¢³ç†"></a>1. æ¨¡æ‹Ÿç™»å½•å®ç°æµç¨‹æ¢³ç†</h2><p><strong>æ¨¡æ‹Ÿç™»å½•ï¼š</strong>çˆ¬å–åŸºäºæŸäº›ç”¨æˆ·çš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p><strong>éœ€æ±‚ï¼š</strong>å¯¹äººäººç½‘è¿›è¡Œæ¨¡æ‹Ÿç™»å½•</p>
<ul>
<li>ç‚¹å‡»ç™»å½•æŒ‰é’®åä¼šå‘èµ·ä¸€ä¸ªpostè¯·æ±‚</li>
<li>postè¯·æ±‚ä¸­ä¼šæºå¸¦ç™»é™†ä¹‹å‰å½•å…¥çš„ç›¸å…³çš„ç™»å½•ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ã€éªŒè¯ç â€¦â€¦.ï¼‰</li>
<li>éªŒè¯ç ï¼šæ¯æ¬¡è¯·æ±‚éƒ½ä¼šåŠ¨æ€å˜åŒ–</li>
</ul>
<h2 id="2-äººäººç½‘æ¨¡æ‹Ÿç™»å½•"><a href="#2-äººäººç½‘æ¨¡æ‹Ÿç™»å½•" class="headerlink" title="2. äººäººç½‘æ¨¡æ‹Ÿç™»å½•"></a>2. äººäººç½‘æ¨¡æ‹Ÿç™»å½•</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. éªŒè¯ç çš„è¯†åˆ«,è·å–éªŒè¯ç å›¾ç‰‡çš„æ–‡å­—æ•°æ®</span></span><br><span class="line"><span class="comment">#2. å¯¹postè¯·æ±‚è¿›è¡Œå‘é€</span></span><br><span class="line"><span class="comment">#3. å¯¹å“åº”æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">url = <span class="string">&#x27;http://www.renren.com/SysHome.do&#x27;</span></span><br><span class="line">page_text = response.get(url = url,headers = headers).text</span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">code_img_src = tree.xpath(<span class="string">&#x27;//*[@id=&quot;verifyPic_login&quot;]/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">code_img_data = requests.get(url = code_img_src,headers = headers).content</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./code.jpg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(code_img_data)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#ä¸‹é¢éœ€è¦ä½¿ç”¨æ‰“ç å¹³å°æä¾›çš„ç¤ºä¾‹ä»£ç è¿›è¡Œè¯†åˆ«ï¼Œäº‘æ‰“ç å¹³å°å·²æŒ‚</span></span><br><span class="line"><span class="comment">######äº†è§£è§†é¢‘ä»£ç ä½¿ç”¨æ€è·¯å³å¯ï¼Œå¯è‡ªè¡Œä½¿ç”¨å…¶ä»–æ‰“ç å¹³å°å®ç°æ“ä½œï¼Œ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#postè¯·æ±‚å‘é€</span></span><br><span class="line">login_url = <span class="string">&#x27; &#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url = login_url,headers = headers,data = data)</span><br><span class="line"><span class="built_in">print</span>(response.satus_code)</span><br><span class="line"></span><br><span class="line"><span class="comment">#login_page_text = response.text</span></span><br><span class="line"><span class="comment">#with open(&#x27;renren.html&#x27;,&#x27;w&#x27;,encoding = &#x27;utf-8&#x27;) #as fp:</span></span><br><span class="line">    fp.write(login_page_text)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;è§†é¢‘UPä¸»çš„æºä»£ç &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¼–ç æµç¨‹ï¼š</span></span><br><span class="line"><span class="comment">#1.éªŒè¯ç çš„è¯†åˆ«ï¼Œè·å–éªŒè¯ç å›¾ç‰‡çš„æ–‡å­—æ•°æ®</span></span><br><span class="line"><span class="comment">#2.å¯¹postè¯·æ±‚è¿›è¡Œå‘é€ï¼ˆå¤„ç†è¯·æ±‚å‚æ•°ï¼‰</span></span><br><span class="line"><span class="comment">#3.å¯¹å“åº”æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> CodeClass <span class="keyword">import</span> YDMHttp</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="comment">#å°è£…è¯†åˆ«éªŒè¯ç å›¾ç‰‡çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getCodeText</span>(<span class="params">imgPath,codeType</span>):</span><br><span class="line">    <span class="comment"># æ™®é€šç”¨æˆ·ç”¨æˆ·å</span></span><br><span class="line">    username = <span class="string">&#x27;bobo328410948&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ™®é€šç”¨æˆ·å¯†ç </span></span><br><span class="line">    password = <span class="string">&#x27;bobo328410948&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è½¯ä»¶ï¼©ï¼¤ï¼Œå¼€å‘è€…åˆ†æˆå¿…è¦å‚æ•°ã€‚ç™»å½•å¼€å‘è€…åå°ã€æˆ‘çš„è½¯ä»¶ã€‘è·å¾—ï¼</span></span><br><span class="line">    appid = <span class="number">6003</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è½¯ä»¶å¯†é’¥ï¼Œå¼€å‘è€…åˆ†æˆå¿…è¦å‚æ•°ã€‚ç™»å½•å¼€å‘è€…åå°ã€æˆ‘çš„è½¯ä»¶ã€‘è·å¾—ï¼</span></span><br><span class="line">    appkey = <span class="string">&#x27;1f4b564483ae5c907a1d34f8e2f2776c&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å›¾ç‰‡æ–‡ä»¶ï¼šå³å°†è¢«è¯†åˆ«çš„éªŒè¯ç å›¾ç‰‡çš„è·¯å¾„</span></span><br><span class="line">    filename = imgPath</span><br><span class="line"></span><br><span class="line">    <span class="comment"># éªŒè¯ç ç±»å‹ï¼Œ# ä¾‹ï¼š1004è¡¨ç¤º4ä½å­—æ¯æ•°å­—ï¼Œä¸åŒç±»å‹æ”¶è´¹ä¸åŒã€‚è¯·å‡†ç¡®å¡«å†™ï¼Œå¦åˆ™å½±å“è¯†åˆ«ç‡ã€‚åœ¨æ­¤æŸ¥è¯¢æ‰€æœ‰ç±»å‹ http://www.yundama.com/price.html</span></span><br><span class="line">    codetype = codeType</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¶…æ—¶æ—¶é—´ï¼Œç§’</span></span><br><span class="line">    timeout = <span class="number">20</span></span><br><span class="line">    result = <span class="literal">None</span></span><br><span class="line">    <span class="comment"># æ£€æŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (username == <span class="string">&#x27;username&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;è¯·è®¾ç½®å¥½ç›¸å…³å‚æ•°å†æµ‹è¯•&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–</span></span><br><span class="line">        yundama = YDMHttp(username, password, appid, appkey)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç™»é™†äº‘æ‰“ç </span></span><br><span class="line">        uid = yundama.login();</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;uid: %s&#x27;</span> % uid)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢ä½™é¢</span></span><br><span class="line">        balance = yundama.balance();</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;balance: %s&#x27;</span> % balance)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¼€å§‹è¯†åˆ«ï¼Œå›¾ç‰‡è·¯å¾„ï¼ŒéªŒè¯ç ç±»å‹IDï¼Œè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¯†åˆ«ç»“æœ</span></span><br><span class="line">        cid, result = yundama.decode(filename, codetype, timeout);</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;cid: %s, result: %s&#x27;</span> % (cid, result))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#1.å¯¹éªŒè¯ç å›¾ç‰‡è¿›è¡Œæ•è·å’Œè¯†åˆ«</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&#x27;http://www.renren.com/SysHome.do&#x27;</span></span><br><span class="line">page_text = requests.get(url=url,headers=headers).text</span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">code_img_src = tree.xpath(<span class="string">&#x27;//*[@id=&quot;verifyPic_login&quot;]/@src&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">code_img_data = requests.get(url=code_img_src,headers=headers).content</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;./code.jpg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(code_img_data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨äº‘æ‰“ç æä¾›çš„ç¤ºä¾‹ä»£ç å¯¹éªŒè¯ç å›¾ç‰‡è¿›è¡Œè¯†åˆ«</span></span><br><span class="line">result = getCodeText(<span class="string">&#x27;code.jpg&#x27;</span>,<span class="number">1000</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#postè¯·æ±‚çš„å‘é€ï¼ˆæ¨¡æ‹Ÿç™»å½•ï¼‰</span></span><br><span class="line">login_url = <span class="string">&#x27;http://www.renren.com/ajaxLogin/login?1=1&amp;uniqueTimestamp=2019431046983&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;www.zhangbowudi@qq.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;icode&#x27;</span>: result,</span><br><span class="line">    <span class="string">&#x27;origURL&#x27;</span>: <span class="string">&#x27;http://www.renren.com/home&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;domain&#x27;</span>: <span class="string">&#x27;renren.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;key_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;captcha_type&#x27;</span>: <span class="string">&#x27;web_login&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;06768edabba49f5f6b762240b311ae5bfa4bcce70627231dd1f08b9c7c6f4375&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rkey&#x27;</span>: <span class="string">&#x27;1028219f2897941c98abdc0839a729df&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>:<span class="string">&#x27;https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3Dgds6TUs9Q1ojOatGda5mVsLKC34AYwc5XiN8OuImHRK%26wd%3D%26eqid%3D8e38ba9300429d7d000000035cedf53a&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url=login_url,headers=headers,data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># login_page_text = response.text</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># with open(&#x27;renren.html&#x27;,&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;) as fp:</span></span><br><span class="line"><span class="comment">#     fp.write(login_page_text)</span></span><br></pre></td></tr></table></figure>

<h2 id="3-æ¨¡æ‹Ÿç™»å½•cookieæ“ä½œ"><a href="#3-æ¨¡æ‹Ÿç™»å½•cookieæ“ä½œ" class="headerlink" title="3. æ¨¡æ‹Ÿç™»å½•cookieæ“ä½œ"></a>3. æ¨¡æ‹Ÿç™»å½•cookieæ“ä½œ</h2><ul>
<li><p><strong>éœ€æ±‚ï¼š</strong>çˆ¬å–å½“å‰ç”¨æˆ·çš„ç›¸å…³ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸ªäººä¸»é¡µä¸­æ˜¾ç¤ºçš„ç”¨æˆ·ä¿¡æ¯ï¼‰</p>
</li>
<li><p><strong>http&#x2F;httpsåè®®ï¼š</strong>æ— çŠ¶æ€ã€‚</p>
<p>  æ²¡æœ‰è¯·æ±‚åˆ°å¯¹åº”é¡µé¢æ•°æ®çš„åŸå› ï¼šå‘èµ·çš„ç¬¬äºŒæ¬¡åŸºäºä¸ªäººä¸»é¡µé¡µé¢è¯·æ±‚çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å¹¶ä¸çŸ¥é“è¯¥æ¬¡è¯·æ±‚æ˜¯åŸºäºç™»å½•çŠ¶æ€ä¸‹çš„è¯·æ±‚ã€‚</p>
</li>
<li><p><strong>cookieï¼š</strong>ç”¨æ¥è®©æœåŠ¡å™¨ç«¯è®°å½•å®¢æˆ·ç«¯çš„ç›¸å…³çŠ¶æ€</p>
<ul>
<li><p>æ‰‹åŠ¨å¤„ç†ï¼šæŠ“åŒ…å·¥å…·è·å– <code>Cookie</code> å€¼ï¼Œå°†å€¼å°è£…åˆ° <code>headers</code> ä¸­ï¼ˆä¸æ¨èï¼‰</p>
</li>
<li><p>è‡ªåŠ¨å¤„ç†ï¼š</p>
<p>  <code>Cookie</code> å€¼çš„æ¥æºæ˜¯å“ªé‡Œï¼Ÿæ¨¡æ‹Ÿç™»å½• <code>post</code> è¯·æ±‚åï¼Œç”±æœåŠ¡å™¨ç«¯åˆ›å»ºçš„ã€‚</p>
<p>  <code>session</code>ä¼šè¯å¯¹è±¡ï¼š1. å¯ä»¥è¿›è¡Œè¯·æ±‚çš„å‘é€ï¼›2. å¦‚æœè¯·æ±‚è¿‡ç¨‹ä¸­äº§ç”Ÿäº†Cookieï¼Œåˆ™è¯¥Cookieä¼šè¢«è‡ªåŠ¨å­˜å‚¨&#x2F;æºå¸¦åœ¨è¯¥sessionå¯¹è±¡ä¸­ã€‚</p>
<p>  åˆ›å»ºä¸€ä¸ª<strong>session</strong>å¯¹è±¡ï¼š<code>session = requests.Session( )</code></p>
<p>  ä½¿ç”¨<strong>session</strong>å¯¹è±¡è¿›è¡Œæ¨¡æ‹Ÿç™»å½•<code>post</code>è¯·æ±‚çš„å‘é€ï¼ˆCookieä¼šè¢«å­˜å‚¨åœ¨sessionä¸­ï¼‰</p>
<p>  <strong>session</strong>å¯¹è±¡å¯¹ä¸ªäººä¸»é¡µå¯¹åº”çš„getè¯·æ±‚è¿›è¡Œå‘é€ï¼ˆæºå¸¦äº†Cookieï¼‰</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#####åŸºäºå‰ä¸€èŠ‚ä»£ç ä¹‹ä¸Š####</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment">#çˆ¬å–å½“å‰ç”¨æˆ·çš„ç›¸å…³ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;æ‰‹åŠ¨è·å–Cookieï¼ˆä¸æ¨èï¼‰ headers = &#123;</span></span><br><span class="line"><span class="string">   â€˜&#x27;Cookie&#x27;:&#x27;xxxx&#x27;</span></span><br><span class="line"><span class="string">    &#125;&#x27;&#x27;&#x27;</span></span><br><span class="line">detail_url = <span class="string">&#x27;http://www.renren.com/976279344/profile&#x27;</span></span><br><span class="line">detail_page_test = session.get(url = detail_url,headers = headers).text</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;bobo.html&#x27;</span>,<span class="string">&#x27;w&#x27;</span>,encoding = <span class="string">&#x27;utf-8&#x27;</span> ) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(detail_page_test)</span><br></pre></td></tr></table></figure>

<h2 id="4-ä»£ç†ç†è®ºè®²è§£"><a href="#4-ä»£ç†ç†è®ºè®²è§£" class="headerlink" title="4. ä»£ç†ç†è®ºè®²è§£"></a>4. ä»£ç†ç†è®ºè®²è§£</h2><ul>
<li><strong>ä»£ç†ï¼š</strong>ç ´è§£å° IP è¿™ç§åçˆ¬æœºåˆ¶ã€‚</li>
<li><strong>ä»€ä¹ˆæ˜¯ä»£ç†ï¼Ÿ</strong>ä»£ç†æœåŠ¡å™¨ã€‚</li>
<li><strong>ä»£ç†çš„ä½œç”¨ï¼š</strong><ul>
<li>çªç ´è‡ªèº« IP è¢«è®¿é—®çš„é™åˆ¶</li>
<li>å¯ä»¥éšè—è‡ªèº«çœŸå®çš„ IPï¼Œå…å—æ”»å‡»</li>
</ul>
</li>
<li><strong>ç›¸å…³ç½‘ç«™ï¼š</strong><ul>
<li><a target="_blank" rel="noopener" href="https://www.kuaidaili.com/">å¿«ä»£ç†</a></li>
<li>è¥¿ç¥ ä»£ç†</li>
<li><a target="_blank" rel="noopener" href="http://www.goubanjia.com/">www.goubanjia.com</a></li>
</ul>
</li>
<li><strong>ä»£ç† ip çš„ç±»å‹ï¼š</strong><ul>
<li>httpï¼šåªèƒ½åº”ç”¨åˆ° http åè®®å¯¹åº”çš„ url ä¸­</li>
<li>httpsï¼šåªèƒ½åº”ç”¨åˆ° https åè®®å¯¹åº”çš„ url ä¸­</li>
</ul>
</li>
<li><strong>ä»£ç†ipçš„åŒ¿ååº¦ï¼š</strong><ul>
<li>é€æ˜ï¼šæœåŠ¡å™¨çŸ¥é“è¯¥æ¬¡è¯·æ±‚ä½¿ç”¨äº†ä»£ç†ï¼Œä¹ŸçŸ¥é“è¯·æ±‚å¯¹åº”çš„çœŸå® ip</li>
<li>åŒ¿åï¼šçŸ¥é“ä½¿ç”¨äº†ä»£ç†ï¼Œä¸çŸ¥é“çœŸå® ip</li>
<li>é«˜åŒ¿ï¼šä¸çŸ¥é“ä½¿ç”¨äº†ä»£ç†ï¼Œä¹Ÿä¸çŸ¥é“çœŸå® ip</li>
</ul>
</li>
</ul>
<h2 id="5-ä»£ç†åœ¨çˆ¬è™«ä¸­çš„åº”ç”¨"><a href="#5-ä»£ç†åœ¨çˆ¬è™«ä¸­çš„åº”ç”¨" class="headerlink" title="5. ä»£ç†åœ¨çˆ¬è™«ä¸­çš„åº”ç”¨"></a>5. ä»£ç†åœ¨çˆ¬è™«ä¸­çš„åº”ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://www.baidu.com/s?wd=ip&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">page_text = requests.get(url = url, headers = headers, proxies = &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://124.205.155.153:9090&quot;</span>&#125;).text</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ip.html&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding = <span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    fp.write(page_text)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å…­ã€é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«"><a href="#å…­ã€é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«" class="headerlink" title="å…­ã€é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«"></a>å…­ã€é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«</h1><h2 id="1-å¼‚æ­¥çˆ¬è™«æ¦‚è¿°"><a href="#1-å¼‚æ­¥çˆ¬è™«æ¦‚è¿°" class="headerlink" title="1. å¼‚æ­¥çˆ¬è™«æ¦‚è¿°"></a>1. å¼‚æ­¥çˆ¬è™«æ¦‚è¿°</h2><ul>
<li><p><strong>åŒæ­¥ï¼š</strong>ä¸åŒç¨‹åºå•å…ƒä¸ºäº†å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€é æŸç§é€šä¿¡æ–¹å¼ä»¥åè°ƒä¸€è‡´ï¼Œç§°è¿™äº›ç¨‹åºå•å…ƒæ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚ ä¾‹å¦‚è´­ç‰©ç³»ç»Ÿä¸­æ›´æ–°å•†å“åº“å­˜ï¼Œéœ€è¦ç”¨ â€œè¡Œé”â€ ä½œä¸ºé€šä¿¡ä¿¡å·ï¼Œè®©ä¸åŒçš„æ›´æ–°è¯·æ±‚å¼ºåˆ¶æ’é˜Ÿé¡ºåºæ‰§è¡Œï¼Œé‚£æ›´æ–°åº“å­˜çš„æ“ä½œæ˜¯åŒæ­¥çš„ã€‚ ç®€è¨€ä¹‹ï¼ŒåŒæ­¥æ„å‘³ç€æœ‰åºã€‚</p>
</li>
<li><p><strong>å¼‚æ­¥ï¼š</strong>ä¸ºå®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œä¸åŒç¨‹åºå•å…ƒä¹‹é—´è¿‡ç¨‹ä¸­æ— éœ€é€šä¿¡åè°ƒï¼Œä¹Ÿèƒ½å®Œæˆä»»åŠ¡çš„æ–¹å¼ï¼Œä¸ç›¸å…³çš„ç¨‹åºå•å…ƒä¹‹é—´å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚ ä¾‹å¦‚ï¼Œçˆ¬è™«ä¸‹è½½ç½‘é¡µã€‚è°ƒåº¦ç¨‹åºè°ƒç”¨ä¸‹è½½ç¨‹åºåï¼Œå³å¯è°ƒåº¦å…¶ä»–ä»»åŠ¡ï¼Œè€Œæ— éœ€ä¸è¯¥ä¸‹è½½ä»»åŠ¡ä¿æŒé€šä¿¡ä»¥åè°ƒè¡Œä¸ºã€‚ä¸åŒç½‘é¡µçš„ä¸‹è½½ã€ä¿å­˜ç­‰æ“ä½œéƒ½æ˜¯æ— å…³çš„ï¼Œä¹Ÿæ— éœ€ç›¸äº’é€šçŸ¥åè°ƒã€‚è¿™äº›å¼‚æ­¥æ“ä½œçš„å®Œæˆæ—¶åˆ»å¹¶ä¸ç¡®å®šã€‚ ç®€è¨€ä¹‹ï¼Œå¼‚æ­¥æ„å‘³ç€æ— åºã€‚</p>
</li>
<li><p><strong>ç›®çš„ï¼š</strong>åœ¨çˆ¬è™«ä¸­ä½¿ç”¨å¼‚æ­¥å®ç°é«˜æ€§èƒ½çš„æ•°æ®çˆ¬å–æ“ä½œã€‚</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202102/jianli14667.rar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202102/jianli14665.rar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://downsc.chinaz.net/Files/DownLoad/jianli/202102/jianli14648.rar&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_content</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨çˆ¬å–ï¼š&#x27;</span>, url)</span><br><span class="line">    <span class="comment"># getæ–¹æ³•æ˜¯ä¸€ä¸ªé˜»å¡çš„æ–¹æ³•</span></span><br><span class="line">    response = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> response.content</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_content</span>(<span class="params">content</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å“åº”æ•°æ®çš„é•¿åº¦ä¸ºï¼š&#x27;</span>, <span class="built_in">len</span>(content))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    content = get_content(url)</span><br><span class="line">    parse_content(content)</span><br></pre></td></tr></table></figure>

<h2 id="2-å¤šçº¿ç¨‹andå¤šçº¿ç¨‹"><a href="#2-å¤šçº¿ç¨‹andå¤šçº¿ç¨‹" class="headerlink" title="2. å¤šçº¿ç¨‹andå¤šçº¿ç¨‹"></a>2. å¤šçº¿ç¨‹andå¤šçº¿ç¨‹</h2><p><strong>å¼‚æ­¥çˆ¬è™«çš„æ–¹å¼ï¼š</strong></p>
<ul>
<li><strong>å¤šçº¿ç¨‹ï¼Œå¤šè¿›ç¨‹ï¼šï¼ˆä¸å»ºè®®ï¼‰</strong><ul>
<li>å¥½å¤„ï¼šå¯ä»¥ä¸ºç›¸å…³é˜»å¡çš„æ“ä½œå•ç‹¬å¼€å¯çº¿ç¨‹æˆ–è€…è¿›ç¨‹ï¼Œé˜»å¡æ“ä½œå°±å¯ä»¥å¼‚æ­¥æ‰§è¡Œ</li>
<li>å¼Šç«¯ï¼šæ— æ³•æ— é™åˆ¶çš„å¼€å¯å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹</li>
</ul>
</li>
</ul>
<h2 id="3-çº¿ç¨‹æ± andè¿›ç¨‹æ± "><a href="#3-çº¿ç¨‹æ± andè¿›ç¨‹æ± " class="headerlink" title="3. çº¿ç¨‹æ± andè¿›ç¨‹æ± "></a>3. çº¿ç¨‹æ± andè¿›ç¨‹æ± </h2><ul>
<li><strong>çº¿ç¨‹æ± ã€è¿›ç¨‹æ± ï¼šï¼ˆé€‚å½“ä½¿ç”¨ï¼‰</strong><ul>
<li>å¥½å¤„ï¼šå¯ä»¥é™ä½ç³»ç»Ÿå¯¹è¿›ç¨‹æˆ–è€…çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„ä¸€ä¸ªé¢‘ç‡ï¼Œä»è€Œå¾ˆå¥½åœ°é™ä½ç³»ç»Ÿåœ°å¼€é”€ã€‚</li>
<li>å¼Šç«¯ï¼šæ± ä¸­çº¿ç¨‹æˆ–è¿›ç¨‹åœ°æ•°é‡æ˜¯æœ‰ä¸Šé™çš„ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-çº¿ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨"><a href="#4-çº¿ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="4. çº¿ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨"></a>4. çº¿ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="comment">#ä½¿ç”¨å•çº¿ç¨‹ä¸²è¡Œæ–¹å¼æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½ï¼š&#x27;</span>,<span class="built_in">str</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½æˆåŠŸï¼š&#x27;</span>,<span class="built_in">str</span>)</span><br><span class="line">    </span><br><span class="line">name_list = [<span class="string">&#x27;xiaozi&#x27;</span>,<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>]</span><br><span class="line">start_time = time.time()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(name_list)):</span><br><span class="line">    get_page(name_list[i])</span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%d second&#x27;</span> % (end_time-start_time))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¼å…¥çº¿ç¨‹æ± æ¨¡å—å¯¹åº”çš„ç±»</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨çº¿ç¨‹æ± æ–¹å¼æ‰§è¡Œ</span></span><br><span class="line">start_time = time.time()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½ï¼š&#x27;</span>, <span class="built_in">str</span>)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½æˆåŠŸï¼š&#x27;</span>, <span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line">name_list = [<span class="string">&#x27;xiaozi&#x27;</span>,<span class="string">&#x27;aa&#x27;</span>,<span class="string">&#x27;bb&#x27;</span>,<span class="string">&#x27;cc&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">pool = Pool(<span class="number">4</span>)      <span class="comment">#çº¿ç¨‹æ± å¼€è¾Ÿ4ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">#å°†åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªåˆ—è¡¨å…ƒç´ ä¼ é€’ç»™get_pageè¿›è¡Œå¤„ç†</span></span><br><span class="line">pool.<span class="built_in">map</span>(get_page, name_list)</span><br><span class="line"></span><br><span class="line">end_time = time.time()</span><br><span class="line"><span class="built_in">print</span>(end_time - start_time)</span><br></pre></td></tr></table></figure>

<h2 id="5-çº¿ç¨‹æ± æ¡ˆä¾‹åº”ç”¨"><a href="#5-çº¿ç¨‹æ± æ¡ˆä¾‹åº”ç”¨" class="headerlink" title="5. çº¿ç¨‹æ± æ¡ˆä¾‹åº”ç”¨"></a>5. çº¿ç¨‹æ± æ¡ˆä¾‹åº”ç”¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># éœ€æ±‚ï¼šçˆ¬å–æ¢¨è§†é¢‘è§†é¢‘æ•°æ®</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># åŸåˆ™ï¼šçº¿ç¨‹æ± å¤„ç†çš„æ˜¯é˜»å¡ä¸”è€—æ—¶çš„æ“ä½œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># ç”Ÿæˆä¸€ä¸ªå­˜æ”¾è§†é¢‘çš„æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;./video&#x27;</span>):</span><br><span class="line">        os.mkdir(<span class="string">&#x27;./video&#x27;</span>)</span><br><span class="line">        <span class="comment"># å¯¹ä¸‹è¿°urlå‘èµ·è¯·æ±‚è§£æå‡ºè§†é¢‘è¯¦æƒ…é¡µçš„urlå’Œè§†é¢‘çš„åç§°</span></span><br><span class="line">    url = <span class="string">&#x27;https://www.pearvideo.com/category_5&#x27;</span></span><br><span class="line">    page_text = requests.get(url=url, headers=headers).text</span><br><span class="line"></span><br><span class="line">    tree = etree.HTML(page_text)</span><br><span class="line">    li_list = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;listvideoListUl&quot;]/li&#x27;</span>)</span><br><span class="line">urls = []  <span class="comment"># å­˜å‚¨æ‰€æœ‰è§†é¢‘çš„é“¾æ¥å’Œæ–‡å­—</span></span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">    detail_url = <span class="string">&#x27;https://www.pearvideo.com/&#x27;</span> + li.xpath(<span class="string">&#x27;./div/a/@href&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    name = li.xpath(<span class="string">&#x27;./div/a/div[2]/text()&#x27;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">    <span class="comment"># print(detail_url,name)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚</span></span><br><span class="line">    detail_page_text = requests.get(url=detail_url, headers=headers).text</span><br><span class="line">    <span class="comment"># ä»è¯¦æƒ…é¡µä¸­è§£æå‡ºè§†é¢‘çš„åœ°å€</span></span><br><span class="line">    <span class="comment">#### è§†é¢‘çš„æ–¹æ³•åœ¨2021/02/27 ä¸å¯ä½¿ç”¨ï¼Œæ¢¨è§†é¢‘åˆæ›´æ”¹äº†é¡µé¢æºç ï¼Œmp4æ˜¯åŠ¨æ€åŠ è½½å‡ºæ¥çš„ï¼Œmp4æ–‡ä»¶ç»ajaxè¯·æ±‚å¾—åˆ°ï¼Œéœ€è¦æŠ“åŒ…ajax</span></span><br><span class="line">    <span class="comment">#### å‚è€ƒ https://www.cnblogs.com/qianhu/p/14027192.htmlçš„æ“ä½œ</span></span><br><span class="line">    detail_tree = etree.HTML(detail_page_text)</span><br><span class="line">    name = detail_tree.xpath(<span class="string">&#x27;//*[@id=&quot;detailsbd&quot;]/div[1]/div[2]/div/div[1]/h1/text()&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    str_ = <span class="built_in">str</span>(li.xpath(<span class="string">&#x27;./div/a/@href&#x27;</span>)[<span class="number">0</span>]).split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">    ajax_url = <span class="string">&#x27;https://www.pearvideo.com/videoStatus.jsp?&#x27;</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;contId&#x27;</span>: str_,</span><br><span class="line">        <span class="string">&#x27;mrd&#x27;</span>: <span class="built_in">str</span>(random.random())</span><br><span class="line">    &#125;</span><br><span class="line">    ajax_headers = &#123;</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referer&#x27;</span>: <span class="string">&#x27;https://www.pearvideo.com/video_&#x27;</span> + str_</span><br><span class="line">    &#125;</span><br><span class="line">    dic_obj = requests.get(url=ajax_url, params=params, headers=ajax_headers).json()</span><br><span class="line">    video_url = dic_obj[<span class="string">&quot;videoInfo&quot;</span>][<span class="string">&#x27;videos&#x27;</span>][<span class="string">&quot;srcUrl&quot;</span>]</span><br><span class="line"></span><br><span class="line">    video_true_url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    s_list = <span class="built_in">str</span>(video_url).split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s_list)):</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(s_list) - <span class="number">1</span>:</span><br><span class="line">            video_true_url += s_list[i] + <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ss_list = s_list[i].split(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ss_list)):</span><br><span class="line">                <span class="keyword">if</span> j == <span class="number">0</span>:</span><br><span class="line">                    video_true_url += <span class="string">&#x27;cont-&#x27;</span> + str_ + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">                <span class="keyword">elif</span> j == <span class="built_in">len</span>(ss_list) - <span class="number">1</span>:</span><br><span class="line">                    video_true_url += ss_list[j]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    video_true_url += ss_list[j] + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">    dic = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: name,</span><br><span class="line">        <span class="string">&#x27;url&#x27;</span>: video_true_url</span><br><span class="line">    &#125;</span><br><span class="line">    urls.append(dic)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_video_data</span>(<span class="params">dic</span>):</span><br><span class="line">    urll = dic[<span class="string">&#x27;url&#x27;</span>]</span><br><span class="line">    data = requests.get(url=urll, headers=headers).content</span><br><span class="line">    path = <span class="string">&#x27;./video/&#x27;</span> + dic[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&#x27;.mp4&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(dic[<span class="string">&#x27;name&#x27;</span>], <span class="string">&#x27;æ­£åœ¨ä¸‹è½½.......&#x27;</span>)</span><br><span class="line">    <span class="comment"># æŒä¹…åŒ–å­˜å‚¨æ“ä½œ</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        fp.write(data)</span><br><span class="line">        <span class="built_in">print</span>(dic[<span class="string">&#x27;name&#x27;</span>]+ <span class="string">&#x27;.mp4&#x27;</span>, <span class="string">&#x27;ä¸‹è½½æˆåŠŸï¼&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨çº¿ç¨‹æ± å¯¹è§†é¢‘æ•°æ®è¿›è¡Œè¯·æ±‚ï¼ˆè¾ƒä¸ºè€—æ—¶çš„é˜»å¡æ“ä½œï¼‰</span></span><br><span class="line">pool = Pool(<span class="number">4</span>)</span><br><span class="line">pool.<span class="built_in">map</span>(get_video_data, urls)</span><br><span class="line"></span><br><span class="line">pool.close()</span><br><span class="line">pool.join()</span><br></pre></td></tr></table></figure>

<h2 id="6-åç¨‹ç›¸å…³æ¦‚å¿µå›é¡¾"><a href="#6-åç¨‹ç›¸å…³æ¦‚å¿µå›é¡¾" class="headerlink" title="6. åç¨‹ç›¸å…³æ¦‚å¿µå›é¡¾"></a>6. åç¨‹ç›¸å…³æ¦‚å¿µå›é¡¾</h2><ul>
<li><p><strong>åç¨‹ï¼š</strong>è‹±æ–‡å«åš Coroutineï¼Œåˆç§°å¾®çº¿ç¨‹ï¼Œçº¤ç¨‹ï¼Œåç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ã€‚ åç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚å› æ­¤åç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼Œå³æ‰€æœ‰å±€éƒ¨çŠ¶æ€çš„ä¸€ä¸ªç‰¹å®šç»„åˆï¼Œæ¯æ¬¡è¿‡ç¨‹é‡å…¥æ—¶ï¼Œå°±ç›¸å½“äºè¿›å…¥ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€ã€‚ åç¨‹æœ¬è´¨ä¸Šæ˜¯ä¸ªå•è¿›ç¨‹ï¼Œåç¨‹ç›¸å¯¹äºå¤šè¿›ç¨‹æ¥è¯´ï¼Œæ— éœ€çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ï¼Œæ— éœ€åŸå­æ“ä½œé”å®šåŠåŒæ­¥çš„å¼€é”€ï¼Œç¼–ç¨‹æ¨¡å‹ä¹Ÿéå¸¸ç®€å•ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åç¨‹æ¥å®ç°å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚åœ¨ç½‘ç»œçˆ¬è™«åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å‘å‡ºä¸€ä¸ªè¯·æ±‚ä¹‹åï¼Œéœ€è¦ç­‰å¾…ä¸€å®šçš„æ—¶é—´æ‰èƒ½å¾—åˆ°å“åº”ï¼Œä½†å…¶å®åœ¨è¿™ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå¯ä»¥å¹²è®¸å¤šå…¶ä»–çš„äº‹æƒ…ï¼Œç­‰åˆ°å“åº”å¾—åˆ°ä¹‹åæ‰åˆ‡æ¢å›æ¥ç»§ç»­å¤„ç†ï¼Œè¿™æ ·å¯ä»¥å……åˆ†åˆ©ç”¨ CPU å’Œå…¶ä»–èµ„æºï¼Œè¿™å°±æ˜¯å¼‚æ­¥åç¨‹çš„ä¼˜åŠ¿ã€‚</p>
</li>
<li><p><strong>å•çº¿ç¨‹+å¼‚æ­¥åç¨‹ï¼šï¼ˆæ¨èï¼‰</strong></p>
<ul>
<li><code>event_loopï¼š</code>äº‹ä»¶å¾ªç¯ï¼Œç›¸å½“äºä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€äº›å‡½æ•°æ³¨å†Œåˆ°è¿™ä¸ªäº‹ä»¶å¾ªç¯ä¸Šï¼Œå½“æ»¡è¶³æŸäº›æ¡ä»¶çš„æ—¶å€™ï¼Œå‡½æ•°å°±ä¼šè¢«å¾ªç¯æ‰§è¡Œã€‚</li>
<li><code>coroutineï¼š</code>åç¨‹å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†åç¨‹å¯¹è±¡æ³¨å†Œåˆ°äº‹ä»¶å¾ªç¯ä¸­ï¼Œå®ƒä¼šè¢«äº‹ä»¶å¾ªç¯è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ async å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨è°ƒç”¨æ—¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡ã€‚</li>
<li><code>taskï¼š</code>ä»»åŠ¡ï¼Œä»–æ˜¯å¯¹åç¨‹å¯¹è±¡çš„è¿›ä¸€æ­¥å°è£…ï¼ŒåŒ…å«äº†ä»»åŠ¡çš„å„ä¸ªçŠ¶æ€ã€‚</li>
<li><code>futureï¼š</code>ä»£è¡¨å°†æ¥æ‰§è¡Œæˆ–è¿˜æ²¡æœ‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå®é™…ä¸Šå’Œ task æ²¡æœ‰æœ¬è´¨åŒºåˆ«ã€‚</li>
<li><code>asyncï¼š</code>å®šä¹‰ä¸€ä¸ªåç¨‹ã€‚</li>
<li><code>awaitï¼š</code>ç”¨æ¥æŒ‚èµ·é˜»å¡æ–¹æ³•çš„æ‰§è¡Œã€‚</li>
</ul>
</li>
</ul>
<h2 id="7-åç¨‹ç›¸å…³æ“ä½œå›é¡¾"><a href="#7-åç¨‹ç›¸å…³æ“ä½œå›é¡¾" class="headerlink" title="7. åç¨‹ç›¸å…³æ“ä½œå›é¡¾"></a>7. åç¨‹ç›¸å…³æ“ä½œå›é¡¾</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨è¯·æ±‚çš„urlæ˜¯&#x27;</span>,url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ,&#x27;</span>,url)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"><span class="comment">#asyncioä¿®é¥°çš„å‡½æ•°ï¼Œè°ƒç”¨ä¹‹åè¿”å›çš„ä¸€ä¸ªåç¨‹å¯¹è±¡</span></span><br><span class="line">c = request(<span class="string">&#x27;www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># #åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯å¯¹è±¡</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># #å°†åç¨‹å¯¹è±¡æ³¨å†Œåˆ°loopä¸­ï¼Œç„¶åå¯åŠ¨loop</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #taskçš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment"># #åŸºäºloopåˆ›å»ºä¸€ä¸ªtaskä»»åŠ¡å¯¹è±¡</span></span><br><span class="line"><span class="comment"># task = loop.create_task(c)</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(task)</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># #futureçš„ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># loop = asyncio.get_event_loop()</span></span><br><span class="line"><span class="comment"># task = asyncio.ensure_future(c)</span></span><br><span class="line"><span class="comment"># loop.run_until_complete(task)</span></span><br><span class="line"><span class="comment"># print(task)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">callback_func</span>(<span class="params">task</span>):</span><br><span class="line">    <span class="comment">#resultè¿”å›çš„å°±æ˜¯ä»»åŠ¡å¯¹è±¡ä¸­å°è£…çš„åç¨‹å¯¹è±¡å¯¹åº”å‡½æ•°çš„è¿”å›å€¼</span></span><br><span class="line">    <span class="built_in">print</span>(task.result())</span><br><span class="line"><span class="comment">#ç»‘å®šå›è°ƒ</span></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">task = asyncio.ensure_future(c)</span><br><span class="line"><span class="comment">#å°†å›è°ƒå‡½æ•°ç»‘å®šåˆ°ä»»åŠ¡å¯¹è±¡ä¸­</span></span><br><span class="line">task.add_done_callback(callback_func)</span><br><span class="line">loop.run_until_complete(task)</span><br></pre></td></tr></table></figure>

<h2 id="8-å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°"><a href="#8-å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°" class="headerlink" title="8. å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°"></a>8. å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½&#x27;</span>,url)</span><br><span class="line">    <span class="comment">#åœ¨å¼‚æ­¥åç¨‹ä¸­å¦‚æœå‡ºç°äº†åŒæ­¥æ¨¡å—ç›¸å…³çš„ä»£ç ï¼Œé‚£ä¹ˆå°±æ— æ³•å®ç°å¼‚æ­¥</span></span><br><span class="line">    <span class="comment">#time.sleep(2)</span></span><br><span class="line">    <span class="comment">#å½“asyncioä¸­é‡åˆ°é˜»å¡æ“ä½œï¼Œå¿…é¡»æ‰‹åŠ¨æŒ‚èµ·</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½å®Œæ¯•&#x27;</span>,url)</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">urls =[</span><br><span class="line">    <span class="string">&#x27;www.baidu.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;www.sougou.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;www.goubanjia.com&#x27;</span></span><br><span class="line">]</span><br><span class="line"><span class="comment">#ä»»åŠ¡åˆ—è¡¨ï¼šå­˜æ”¾å¤šä¸ªä»»åŠ¡å¯¹è±¡</span></span><br><span class="line">stasks = []</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = request(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    stasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment">#éœ€è¦å°†ä»»åŠ¡åˆ—è¡¨å°è£…åˆ°waitä¸­</span></span><br><span class="line">loop.run_until_complete(asyncio.wait(stasks))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(time.time()-start)</span><br></pre></td></tr></table></figure>

<h2 id="9-aiohttp-æ¨¡å—å¼•å‡º"><a href="#9-aiohttp-æ¨¡å—å¼•å‡º" class="headerlink" title="9. aiohttp æ¨¡å—å¼•å‡º"></a>9. aiohttp æ¨¡å—å¼•å‡º</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######æœªèƒ½å®ç°å¼‚æ­¥è¿›ç¨‹ï¼Œè¿˜æ˜¯åŒæ­¥æ“ä½œ</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:1080/bobo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:1080/jay&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://127.0.0.1:1080/tom&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ­£åœ¨ä¸‹è½½&#x27;</span>, url)</span><br><span class="line">    <span class="comment">#requestsæ¨¡å—å‘èµ·çš„è¯·æ±‚æ˜¯åŸºäºåŒæ­¥çš„ï¼Œä¸èƒ½åœ¨å¼‚æ­¥æ¨¡å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šä¸­æ–­å¼‚æ­¥æ“ä½œï¼Œå¿…é¡»ä½¿ç”¨åŸºäºå¼‚æ­¥çš„ç½‘ç»œè¯·æ±‚æ¨¡å—è¿›è¡Œurlçš„è¯·æ±‚å‘é€</span></span><br><span class="line">    <span class="comment">#aiphttpæ¨¡å—å¼•å…¥</span></span><br><span class="line">    response = requests.get(url = url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½å®Œæ¯•&#x27;</span>, response.text)</span><br><span class="line"></span><br><span class="line">tasks = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = get_page(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ€»è€—æ—¶ï¼š&#x27;</span>, end-start)</span><br></pre></td></tr></table></figure>

<h2 id="10-aiohttp-å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°å¼‚æ­¥çˆ¬è™«"><a href="#10-aiohttp-å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°å¼‚æ­¥çˆ¬è™«" class="headerlink" title="10. aiohttp + å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°å¼‚æ­¥çˆ¬è™«"></a>10. aiohttp + å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°å¼‚æ­¥çˆ¬è™«</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç¯å¢ƒçš„å®‰è£…    pip install aiohttp</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨aiohttpæ¨¡å—ä¸­çš„ClientSession</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;http://www.baidu.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.sougou.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://www.taobao.com&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_page</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="comment">#get()ã€post():</span></span><br><span class="line">        <span class="comment">#headers,params/data,proxy=&#x27;http://ip:port&#x27;</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> <span class="keyword">await</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="comment">#text()è¿”å›çš„æ˜¯å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®</span></span><br><span class="line">            <span class="comment">#read()è¿”å›çš„æ˜¯äºŒè¿›åˆ¶å½¢å¼çš„å“åº”æ•°æ®</span></span><br><span class="line">            <span class="comment">#json()è¿”å›çš„æ˜¯jsonå¯¹è±¡</span></span><br><span class="line">            <span class="comment">#æ³¨æ„ï¼šåœ¨è·å–å“åº”æ•°æ®æ“ä½œä¹‹å‰ï¼Œä¸€å®šè¦ä½¿ç”¨awaitæ‰‹åŠ¨æŒ‚èµ·</span></span><br><span class="line">            page_text = <span class="keyword">await</span> response.text()</span><br><span class="line">            <span class="comment">#print(page_text)</span></span><br><span class="line"></span><br><span class="line">tasks = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">    c = get_page(url)</span><br><span class="line">    task = asyncio.ensure_future(c)</span><br><span class="line">    tasks.append(task)</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line">end = time.time()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;æ€»è€—æ—¶ï¼š&#x27;</span>, end-start)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ä¸ƒã€åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†"><a href="#ä¸ƒã€åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†" class="headerlink" title="ä¸ƒã€åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†"></a>ä¸ƒã€åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†</h1><h2 id="1-seleniumç®€ä»‹"><a href="#1-seleniumç®€ä»‹" class="headerlink" title="1. seleniumç®€ä»‹"></a>1. seleniumç®€ä»‹</h2><ul>
<li><p><strong>é—®é¢˜ï¼š</strong><code>selenium</code>æ¨¡å—å’Œçˆ¬è™«ä¹‹é—´å…·æœ‰æ€æ ·çš„å…³è”ï¼Ÿ</p>
<ul>
<li>ä¾¿æ·åœ°è·å–ç½‘ç«™ä¸­åŠ¨æ€åŠ è½½çš„æ•°æ®</li>
</ul>
</li>
<li><p>ä¾¿æ·å®ç°æ¨¡æ‹Ÿç™»å½•</p>
</li>
<li><p><strong>ä»€ä¹ˆæ˜¯<code>selenium</code>æ¨¡å—ï¼Ÿ</strong></p>
<p>  åŸºäºæµè§ˆå™¨è‡ªåŠ¨åŒ–çš„ä¸€ä¸ªæ¨¡å—ã€‚</p>
</li>
</ul>
<h2 id="2-seleniumåˆè¯•"><a href="#2-seleniumåˆè¯•" class="headerlink" title="2. seleniumåˆè¯•"></a>2. seleniumåˆè¯•</h2><p><strong>seleniumä½¿ç”¨æµç¨‹ï¼š</strong></p>
<ul>
<li>ç¯å¢ƒå®‰è£…ï¼š<code>pip install selenium</code></li>
<li>ä¸‹è½½ä¸€ä¸ªå¯¹åº”æµè§ˆå™¨çš„é©±åŠ¨ç¨‹åºï¼ˆä»¥è°·æ­Œæµè§ˆå™¨ä¸ºä¾‹ï¼‰<ul>
<li>ä¸‹è½½è·¯å¾„ï¼š<a target="_blank" rel="noopener" href="http://npm.taobao.org/mirrors/chromedriver/%E6%88%96%E8%80%85http://chromedriver.storage.googleapis.com/index.html">http://npm.taobao.org/mirrors/chromedriver/æˆ–è€…http://chromedriver.storage.googleapis.com/index.html</a></li>
<li>é©±åŠ¨ç¨‹åºå’Œæµè§ˆå™¨çš„æ˜ å°„å…³ç³»ï¼š<a target="_blank" rel="noopener" href="http://blog.csdn.net/huilan_same/article/details/51896672">http://blog.csdn.net/huilan_same/article/details/51896672</a></li>
<li>å®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡</li>
<li>ç¼–å†™åŸºäºæµè§ˆå™¨è‡ªåŠ¨åŒ–çš„æ“ä½œä»£ç <ul>
<li>å‘èµ·è¯·æ±‚ï¼š<code>get(url)</code></li>
<li>æ ‡ç­¾å®šä½ï¼š<code>findç³»åˆ—æ–¹æ³•</code></li>
<li>æ ‡ç­¾äº¤äº’ï¼š<code>send_keys(&#39;xxxxxx&#39;)</code></li>
<li>æ‰§è¡Œjsç¨‹åºï¼š<code>excute_script(&#39;jsCode&#39;)</code></li>
<li>å‰è¿›ã€åé€€ï¼š<code>forward( )ã€back( )</code></li>
<li>å…³é—­æµè§ˆå™¨ï¼š<code>quit( )</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># seleniumæ“çºµæµè§ˆå™¨</span></span><br><span class="line"><span class="comment">#### Tipï¼šä½œè€…Chromeæ˜¯88ç‰ˆæœ¬ï¼Œç›´æ¥ä¸‹è½½88çš„chromedriveræˆåŠŸè¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="comment"># å®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡ï¼ˆä¼ å…¥æµè§ˆå™¨çš„é©±åŠ¨ç¨‹åºï¼‰</span></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line"><span class="comment"># è®©æµè§ˆå™¨å‘èµ·ä¸€ä¸ªæŒ‡å®šçš„urlå¯¹åº”è¯·æ±‚</span></span><br><span class="line">bro.get(<span class="string">&#x27;http://scxk.nmpa.gov.cn:81/xk/&#x27;</span>)     </span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æµè§ˆå™¨å½“å‰é¡µé¢çš„é¡µé¢æºç æ•°æ®</span></span><br><span class="line">page_text = bro.page_source</span><br><span class="line"></span><br><span class="line"><span class="comment"># è§£æä¼ä¸šåç§°</span></span><br><span class="line">tree = etree.HTML(page_text)</span><br><span class="line">li_list = tree.xpath(<span class="string">&#x27;//ul[@id=&quot;gzlist&quot;]/li&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">    name = li.xpath(<span class="string">&#x27;./dl/@title&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">sleep(<span class="number">5</span>)</span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="3-seleniumå…¶ä»–è‡ªåŠ¨åŒ–æ“ä½œ"><a href="#3-seleniumå…¶ä»–è‡ªåŠ¨åŒ–æ“ä½œ" class="headerlink" title="3. seleniumå…¶ä»–è‡ªåŠ¨åŒ–æ“ä½œ"></a>3. seleniumå…¶ä»–è‡ªåŠ¨åŒ–æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">bro.get(<span class="string">&#x27;https://www.taobao.com/&#x27;</span>)</span><br><span class="line"><span class="comment"># æ ‡ç­¾å®šä½</span></span><br><span class="line">search_input = bro.find_element_by_id(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line"><span class="comment"># æ ‡ç­¾çš„äº¤äº’</span></span><br><span class="line">search_input.send_keys(<span class="string">&#x27;iphone&#x27;</span>)</span><br><span class="line"><span class="comment"># æ‰§è¡Œä¸€ç»„jsç¨‹åº   ç›¸å½“äºF12--Consoleæ‰§è¡Œjsä»£ç </span></span><br><span class="line">bro.execute_script(<span class="string">&#x27;window.scrollTo(0,document.body.scrollHeight)&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># ç‚¹å‡»æœç´¢æŒ‰é’®</span></span><br><span class="line">btn = bro.find_element_by_css_selector(<span class="string">&#x27;.btn-search&#x27;</span>)</span><br><span class="line">btn.click()</span><br><span class="line"></span><br><span class="line">bro.get(<span class="string">&#x27;https://baidu.com/&#x27;</span>)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># å›é€€</span></span><br><span class="line">bro.back()</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># å‰è¿›</span></span><br><span class="line">bro.forward()</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">5</span>)</span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="4-iframe-å¤„ç†-åŠ¨ä½œé“¾"><a href="#4-iframe-å¤„ç†-åŠ¨ä½œé“¾" class="headerlink" title="4. iframe å¤„ç†+åŠ¨ä½œé“¾"></a>4. iframe å¤„ç†+åŠ¨ä½œé“¾</h2><p><code>**selenium</code>å¤„ç†<code>iframe</code>ï¼š**</p>
<ul>
<li>å¦‚æœå®šä½çš„æ ‡ç­¾å­˜åœ¨äºiframeæ ‡ç­¾ä¹‹ä¸­ï¼Œåˆ™å¿…é¡»ä½¿ç”¨<code>switch_to.frame(id)</code></li>
<li>åŠ¨ä½œé“¾ï¼ˆæ‹–åŠ¨ï¼‰ï¼š<code>from selenium.webdriver import ActionChains</code><ul>
<li>å®ä¾‹åŒ–ä¸€ä¸ªåŠ¨ä½œé“¾å¯¹è±¡ï¼š<code>action = ActionChains(bro)</code></li>
<li><code>click_and_hold(div)</code>ï¼šé•¿æŒ‰ä¸”ç‚¹å‡»</li>
<li><code>move_by_offset(x,y)</code></li>
<li><code>perform( )</code>ï¼šè®©åŠ¨ä½œé“¾ç«‹å³æ‰§è¡Œ</li>
<li><code>action.release( )</code>ï¼šé‡Šæ”¾åŠ¨ä½œé“¾å¯¹è±¡</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="comment"># å¯¼å…¥åŠ¨ä½œé“¾å¯¹åº”çš„ç±»</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bro.get(<span class="string">&#x27;https://www.runoob.com/try/try.php?filename=jqueryui-example-droppable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœå®šä½çš„æ ‡ç­¾æ˜¯å­˜åœ¨ä¸iframeæ ‡ç­¾ä¹‹ä¸­çš„ï¼Œç›´æ¥é€šè¿‡findæ–¹å¼ä¼šæŠ¥é”™ï¼Œåˆ™å¿…é¡»é€šè¿‡å¦å¤–çš„æ“ä½œæ¥è¿›è¡Œæ ‡ç­¾å®šä½</span></span><br><span class="line">bro.switch_to.frame(<span class="string">&#x27;iframeResult&#x27;</span>)     <span class="comment">#åˆ‡æ¢æµè§ˆå™¨æ ‡ç­¾å®šä½çš„ä½œç”¨åŸŸ</span></span><br><span class="line">div = bro.find_element_by_id(<span class="string">&#x27;draggable&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ¨ä½œé“¾</span></span><br><span class="line">action = ActionChains(bro)      <span class="comment">#å®ä¾‹åŒ–åŠ¨ä½œé“¾å¯¹è±¡</span></span><br><span class="line"><span class="comment"># ç‚¹å‡»å¹¶ä¸”é•¿æŒ‰æŒ‡å®šçš„æ ‡ç­¾</span></span><br><span class="line">action.click_and_hold(div)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="comment">#perform è¡¨ç¤ºç«‹å³æ‰§è¡ŒåŠ¨ä½œé“¾æ“ä½œ</span></span><br><span class="line">    <span class="comment">#move_by_offset(x,y)   xè¡¨ç¤ºæ°´å¹³æ–¹å‘ï¼Œyè¡¨ç¤ºç«–ç›´æ–¹å‘</span></span><br><span class="line">    action.move_by_offset(<span class="number">11</span>, <span class="number">0</span>).perform()</span><br><span class="line">    sleep(<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡Šæ”¾åŠ¨ä½œé“¾</span></span><br><span class="line">action.release()</span><br><span class="line"></span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="5-seleniumæ¨¡æ‹Ÿç™»å½•QQç©ºé—´"><a href="#5-seleniumæ¨¡æ‹Ÿç™»å½•QQç©ºé—´" class="headerlink" title="5. seleniumæ¨¡æ‹Ÿç™»å½•QQç©ºé—´"></a>5. seleniumæ¨¡æ‹Ÿç™»å½•QQç©ºé—´</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ¨¡æ‹Ÿç™»å½•QQç©ºé—´ï¼Œè¿è¡Œå‰éœ€è¦å°†ä»£ç ä¸­â€œQQå·ç â€å’Œâ€œQQå¯†ç â€æ”¹å†™</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">bro.get(<span class="string">&#x27;https://qzone.qq.com/&#x27;</span>)</span><br><span class="line">bro.switch_to.frame(<span class="string">&#x27;login_frame&#x27;</span>)</span><br><span class="line"></span><br><span class="line">a_tag = bro.find_element_by_id(<span class="string">&#x27;switcher_plogin&#x27;</span>)</span><br><span class="line">a_tag.click()</span><br><span class="line"></span><br><span class="line">userName_tag = bro.find_element_by_id(<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">password_tag = bro.find_element_by_id(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">userName_tag.send_keys(<span class="string">&#x27;QQå·ç &#x27;</span>)</span><br><span class="line">password_tag.send_keys(<span class="string">&#x27;QQå¯†ç &#x27;</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">btn = bro.find_element_by_id(<span class="string">&#x27;login_button&#x27;</span>)</span><br><span class="line">btn.click()</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="6-æ— å¤´æµè§ˆå™¨-è§„é¿æ“ä½œ"><a href="#6-æ— å¤´æµè§ˆå™¨-è§„é¿æ“ä½œ" class="headerlink" title="6. æ— å¤´æµè§ˆå™¨+è§„é¿æ“ä½œ"></a>6. æ— å¤´æµè§ˆå™¨+è§„é¿æ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="comment">#å®ç°æ— å¯è§†åŒ–ç•Œé¢</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="comment">#å®ç°è§„é¿æ£€æµ‹</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ChromeOptions</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ç°æ— å¯è§†åŒ–ç•Œé¢çš„æ“ä½œ</span></span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®ç°è§„é¿æ£€æµ‹</span></span><br><span class="line">option = ChromeOptions()</span><br><span class="line">option.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚ä½•å®ç°è®©seleniumè§„é¿è¢«æ£€æµ‹åˆ°çš„é£é™©</span></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>, chrome_options=chrome_options,options=option)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ— å¯è§†åŒ–ç•Œé¢ï¼ˆæ— å¤´æµè§ˆå™¨ï¼‰ phantomJs</span></span><br><span class="line">bro.get(<span class="string">&#x27;https://www.baidu.com&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(bro.page_source)</span><br><span class="line">sleep(<span class="number">2</span>)</span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<h2 id="7-è¶…çº§é¹°çš„åŸºæœ¬ä½¿ç”¨"><a href="#7-è¶…çº§é¹°çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="7. è¶…çº§é¹°çš„åŸºæœ¬ä½¿ç”¨"></a>7. è¶…çº§é¹°çš„åŸºæœ¬ä½¿ç”¨</h2><p><strong>è¶…çº§é¹°ï¼š</strong><a target="_blank" rel="noopener" href="https://www.chaojiying.com/about.html">https://www.chaojiying.com/about.html</a></p>
<ul>
<li>æ³¨å†Œï¼šæ™®é€šç”¨æˆ·</li>
<li>ç™»å½•ï¼šæ™®é€šç”¨æˆ·</li>
<li>é¢˜åˆ†æŸ¥è¯¢ï¼šå……å€¼</li>
<li>è½¯ä»¶IDâ€”â€”åˆ›å»ºä¸€ä¸ªè½¯ä»¶ID</li>
<li>ä¸‹è½½ç¤ºä¾‹ä»£ç </li>
</ul>
<h2 id="8-12306æ¨¡æ‹Ÿç™»å½•"><a href="#8-12306æ¨¡æ‹Ÿç™»å½•" class="headerlink" title="8. 12306æ¨¡æ‹Ÿç™»å½•"></a>8. 12306æ¨¡æ‹Ÿç™»å½•</h2><p><strong>ç¼–ç æµç¨‹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨<code>selenium</code>æ‰“å¼€ç™»å½•ç•Œé¢</li>
<li>å¯¹å½“å‰<code>selenium</code>æ‰“å¼€çš„è¿™å¼ ç•Œé¢è¿›è¡Œæˆªå›¾</li>
<li>å¯¹æˆªå–çš„å›¾ç‰‡è¿›è¡Œå±€éƒ¨åŒºåŸŸï¼ˆéªŒè¯ç å›¾ç‰‡ï¼‰çš„è£å‰ª<ul>
<li>å¥½å¤„ï¼šå°†éªŒè¯ç å›¾ç‰‡å’Œæ¨¡æ‹Ÿç™»å½•è¿›è¡Œä¸€ä¸€å¯¹åº”</li>
</ul>
</li>
<li>ä½¿ç”¨è¶…çº§é¹°è¯†åˆ«éªŒè¯ç å›¾ç‰‡ï¼ˆåæ ‡ï¼‰</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="comment">########ä¸‹è¿°ä¸ºè¶…çº§é¹°ç¤ºä¾‹ä»£ç </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Chaojiying_Client</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, username, password, soft_id</span>):</span><br><span class="line">        self.username = username</span><br><span class="line">        password =  password.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        self.password = md5(password).hexdigest()</span><br><span class="line">        self.soft_id = soft_id</span><br><span class="line">        self.base_params = &#123;</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: self.username,</span><br><span class="line">            <span class="string">&#x27;pass2&#x27;</span>: self.password,</span><br><span class="line">            <span class="string">&#x27;softid&#x27;</span>: self.soft_id,</span><br><span class="line">        &#125;</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;Keep-Alive&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">PostPic</span>(<span class="params">self, im, codetype</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        im: å›¾ç‰‡å­—èŠ‚</span></span><br><span class="line"><span class="string">        codetype: é¢˜ç›®ç±»å‹ å‚è€ƒ http://www.chaojiying.com/price.html</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;codetype&#x27;</span>: codetype,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        files = &#123;<span class="string">&#x27;userfile&#x27;</span>: (<span class="string">&#x27;ccc.jpg&#x27;</span>, im)&#125;</span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/Processing.php&#x27;</span>, data=params, files=files, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ReportError</span>(<span class="params">self, im_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        im_id:æŠ¥é”™é¢˜ç›®çš„å›¾ç‰‡ID</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: im_id,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        r = requests.post(<span class="string">&#x27;http://upload.chaojiying.net/Upload/ReportError.php&#x27;</span>, data=params, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line"><span class="comment">############ä¸Šè¿°ä¸ºè¶…çº§é¹°çš„ç¤ºä¾‹ä»£ç </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨seleniumæ‰“å¼€ç™»å½•é¡µé¢</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome(executable_path=<span class="string">&#x27;./chromedriver.exe&#x27;</span>)</span><br><span class="line">bro.execute_cdp_cmd(<span class="string">&quot;Page.addScriptToEvaluateOnNewDocument&quot;</span>, &#123;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Object.defineProperty(navigator, &#x27;webdriver&#x27;, &#123;</span></span><br><span class="line"><span class="string">      get: () =&gt; undefined</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bro.execute_script(script)</span></span><br><span class="line">bro.get(<span class="string">&#x27;https://kyfw.12306.cn/otn/resources/login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€å¤§åŒ–æµè§ˆå™¨çª—å£</span></span><br><span class="line">bro.maximize_window()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆç‚¹å‡»é€‰æ‹©  è´¦å·ç™»å½•</span></span><br><span class="line">zhanghao_tag = bro.find_element_by_class_name(<span class="string">&#x27;login-hd-account&#x27;</span>)</span><br><span class="line">zhanghao_tag.click()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># save_screenshotå°±æ˜¯å°†å½“å‰é¡µé¢è¿›è¡Œæˆªå›¾ä¸”ä¿å­˜</span></span><br><span class="line">bro.save_screenshot(<span class="string">&#x27;aa.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç¡®å®šéªŒè¯ç å›¾ç‰‡å¯¹åº”çš„å·¦ä¸Šè§’å’Œå³ä¸‹è§’çš„åæ ‡ï¼ˆè£å‰ªçš„åŒºåŸŸå°±ç¡®å®šï¼‰</span></span><br><span class="line">code_img_ele = bro.find_element_by_class_name(<span class="string">&#x27;touclick-wrapper&#x27;</span>)</span><br><span class="line">location = code_img_ele.location  <span class="comment"># éªŒè¯ç å›¾ç‰‡å·¦ä¸Šè§’çš„åæ ‡ x,y</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;location:&#x27;</span>, location)</span><br><span class="line">size = code_img_ele.size  <span class="comment">#éªŒè¯ç æ ‡ç­¾å¯¹åº”çš„é•¿å’Œå®½</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;size:&#x27;</span>, size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å·¦ä¸Šè§’å’Œå³ä¸‹è§’åæ ‡  #æ­¤å¤„ *1.25 åŸå› æ˜¯ä½œè€…windowç”µè„‘é»˜è®¤æ˜¾ç¤ºå¸ƒå±€ä¸º125%ï¼ˆç”µè„‘è®¾ç½®--æ˜¾ç¤º--ç¼©æ”¾ä¸å¸ƒå±€ï¼‰ï¼Œä¸ä¹˜1.25å–ä¸åˆ°å›¾ç‰‡æ­£ç¡®ä½ç½®</span></span><br><span class="line">rangle = (location[<span class="string">&#x27;x&#x27;</span>]*<span class="number">1.25</span>, location[<span class="string">&#x27;y&#x27;</span>]*<span class="number">1.25</span>, (location[<span class="string">&#x27;x&#x27;</span>]+size[<span class="string">&#x27;width&#x27;</span>])*<span class="number">1.25</span>, (location[<span class="string">&#x27;y&#x27;</span>]+size[<span class="string">&#x27;height&#x27;</span>])*<span class="number">1.25</span>)</span><br><span class="line"><span class="comment"># è‡³æ­¤éªŒè¯ç å›¾ç‰‡åŒºåŸŸå°±ç¡®å®šä¸‹æ¥äº†</span></span><br><span class="line"></span><br><span class="line">i = Image.<span class="built_in">open</span>(<span class="string">&#x27;./aa.png&#x27;</span>)</span><br><span class="line">code_img_name = <span class="string">&#x27;./code.png&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cropæ ¹æ®æŒ‡å®šåŒºåŸŸè¿›è¡Œå›¾ç‰‡è£å‰ª</span></span><br><span class="line">frame = i.crop(rangle)</span><br><span class="line">frame.save(code_img_name)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†éªŒè¯ç å›¾ç‰‡æäº¤ç»™è¶…çº§é¹°è¿›è¡Œè¯†åˆ«</span></span><br><span class="line"></span><br><span class="line">chaojiying = Chaojiying_Client(<span class="string">&#x27;è¶…çº§ğŸ¦…è´¦å·&#x27;</span>, <span class="string">&#x27;è¶…çº§ğŸ¦…å¯†ç &#x27;</span>, <span class="string">&#x27;è½¯ä»¶ID&#x27;</span>)</span><br><span class="line">im = <span class="built_in">open</span>(<span class="string">&#x27;code.png&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="built_in">print</span>(chaojiying.PostPic(im, <span class="number">9004</span>)[<span class="string">&#x27;pic_str&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = chaojiying.PostPic(im, <span class="number">9004</span>)[<span class="string">&#x27;pic_str&#x27;</span>]</span><br><span class="line">all_list = []   <span class="comment">#è¦å­˜å‚¨å³å°†è¢«ç‚¹å‡»çš„ç‚¹çš„åæ ‡  [[x1,y1],[x2,y2]]</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;|&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">    list_1 = result.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">    count_1 = <span class="built_in">len</span>(list_1)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(count_1):</span><br><span class="line">        xy_list = []</span><br><span class="line">        x = <span class="built_in">int</span>(list_1[i].split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">        y = <span class="built_in">int</span>(list_1[i].split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">        xy_list.append(x)</span><br><span class="line">        xy_list.append(y)</span><br><span class="line">        all_list.append(xy_list)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    x = <span class="built_in">int</span>(result.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">0</span>])</span><br><span class="line">    y = <span class="built_in">int</span>(result.split(<span class="string">&#x27;,&#x27;</span>)[<span class="number">1</span>])</span><br><span class="line">    xy_list = []</span><br><span class="line">    xy_list.append(x)</span><br><span class="line">    xy_list.append(y)</span><br><span class="line">    all_list.append(xy_list)</span><br><span class="line"><span class="built_in">print</span>(all_list)</span><br><span class="line"><span class="comment"># éå†åˆ—è¡¨ï¼Œä½¿ç”¨åŠ¨ä½œé“¾å¯¹æ¯ä¸€ä¸ªåˆ—è¡¨å…ƒç´ å¯¹åº”çš„x,yæŒ‡å®šçš„ä½ç½®è¿›è¡Œç‚¹å‡»æ“ä½œ</span></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> all_list:</span><br><span class="line">    x = l[<span class="number">0</span>]</span><br><span class="line">    y = l[<span class="number">1</span>]</span><br><span class="line">    <span class="comment">#è¿™é‡Œçš„/1.25ï¼Œæ˜¯å› ä¸ºï¼Œç”µè„‘è®¾ç½®125%ï¼Œè€Œç½‘é¡µæ˜¯100%çš„ï¼Œæ‰€ä»¥ï¼Œè¦ç¡®å®šç½‘é¡µä¸­å¯¹åº”ä½ç½®ï¼Œé™¤ä»¥1.25å³å¯</span></span><br><span class="line">    ActionChains(bro).move_to_element_with_offset(code_img_ele, x/<span class="number">1.25</span>, y/<span class="number">1.25</span>).click().perform()</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">bro.find_element_by_id(<span class="string">&#x27;J-userName&#x27;</span>).send_keys(<span class="string">&#x27;12306è´¦å·&#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">bro.find_element_by_id(<span class="string">&#x27;J-password&#x27;</span>).send_keys(<span class="string">&#x27;12306å¯†ç &#x27;</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">bro.find_element_by_id(<span class="string">&#x27;J-login&#x27;</span>).click()</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # æ»‘å—æ“ä½œï¼Œ12306æ£€æµ‹selenium,,,,æ»‘å—æ€»æ˜¯åˆ·æ–°é‡è¯•ï¼Œ</span></span><br><span class="line"><span class="comment"># action = ActionChains(bro)</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     slider = bro.find_element_by_css_selector(&#x27;#nc_1_n1z&#x27;)</span></span><br><span class="line"><span class="comment">#     action.click_and_hold(slider)</span></span><br><span class="line"><span class="comment">#     action.move_by_offset(300, 0).perform()</span></span><br><span class="line"><span class="comment">#     time.sleep(15)</span></span><br><span class="line"><span class="comment">#     action.release()</span></span><br><span class="line"><span class="comment"># except Exception as e:</span></span><br><span class="line"><span class="comment">#     print(e)</span></span><br><span class="line"></span><br><span class="line">bro.quit()</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="å…«ã€scrapyæ¡†æ¶"><a href="#å…«ã€scrapyæ¡†æ¶" class="headerlink" title="å…«ã€scrapyæ¡†æ¶"></a>å…«ã€scrapyæ¡†æ¶</h1><h2 id="1-scrapyæ¡†æ¶åˆè¯†"><a href="#1-scrapyæ¡†æ¶åˆè¯†" class="headerlink" title="1. scrapyæ¡†æ¶åˆè¯†"></a>1. scrapyæ¡†æ¶åˆè¯†</h2><ul>
<li><p><strong>ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ</strong></p>
<p>  å°±æ˜¯ä¸€ä¸ªé›†æˆäº†å¾ˆå¤šåŠŸèƒ½å¹¶ä¸”å…·æœ‰å¾ˆå¼ºé€šç”¨æ€§çš„ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ã€‚</p>
</li>
<li><p><strong>å¦‚ä½•å­¦ä¹ æ¡†æ¶ï¼Ÿ</strong></p>
<p>  ä¸“é—¨å­¦ä¹ æ¡†æ¶å°è£…çš„å„ç§åŠŸèƒ½çš„è¯¦ç»†ç”¨æ³•ã€‚</p>
</li>
<li><p><strong>ä»€ä¹ˆæ˜¯<code>scrapy</code>ï¼Ÿ</strong></p>
<p>  çˆ¬è™«ä¸­å°è£…å¥½çš„ä¸€ä¸ªæ˜æ˜Ÿæ¡†æ¶ã€‚</p>
<p>  <strong>åŠŸèƒ½ï¼š</strong>é«˜æ€§èƒ½çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œå¼‚æ­¥çš„æ•°æ®ä¸‹è½½ï¼Œé«˜æ€§èƒ½çš„æ•°æ®è§£æï¼Œåˆ†å¸ƒå¼</p>
</li>
</ul>
<h2 id="2-scrapyåŸºæœ¬ä½¿ç”¨"><a href="#2-scrapyåŸºæœ¬ä½¿ç”¨" class="headerlink" title="2. scrapyåŸºæœ¬ä½¿ç”¨"></a>2. scrapyåŸºæœ¬ä½¿ç”¨</h2><p><strong>scrapyæ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>ç¯å¢ƒçš„å®‰è£…ï¼š<ul>
<li>mac or linuxï¼š<code>pip install scrapy</code></li>
<li>windows:<ul>
<li><code>pip install wheel</code></li>
<li>ä¸‹è½½twistedï¼Œä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted">http://www.lfd.uci.edu/~gohlke/pythonlibs/#twisted</a></li>
<li>å®‰è£…twistedï¼š<code>pip install Twisted-20.3.0-cp39-cp39-win_amd64.whl</code></li>
<li><code>pip install pywin32</code></li>
<li><code>pip install scrapy</code></li>
<li>æµ‹è¯•ï¼šåœ¨ç»ˆç«¯é‡Œå½•å…¥scrapyæŒ‡ä»¤ï¼Œæ²¡æœ‰æŠ¥é”™å³è¡¨ç¤ºå®‰è£…æˆåŠŸï¼</li>
</ul>
</li>
</ul>
</li>
<li>åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼š<code>scrapy startproject xxxPro</code></li>
<li><code>cd xxxPro</code></li>
<li>åœ¨spiderså­ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªçˆ¬è™«æ–‡ä»¶<ul>
<li><code>scrapy genspider spiderName www.xxx.com</code></li>
</ul>
</li>
<li>æ‰§è¡Œå·¥ç¨‹ï¼š<ul>
<li><code>scrapy crawl spiderName</code></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###firstBlood__first</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FirstSpider</span>(scrapy.Spider):</span><br><span class="line">    <span class="comment">#çˆ¬è™«æ–‡ä»¶çš„åç§°ï¼šå°±æ˜¯çˆ¬è™«æºæ–‡ä»¶çš„ä¸€ä¸ªå”¯ä¸€æ ‡è¯†</span></span><br><span class="line">    name = <span class="string">&#x27;first&#x27;</span></span><br><span class="line">    <span class="comment">#å…è®¸çš„åŸŸåï¼šç”¨æ¥é™å®šstart_urlsåˆ—è¡¨ä¸­å“ªäº›urlå¯ä»¥è¿›è¡Œè¯·æ±‚å‘é€</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.baidu.com&#x27;]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#èµ·å§‹çš„urlåˆ—è¡¨ï¼šè¯¥åˆ—è¡¨ä¸­å­˜æ”¾çš„urlä¼šè¢«scrapyè‡ªåŠ¨è¿›è¡Œè¯·æ±‚çš„å‘é€</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.baidu.com/&#x27;</span>, <span class="string">&#x27;https://www.sogou.com/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#ç”¨ä½œäºæ•°æ®è§£æï¼šresponseå‚æ•°è¡¨ç¤ºçš„å°±æ˜¯è¯·æ±‚æˆåŠŸåå¯¹åº”çš„å“åº”å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h2 id="3-scrapyæ•°æ®è§£ææ“ä½œ"><a href="#3-scrapyæ•°æ®è§£ææ“ä½œ" class="headerlink" title="3. scrapyæ•°æ®è§£ææ“ä½œ"></a>3. scrapyæ•°æ®è§£ææ“ä½œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QiubaiSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;qiubai&#x27;</span></span><br><span class="line">    <span class="comment">#allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.qiushibaike.com/text/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment">#è§£æä½œè€…çš„åç§°+æ®µå­çš„å†…å®¹</span></span><br><span class="line">        div_list = response.xpath(<span class="string">&#x27;//div[@id=&quot;col1 old-style-col1&quot;]/div&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            <span class="comment">#xpathè¿”å›çš„æ˜¯åˆ—è¡¨ï¼Œå½“æ—¶åˆ—è¡¨å…ƒç´ ä¸€å®šæ˜¯Selectorç±»å‹çš„å¯¹è±¡</span></span><br><span class="line">            <span class="comment">#extractå¯ä»¥å°†Selectorå¯¹è±¡ä¸­dataå‚æ•°å­˜å‚¨çš„å­—ç¬¦ä¸²æå–å‡ºæ¥</span></span><br><span class="line">            author = div.xpath(<span class="string">&#x27;./div[1]/a[2]/h2/text()&#x27;</span>)[<span class="number">0</span>].extract()</span><br><span class="line">            <span class="comment">#åˆ—è¡¨è°ƒç”¨äº†extractä¹‹åã€‚åˆ™è¡¨ç¤ºå°†åˆ—è¡¨ä¸­æ¯ä¸€ä¸ªSelectorå¯¹è±¡ä¸­dataå¯¹åº”çš„å­—ç¬¦ä¸²æå–äº†å‡ºæ¥</span></span><br><span class="line">            content = div.xpath(<span class="string">&#x27;./a[1]/div/span//text()&#x27;</span>).extract()</span><br><span class="line">            content = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(author,content)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="4-åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨"><a href="#4-åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨" class="headerlink" title="4. åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨"></a>4. åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨</h2><p><strong>scrapyæŒä¹…åŒ–å­˜å‚¨ï¼š</strong></p>
<ul>
<li>åŸºäºç»ˆç«¯æŒ‡ä»¤ï¼š<ul>
<li>è¦æ±‚ï¼šåªå¯ä»¥å°†parseæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°æœ¬åœ°çš„æ–‡æœ¬æ–‡ä»¶ä¸­</li>
<li>æ³¨æ„ï¼šæŒä¹…åŒ–å­˜å‚¨å¯¹åº”çš„æ–‡æœ¬æ–‡ä»¶ç±»å‹åªå¯ä»¥ä¸ºï¼šjsonã€jsonlinesã€jlã€csvã€xmlã€marshalã€pickle</li>
<li>æŒ‡ä»¤ï¼š<code>scrapy crawl xxx -o filePath</code></li>
<li>å¥½å¤„ï¼šç®€æ´é«˜æ•ˆä¾¿æ·</li>
<li>ç¼ºç‚¹ï¼šå±€é™æ€§æ¯”è¾ƒå¼ºï¼ˆæ•°æ®åªå¯ä»¥å­˜å‚¨åˆ°æŒ‡å®šåç¼€çš„æ–‡æœ¬æ–‡ä»¶ä¸­ï¼‰</li>
</ul>
</li>
</ul>
<h2 id="5-åŸºäºç®¡é“æŒä¹…åŒ–å­˜å‚¨æ“ä½œ"><a href="#5-åŸºäºç®¡é“æŒä¹…åŒ–å­˜å‚¨æ“ä½œ" class="headerlink" title="5. åŸºäºç®¡é“æŒä¹…åŒ–å­˜å‚¨æ“ä½œ"></a>5. åŸºäºç®¡é“æŒä¹…åŒ–å­˜å‚¨æ“ä½œ</h2><p>åŸºäºç®¡é“ï¼š</p>
<ul>
<li>ç¼–ç æµç¨‹ï¼š<ul>
<li>æ•°æ®è§£æ</li>
<li>åœ¨itemç±»ä¸­å®šä¹‰ç›¸å…³çš„å±æ€§</li>
<li>å°†è§£æçš„æ•°æ®å°è£…åˆ°itemç±»å‹çš„å¯¹è±¡</li>
<li>å°†itemç±»å‹çš„å¯¹è±¡æäº¤ç»™ç®¡é“è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨çš„æ“ä½œ</li>
<li>åœ¨ç®¡é“ç±»çš„process_itemä¸­è¦å°†å…¶æ¥æ”¶åˆ°çš„itemå¯¹è±¡ä¸­å­˜å‚¨çš„æ•°æ®è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨æ“ä½œ</li>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç®¡é“</li>
</ul>
</li>
<li>å¥½å¤„ï¼š<ul>
<li>é€šç”¨æ€§å¼ºã€‚</li>
</ul>
</li>
</ul>
<p><strong>é¢è¯•é¢˜ï¼šå°†çˆ¬å–åˆ°çš„æ•°æ®ä¸€ä»½å­˜å‚¨åˆ°æœ¬åœ°ï¼Œä¸€ä»½å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</strong></p>
<ul>
<li>ç®¡é“æ–‡ä»¶ä¸­ä¸€ä¸ªç®¡é“ç±»å¯¹åº”çš„æ˜¯å°†æ•°æ®å­˜å‚¨åˆ°ä¸€ç§å¹³å°</li>
<li>çˆ¬è™«æ–‡ä»¶æäº¤çš„itemåªä¼šç»™ç®¡é“æ–‡ä»¶ä¸­ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„ç®¡é“ç±»æ¥æ”¶</li>
<li><code>process_item</code>ä¸­çš„<code>return item</code>è¡¨ç¤ºå°†itemä¼ é€’ç»™ä¸‹ä¸€ä¸ªå³å°†è¢«æ‰§è¡Œçš„ç®¡é“ç±»</li>
</ul>
<h2 id="6-å…¨ç«™æ•°æ®çˆ¬å–"><a href="#6-å…¨ç«™æ•°æ®çˆ¬å–" class="headerlink" title="6. å…¨ç«™æ•°æ®çˆ¬å–"></a>6. å…¨ç«™æ•°æ®çˆ¬å–</h2><p><strong>åŸºäºspiderçš„å…¨ç«™æ•°æ®çˆ¬å–ï¼š</strong>å°±æ˜¯å°†ç½‘ç«™ä¸­æŸæ¿å—ä¸‹çš„å…¨éƒ¨é¡µç å¯¹åº”çš„é¡µé¢æ•°æ®è¿›è¡Œçˆ¬å–ã€‚</p>
<ul>
<li>çˆ¬å–ï¼šæ ¡èŠ±ç½‘æ˜æ˜Ÿå†™çœŸçš„åç§°</li>
<li>å®ç°æ–¹å¼ï¼š<ul>
<li>å°†æ‰€æœ‰é¡µé¢çš„<code>url</code>æ·»åŠ åˆ°<code>start_urls</code>åˆ—è¡¨ï¼ˆä¸æ¨èï¼‰</li>
<li>è‡ªè¡Œæ‰‹åŠ¨è¿›è¡Œè¯·æ±‚å‘é€ï¼ˆæ¨èï¼‰</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;------------æ ¡èŠ±ç½‘xiaohua.py----------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XiaohuaSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;xiaohua&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://www.521609.com/tuku/mxxz/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#ç”Ÿæˆä¸€ä¸ªé€šç”¨çš„urlæ¨¡æ¿(ä¸å¯å˜)</span></span><br><span class="line">    url = <span class="string">&#x27;http://www.521609.com/tuku/mxxz/index_%d.html&#x27;</span></span><br><span class="line">    page_num = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        li_list = response.xpath(<span class="string">&#x27;/html/body/div[4]/div[3]/ul/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            img_name = li.xpath(<span class="string">&#x27;./a/p/text()&#x27;</span>).extract_first()</span><br><span class="line">            <span class="built_in">print</span>(img_name)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.page_num &lt;= <span class="number">28</span>:</span><br><span class="line">            new_url = <span class="built_in">format</span>(self.url%self.page_num)</span><br><span class="line">            self.page_num += <span class="number">1</span></span><br><span class="line">            <span class="comment">#æ‰‹åŠ¨è¯·æ±‚å‘é€:callbackå›è°ƒå‡½æ•°æ˜¯ä¸“é—¨ç”¨ä½œäºæ•°æ®è§£æ</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=new_url,callback=self.parse)</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;---------------æ ¡èŠ±ç½‘pipelines.py--------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">XiaohuaproPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;----------------æ ¡èŠ±ç½‘settings.pyéƒ¨åˆ†ä»£ç ---------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line">LOG_LEVEL = <span class="string">&#x27;ERROR&#x27;</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="7-äº”å¤§æ ¸å¿ƒç»„ä»¶"><a href="#7-äº”å¤§æ ¸å¿ƒç»„ä»¶" class="headerlink" title="7. äº”å¤§æ ¸å¿ƒç»„ä»¶"></a>7. äº”å¤§æ ¸å¿ƒç»„ä»¶</h2><p><strong>äº”å¤§æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<p><img src="/../PythonProjects/Typora_image/image-20210302092358486.png" alt="image-20210302092358486"></p>
<ul>
<li><strong>Spidersï¼š</strong><ul>
<li>äº§ç”ŸURLï¼Œå¯¹URLè¿›è¡Œæ‰‹åŠ¨å‘é€</li>
<li>è¿›è¡Œæ•°æ®è§£æ</li>
</ul>
</li>
<li><strong>å¼•æ“ï¼ˆScrapy Engineï¼‰ï¼š</strong><ul>
<li>æ•°æ®æµå¤„ç†</li>
<li>è§¦å‘äº‹åŠ¡</li>
</ul>
</li>
<li><strong>è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ï¼š</strong><ul>
<li><strong>è¿‡æ»¤å™¨</strong>å»é‡</li>
<li>å»é‡åçš„è¯·æ±‚å¯¹è±¡å‹åˆ°<strong>é˜Ÿåˆ—</strong>ä¸­</li>
</ul>
</li>
<li><strong>ä¸‹è½½å™¨ï¼ˆDownloaderï¼‰ï¼š</strong><ul>
<li>è´Ÿè´£è·å–é¡µé¢æ•°æ®å¹¶æä¾›ç»™å¼•æ“ï¼Œè€Œåæä¾›ç»™Spider</li>
</ul>
</li>
<li><strong>é¡¹ç›®ç®¡é“ï¼ˆItem Pipelineï¼‰ï¼š</strong><ul>
<li>è´Ÿè´£å¤„ç†çˆ¬è™«ä»ç½‘é¡µä¸­æŠ½å–çš„å®ä½“ï¼Œé¡µé¢è¢«çˆ¬è™«è§£ææ‰€éœ€çš„æ•°æ®å­˜å…¥itemåï¼Œå°†è¢«å‘é€åˆ°ç®¡é“ï¼Œç»è¿‡ç‰¹å®šçš„æ¬¡åºå¤„ç†æ•°æ®ï¼Œæœ€åå­˜å…¥æœ¬åœ°æ–‡ä»¶æˆ–è€…æ•°æ®åº“ã€‚</li>
</ul>
</li>
</ul>
<h2 id="8-è¯·æ±‚ä¼ å‚"><a href="#8-è¯·æ±‚ä¼ å‚" class="headerlink" title="8. è¯·æ±‚ä¼ å‚"></a>8. è¯·æ±‚ä¼ å‚</h2><ul>
<li><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong>å¦‚æœçˆ¬å–è§£æçš„æ•°æ®ä¸åœ¨åŒä¸€å¼ é¡µé¢ä¸­ã€‚ï¼ˆæ·±åº¦çˆ¬å–ï¼‰</li>
<li><strong>éœ€æ±‚ï¼š</strong>çˆ¬å–bossçš„å²—ä½åç§°å’Œå²—ä½æè¿°</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#### æˆ‘å°è¯•ç€å¹¶æœªæœ‰å•¥ç»“æœ.......ç­‰å¤§ä½¬</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> bossPro.items <span class="keyword">import</span> BossproItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BossSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;boss&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://www.zhipin.com/c100010000/?page=1&amp;ka=page-1&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    url = <span class="string">&#x27;https://www.zhipin.com/c100010000/?page=%d&#x27;</span></span><br><span class="line">    page_num = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#å›è°ƒå‡½æ•°æ¥æ”¶item</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):</span><br><span class="line">        item = response.meta[<span class="string">&#x27;item&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        job_desc = response.xpath(<span class="string">&#x27;//*[@id=&quot;main&quot;]/div[3]/div/div[2]/div[2]/div[1]/div//text()&#x27;</span>).extract()</span><br><span class="line">        job_desc = <span class="string">&#x27;&#x27;</span>.join(job_desc)</span><br><span class="line">        <span class="built_in">print</span>(job_desc)</span><br><span class="line">        item[<span class="string">&#x27;job_desc&#x27;</span>] = job_desc</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line">    <span class="comment">#è§£æé¦–é¡µä¸­çš„å²—ä½åç§°</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        li_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;main&quot;]/div/div[2]/ul/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            item = BossproItem()</span><br><span class="line"></span><br><span class="line">            job_name = li.xpath(<span class="string">&#x27;.//div/div[1]/div[1]/div/div[1]/span[1]/a/text()&#x27;</span>).extract_first()</span><br><span class="line">            item[<span class="string">&#x27;job_name&#x27;</span>] = job_name</span><br><span class="line">            <span class="built_in">print</span>(job_name)</span><br><span class="line">            detail_url = <span class="string">&#x27;https://www.zhipin.com&#x27;</span> + li.xpath(<span class="string">&#x27;.//div/div[1]/div[1]/div/div[1]/span[1]/a/@href&#x27;</span>).extract_first()</span><br><span class="line">            <span class="comment">#å¯¹è¯¦æƒ…é¡µå‘è¯·æ±‚è·å–è¯¦æƒ…é¡µçš„é¡µé¢æºç æ•°æ®</span></span><br><span class="line">            <span class="comment">#æ‰‹åŠ¨è¯·æ±‚çš„å‘é€</span></span><br><span class="line">            <span class="comment">#è¯·æ±‚ä¼ å‚ï¼šmeta=&#123;&#125;ï¼Œå¯ä»¥å°†metaå­—å…¸ä¼ é€’ç»™è¯·æ±‚å¯¹åº”çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(detail_url,callback=self.parse_detail,meta=&#123;<span class="string">&#x27;item&#x27;</span>:item&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#åˆ†é¡µæ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span> self.page_num &lt;= <span class="number">5</span>:</span><br><span class="line">            new_url = <span class="built_in">format</span>(self.url%self.page_num)</span><br><span class="line">            self.page_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(new_url,callback=self.parse)</span><br></pre></td></tr></table></figure>

<h2 id="9-scrapyå›¾ç‰‡çˆ¬å–"><a href="#9-scrapyå›¾ç‰‡çˆ¬å–" class="headerlink" title="9. scrapyå›¾ç‰‡çˆ¬å–"></a>9. scrapyå›¾ç‰‡çˆ¬å–</h2><p><strong>å›¾ç‰‡æ•°æ®çˆ¬å–ä¹‹ImagesPiplineï¼š</strong></p>
<ul>
<li><p>åŸºäºscrapyçˆ¬å–å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®å’Œçˆ¬å–å›¾ç‰‡ç±»å‹çš„æ•°æ®åŒºåˆ«ï¼Ÿ</p>
<ul>
<li>å­—ç¬¦ä¸²ï¼šåªéœ€è¦åŸºäºxpathè¿›è¡Œè§£æä¸”æäº¤ç®¡é“è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</li>
<li>å›¾ç‰‡ï¼šxpathè§£æå‡ºå›¾ç‰‡çš„srcå±æ€§å€¼ï¼Œå•ç‹¬çš„å¯¹å›¾ç‰‡åœ°å€å‘èµ·è¯·æ±‚è·å–äºŒè¿›åˆ¶ç±»å‹çš„æ•°æ®</li>
</ul>
</li>
<li><p><strong>ImagesPipelineï¼š</strong></p>
<ul>
<li>åªéœ€è¦å°†imgçš„srcçš„å±æ€§å€¼è¿›è¡Œè§£æï¼Œæäº¤åˆ°ç®¡é“ï¼Œç®¡é“å°±ä¼šå¯¹å›¾ç‰‡çš„srcè¿›è¡Œè¯·æ±‚å‘é€è·å–å›¾ç‰‡çš„äºŒè¿›åˆ¶ç±»å‹çš„æ•°æ®ï¼Œä¸”è¿˜ä¼šå¸®æˆ‘ä»¬è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨ã€‚</li>
</ul>
</li>
<li><p><strong>éœ€æ±‚ï¼š</strong>çˆ¬å–ç«™é•¿ç´ æçš„é«˜æ¸…å›¾ç‰‡</p>
</li>
<li><p><strong>ä½¿ç”¨æµç¨‹ï¼š</strong></p>
<ul>
<li>æ•°æ®è§£æï¼ˆå›¾ç‰‡çš„åœ°å€ï¼‰</li>
<li>å°†å­˜å‚¨å›¾ç‰‡åœ°å€çš„itemæäº¤åˆ°æŒ‡å®šçš„ç®¡é“ç±»</li>
<li>åœ¨ç®¡é“æ–‡ä»¶ä¸­è‡ªå·±å®šåˆ¶ä¸€ä¸ªåŸºäºImagesPipeLineçš„ä¸€ä¸ªç®¡é“ç±»<ul>
<li><code>get_media_request( )</code></li>
<li><code>file_path</code></li>
<li><code>item_completed</code></li>
</ul>
</li>
<li>åœ¨é…ç½®æ–‡ä»¶ä¸­æ“ä½œ<ul>
<li>æŒ‡å®šå›¾ç‰‡å­˜å‚¨ç›®å½•ï¼š<code>IMAGES_STORE = &#39;./imgs_ZYZhang&#39;</code></li>
<li>æŒ‡å®šå¼€å¯çš„ç®¡é“ï¼šè‡ªå®šåˆ¶çš„ç®¡é“ç±»</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;----------------çˆ¬å–ç«™é•¿ç´ æé«˜æ¸…å›¾ç‰‡  img.py-----------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> imgsPro.items <span class="keyword">import</span> ImgsproItem</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImgSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;img&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://sc.chinaz.com/tupian/&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        div_list = response.xpath(<span class="string">&#x27;//div[@id=&quot;container&quot;]/div&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            <span class="comment">#æ³¨æ„ï¼šä½¿ç”¨ä¼ªå±æ€§ src2</span></span><br><span class="line">            src = <span class="string">&#x27;https:&#x27;</span> + div.xpath(<span class="string">&#x27;./div/a/img/@src2&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            item = ImgsproItem()</span><br><span class="line">            item[<span class="string">&#x27;src&#x27;</span>] = src</span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;----------------------çˆ¬å–ç«™é•¿ç´ æé«˜æ¸…å›¾ç‰‡  pipelines.py---------------------------&#x27;&#x27;&#x27;</span>            </span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># class ImgsproPipeline(object):</span></span><br><span class="line"><span class="comment">#     def process_item(self, item, spider):</span></span><br><span class="line"><span class="comment">#         return item</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.pipelines.images <span class="keyword">import</span> ImagesPipeline</span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">imgsPileLine</span>(<span class="title class_ inherited__">ImagesPipeline</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment">#å¯ä»¥æ ¹æ®å›¾ç‰‡åœ°å€è¿›è¡Œå›¾ç‰‡æ•°æ®çš„è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_media_requests</span>(<span class="params">self, item, info</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> scrapy.Request(item[<span class="string">&#x27;src&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æŒ‡å®šå›¾ç‰‡å­˜å‚¨çš„è·¯å¾„</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">file_path</span>(<span class="params">self, request, response=<span class="literal">None</span>, info=<span class="literal">None</span></span>):</span><br><span class="line">        imgName = request.url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> imgName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">item_completed</span>(<span class="params">self, results, item, info</span>):</span><br><span class="line">        <span class="keyword">return</span> item <span class="comment">#è¿”å›ç»™ä¸‹ä¸€ä¸ªå³å°†è¢«æ‰§è¡Œçš„ç®¡é“ç±»</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;---------------------------------çˆ¬å–ç«™é•¿ç´ æé«˜æ¸…å›¾ç‰‡  items.py-----------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define here the models for your scraped items</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># https://doc.scrapy.org/en/latest/topics/items.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ImgsproItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    src = scrapy.Field()</span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;------------------------------çˆ¬å–ç«™é•¿ç´ æé«˜æ¸…å›¾ç‰‡ setting.pyéƒ¨åˆ†ä»£ç -------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#æŒ‡å®šå›¾ç‰‡å­˜å‚¨çš„ç›®å½•</span></span><br><span class="line">IMAGES_STORE = <span class="string">&#x27;./imgs_ZYZhang&#x27;</span></span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;imgsPro.pipelines.imgsPileLine&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line">LOG_LEVEL = <span class="string">&#x27;ERROR&#x27;</span></span><br><span class="line"><span class="comment"># Crawl responsibly by identifying yourself (and your website) on the user-agent</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Obey robots.txt rules</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h2 id="10-ä¸­é—´ä»¶"><a href="#10-ä¸­é—´ä»¶" class="headerlink" title="10. ä¸­é—´ä»¶"></a>10. ä¸­é—´ä»¶</h2><ul>
<li><strong>ä¸‹è½½ä¸­é—´ä»¶ï¼š</strong><ul>
<li>ä½ç½®ï¼šå¼•æ“å’Œä¸‹è½½å™¨ä¹‹é—´</li>
<li>ä½œç”¨ï¼šæ‰¹é‡æ‹¦æˆªåˆ°æ•´ä¸ªå·¥ç¨‹ä¸­æ‰€æœ‰çš„è¯·æ±‚å’Œå“åº”</li>
<li>æ‹¦æˆªè¯·æ±‚ï¼š<ul>
<li>UAä¼ªè£…ï¼š<code>process_request</code></li>
<li>ä»£ç†IPï¼š<code>process_exception:return request</code></li>
</ul>
</li>
<li>æ‹¦æˆªå“åº”ï¼š<ul>
<li>ç¯¡æ”¹å“åº”æ•°æ®ï¼Œå“åº”å¯¹è±¡</li>
<li>ç½‘æ˜“æ–°é—»çˆ¬å–</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="11-ç½‘æ˜“æ–°é—»"><a href="#11-ç½‘æ˜“æ–°é—»" class="headerlink" title="11. ç½‘æ˜“æ–°é—»"></a>11. ç½‘æ˜“æ–°é—»</h2><p><strong>éœ€æ±‚ï¼š</strong>çˆ¬å–ç½‘æ˜“æ–°é—»çš„æ–°é—»æ•°æ®ï¼ˆæ ‡é¢˜å’Œå†…å®¹ï¼‰</p>
<ul>
<li>é€šè¿‡ç½‘æ˜“æ–°é—»çš„é¦–é¡µè§£æå‡ºå‡ å¤§æ¿å—å¯¹åº”çš„è¯¦æƒ…é¡µçš„urlï¼ˆç»éªŒè¯ï¼Œæ— åŠ¨æ€åŠ è½½ï¼‰</li>
<li>æ¯ä¸ªæ¿å—ç‚¹å‡»åï¼Œå…¶ä¸­çš„æ–°é—»æ ‡é¢˜éƒ½æ˜¯åŠ¨æ€åŠ è½½å‡ºæ¥çš„ï¼ˆåŠ¨æ€åŠ è½½ï¼‰</li>
<li>é€šè¿‡è§£æå‡ºæ¯ä¸€æ¡æ–°é—»è¯¦æƒ…é¡µçš„urlï¼Œè·å–è¯¦æƒ…é¡µçš„é¡µé¢æºç ï¼Œè§£æå‡ºæ–°é—»å†…å®¹</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;-------------------------------ç½‘æ˜“æ–°é—»  wangyi.py------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> wangyiPro.items <span class="keyword">import</span> WangyiproItem</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WangyiSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;wangyi&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.cccom&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;https://news.163.com/&#x27;</span>]</span><br><span class="line">    models_urls = []  <span class="comment">#å­˜å‚¨äº”ä¸ªæ¿å—å¯¹åº”è¯¦æƒ…é¡µçš„url</span></span><br><span class="line">    <span class="comment">#è§£æäº”å¤§æ¿å—å¯¹åº”è¯¦æƒ…é¡µçš„url</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#å®ä¾‹åŒ–ä¸€ä¸ªæµè§ˆå™¨å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.bro = webdriver.Chrome(executable_path=<span class="string">&#x27;F:\PythonProjects\çˆ¬è™«\åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†\chromedriver.exe&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        li_list = response.xpath(<span class="string">&#x27;//*[@id=&quot;index2016_wrap&quot;]/div[1]/div[2]/div[2]/div[2]/div[2]/div/ul/li&#x27;</span>)</span><br><span class="line">        alist = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> alist:</span><br><span class="line">            model_url = li_list[index].xpath(<span class="string">&#x27;./a/@href&#x27;</span>).extract_first()</span><br><span class="line">            self.models_urls.append(model_url)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#ä¾æ¬¡å¯¹æ¯ä¸€ä¸ªæ¿å—å¯¹åº”çš„é¡µé¢è¿›è¡Œè¯·æ±‚</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> self.models_urls:      <span class="comment">#å¯¹æ¯ä¸€ä¸ªæ¿å—çš„urlè¿›è¡Œè¯·æ±‚å‘é€</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url,callback=self.parse_model)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#æ¯ä¸€ä¸ªæ¿å—å¯¹åº”çš„æ–°é—»æ ‡é¢˜ç›¸å…³çš„å†…å®¹éƒ½æ˜¯åŠ¨æ€åŠ è½½</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_model</span>(<span class="params">self,response</span>):    <span class="comment">#è§£ææ¯ä¸€ä¸ªæ¿å—é¡µé¢ä¸­å¯¹åº”æ–°é—»çš„æ ‡é¢˜å’Œæ–°é—»è¯¦æƒ…é¡µçš„url</span></span><br><span class="line">        <span class="comment"># response.xpath()</span></span><br><span class="line">        div_list = response.xpath(<span class="string">&#x27;/html/body/div/div[3]/div[4]/div[1]/div/div/ul/li/div/div&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> div <span class="keyword">in</span> div_list:</span><br><span class="line">            title = div.xpath(<span class="string">&#x27;./div/div[1]/h3/a/text()&#x27;</span>).extract_first()</span><br><span class="line">            new_detail_url = div.xpath(<span class="string">&#x27;./div/div[1]/h3/a/@href&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            item = WangyiproItem()</span><br><span class="line">            item[<span class="string">&#x27;title&#x27;</span>] = title</span><br><span class="line"></span><br><span class="line">            <span class="comment">#å¯¹æ–°é—»è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚</span></span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=new_detail_url, callback=self.parse_detail, meta=&#123;<span class="string">&#x27;item&#x27;</span>: item&#125;)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):       <span class="comment"># è§£ææ–°é—»å†…å®¹</span></span><br><span class="line">        content = response.xpath(<span class="string">&#x27;//*[@id=&quot;content&quot;]/div[2]//text()&#x27;</span>).extract()</span><br><span class="line">        content = <span class="string">&#x27;&#x27;</span>.join(content)</span><br><span class="line">        item = response.meta[<span class="string">&#x27;item&#x27;</span>]</span><br><span class="line">        item[<span class="string">&#x27;content&#x27;</span>] = content</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">closed</span>(<span class="params">self, spider</span>):</span><br><span class="line">        self.bro.quit()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;-------------------------------ç½‘æ˜“æ–°é—»  pipelines.py-----------------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WangyiproPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;-------------------------------ç½‘æ˜“æ–°é—»  middlewares.py-------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define here the models for your spider middleware</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># https://doc.scrapy.org/en/latest/topics/spider-middleware.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> signals</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WangyiproDownloaderMiddleware</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="comment"># Not all methods need to be defined. If a method is not defined,</span></span><br><span class="line">    <span class="comment"># scrapyæ¡†æ¶ acts as if the downloader middleware does not modify the</span></span><br><span class="line">    <span class="comment"># passed objects.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_request</span>(<span class="params">self, request, spider</span>):</span><br><span class="line">        <span class="comment"># Called for each request that goes through the downloader</span></span><br><span class="line">        <span class="comment"># middleware.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Must either:</span></span><br><span class="line">        <span class="comment"># - return None: continue processing this request</span></span><br><span class="line">        <span class="comment"># - or return a Response object</span></span><br><span class="line">        <span class="comment"># - or return a Request object</span></span><br><span class="line">        <span class="comment"># - or raise IgnoreRequest: process_exception() methods of</span></span><br><span class="line">        <span class="comment">#   installed downloader middleware will be called</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># é€šè¿‡è¯¥æ–¹æ³•æ‹¦æˆªäº”å¤§æ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡ï¼Œè¿›è¡Œç¯¡æ”¹ï¼Œä½¿å…¶æ»¡è¶³éœ€æ±‚</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_response</span>(<span class="params">self, request, response, spider</span>):    <span class="comment">#spiderçˆ¬è™«å¯¹è±¡</span></span><br><span class="line">        bro = spider.bro  <span class="comment">#è·å–äº†åœ¨çˆ¬è™«ç±»ä¸­å®šä¹‰çš„æµè§ˆå™¨å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#æŒ‘é€‰å‡ºæŒ‡å®šçš„å“åº”å¯¹è±¡è¿›è¡Œç¯¡æ”¹</span></span><br><span class="line">        <span class="comment">#    é€šè¿‡urlæŒ‡å®šrequest</span></span><br><span class="line">        <span class="comment">#    é€šè¿‡requestæŒ‡å®šresponse</span></span><br><span class="line">        <span class="keyword">if</span> request.url <span class="keyword">in</span> spider.models_urls:</span><br><span class="line">            bro.get(request.url)   <span class="comment">#äº”ä¸ªæ¿å—å¯¹åº”çš„urlè¿›è¡Œè¯·æ±‚</span></span><br><span class="line">            sleep(<span class="number">3</span>)</span><br><span class="line">            page_text = bro.page_source  <span class="comment">#åŒ…å«äº†åŠ¨æ€åŠ è½½çš„æ–°é—»æ•°æ®</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">#response #äº”å¤§æ¿å—å¯¹åº”çš„å“åº”å¯¹è±¡</span></span><br><span class="line">            <span class="comment">#é’ˆå¯¹å®šä½åˆ°çš„è¿™äº›responseè¿›è¡Œç¯¡æ”¹</span></span><br><span class="line">            <span class="comment">#å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å“åº”å¯¹è±¡ï¼ˆç¬¦åˆéœ€æ±‚ï¼šåŒ…å«åŠ¨æ€åŠ è½½å‡ºçš„æ–°é—»æ•°æ®ï¼‰ï¼Œæ›¿ä»£åŸæ¥æ—§çš„å“åº”å¯¹è±¡</span></span><br><span class="line">            <span class="comment">#å¦‚ä½•è·å–åŠ¨æ€åŠ è½½å‡ºçš„æ–°é—»æ•°æ®ï¼Ÿ</span></span><br><span class="line">                <span class="comment">#åŸºäºseleniumä¾¿æ·çš„è·å–åŠ¨æ€åŠ è½½æ•°æ®</span></span><br><span class="line">            new_response = HtmlResponse(url=request.url, body=page_text, encoding=<span class="string">&#x27;utf-8&#x27;</span>, request=request)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> new_response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#response #å…¶ä»–è¯·æ±‚å¯¹åº”çš„å“åº”å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_exception</span>(<span class="params">self, request, exception, spider</span>):</span><br><span class="line">        <span class="comment"># Called when a download handler or a process_request()</span></span><br><span class="line">        <span class="comment"># (from other downloader middleware) raises an exception.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Must either:</span></span><br><span class="line">        <span class="comment"># - return None: continue processing this exception</span></span><br><span class="line">        <span class="comment"># - return a Response object: stops process_exception() chain</span></span><br><span class="line">        <span class="comment"># - return a Request object: stops process_exception() chain</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;-----------------------------ç½‘æ˜“æ–°é—» setting.pyéƒ¨åˆ†ä»£ç ---------------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">#USER_AGENT = &#x27;wangyiPro (+http://www.yourdomain.com)&#x27;</span></span><br><span class="line">USER_AGENT = <span class="string">&#x27;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Obey robots.txt rules</span></span><br><span class="line">ROBOTSTXT_OBEY = <span class="literal">False</span></span><br><span class="line"><span class="comment"># Enable or disable downloader middlewares</span></span><br><span class="line"><span class="comment"># See https://doc.scrapy.org/en/latest/topics/downloader-middleware.html</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">   <span class="string">&#x27;wangyiPro.middlewares.WangyiproDownloaderMiddleware&#x27;</span>: <span class="number">543</span>,</span><br><span class="line">&#125;</span><br><span class="line">ITEM_PIPELINES = &#123;</span><br><span class="line">   <span class="string">&#x27;wangyiPro.pipelines.WangyiproPipeline&#x27;</span>: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line">LOG_LEVEL = <span class="string">&#x27;ERROR&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="12-CrawlSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–"><a href="#12-CrawlSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–" class="headerlink" title="12. CrawlSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–"></a>12. CrawlSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–</h2><p><strong>CrawlSpiderï¼š</strong>åŸºäºSpiderçš„ä¸€ä¸ªå­ç±»</p>
<ul>
<li>å…¨ç«™æ•°æ®çˆ¬å–çš„æ–¹å¼<ul>
<li>åŸºäºSpiderï¼šæ‰‹åŠ¨è¯·æ±‚å‘é€</li>
<li>åŸºäºCrawlSpider</li>
</ul>
</li>
<li>CrawlSpiderçš„ä½¿ç”¨ï¼š<ul>
<li>åˆ›å»ºä¸€ä¸ªå·¥ç¨‹</li>
<li>cd  XXX</li>
<li>åˆ›å»ºçˆ¬è™«æ–‡ä»¶ï¼ˆCrawlSpiderï¼‰<ul>
<li><code>scrapy  genspider  -t  crawl  xxx   www.xxxx.com</code></li>
<li><strong>é“¾æ¥æå–å™¨ï¼ˆLinkExtractorï¼‰ï¼š</strong>æ ¹æ®æŒ‡å®šè§„åˆ™ï¼ˆallow&#x3D;â€æ­£åˆ™â€ï¼‰è¿›è¡ŒæŒ‡å®šé“¾æ¥çš„æå–</li>
<li><strong>è§„åˆ™è§£æå™¨ï¼ˆRuleï¼‰ï¼š</strong>å°†é“¾æ¥æå–å™¨æå–åˆ°çš„é“¾æ¥è¿›è¡ŒæŒ‡å®šè§„åˆ™ï¼ˆcallbackï¼‰çš„è§£ææ“ä½œ</li>
</ul>
</li>
</ul>
</li>
<li><strong>éœ€æ±‚ï¼š</strong>çˆ¬å–é˜³å…‰çƒ­çº¿ç½‘ç«™ä¸­çš„ç¼–å·ï¼Œæ–°é—»æ ‡é¢˜ï¼Œæ–°é—»å†…å®¹ï¼Œæ ‡å·<ul>
<li>åˆ†æï¼šçˆ¬å–çš„æ•°æ®æ²¡æœ‰åœ¨åŒä¸€å¼ é¡µé¢ä¸­</li>
<li><ol>
<li>å¯ä»¥ä½¿ç”¨é“¾æ¥æå–å™¨æå–æ‰€æœ‰çš„é¡µç é“¾æ¥</li>
<li>è®©é“¾æ¥æå–å™¨æå–æ‰€æœ‰çš„é—®æ”¿è¯¦æƒ…é¡µé“¾æ¥</li>
</ol>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;---------------------é˜³å…‰é—®æ”¿    sun.py---------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;ç½‘ç«™é¡µé¢æºç è·Ÿè§†é¢‘è¯¾æœ‰æ”¹åŠ¨ï¼Œå»ºè®®followå…ˆæ”¹Falseçˆ¬ä¸€ä¸‹ï¼Œä¸ç„¶å®¹æ˜“è¢«å°IPï¼Œæœ‰å…´è¶£çš„å¯ä»¥æ”¹æ”¹ï¼Œæä¸ªä»£ç†å•¥çš„å†çˆ¬&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.linkextractors <span class="keyword">import</span> LinkExtractor</span><br><span class="line"><span class="keyword">from</span> scrapy.spiders <span class="keyword">import</span> CrawlSpider, Rule</span><br><span class="line"><span class="keyword">from</span> sunPro.items <span class="keyword">import</span> SunproItem, DetailItem</span><br><span class="line"></span><br><span class="line"><span class="comment"># éœ€æ±‚ï¼šçˆ¬å–é˜³å…‰çƒ­çº¿ç½‘ç«™ä¸­çš„ç¼–å·ï¼Œæ–°é—»æ ‡é¢˜ï¼Œæ–°é—»å†…å®¹ï¼Œæ ‡å·</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SunSpider</span>(<span class="title class_ inherited__">CrawlSpider</span>):</span><br><span class="line">    name = <span class="string">&#x27;sun&#x27;</span></span><br><span class="line">    <span class="comment"># allowed_domains = [&#x27;www.xxx.com&#x27;]</span></span><br><span class="line">    start_urls = [<span class="string">&#x27;http://wz.sun0769.com/political/index/politicsNewest?id=1&amp;page=&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment">#é“¾æ¥æå–å™¨ï¼šæ ¹æ®æŒ‡å®šè§„åˆ™ï¼ˆallow=&quot;æ­£åˆ™&quot;ï¼‰è¿›è¡ŒæŒ‡å®šé“¾æ¥çš„æå–</span></span><br><span class="line">    link = LinkExtractor(allow=<span class="string">r&#x27;id=1&amp;page=\d+&#x27;</span>)</span><br><span class="line">    link_detail = LinkExtractor(allow=<span class="string">r&#x27;index\?id=\d+&#x27;</span>)</span><br><span class="line">    rules = (</span><br><span class="line">        <span class="comment">#è§„åˆ™è§£æå™¨ï¼šå°†é“¾æ¥æå–å™¨æå–åˆ°çš„é“¾æ¥è¿›è¡ŒæŒ‡å®šè§„åˆ™ï¼ˆcallbackï¼‰çš„è§£ææ“ä½œ</span></span><br><span class="line">        Rule(link, callback=<span class="string">&#x27;parse_item&#x27;</span>, follow=<span class="literal">False</span>),</span><br><span class="line">        <span class="comment">#follow=Trueï¼šå¯ä»¥å°†é“¾æ¥æå–å™¨ ç»§ç»­ä½œç”¨åˆ° é“¾æ¥æå–å™¨æå–åˆ°çš„é“¾æ¥ æ‰€å¯¹åº”çš„é¡µé¢ä¸­</span></span><br><span class="line">        Rule(link_detail, callback=<span class="string">&#x27;parse_detail&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    <span class="comment">#http://wz.sun0769.com/political/politics/index?id=490505</span></span><br><span class="line">    <span class="comment">#http://wz.sun0769.com/political/politics/index?id=490504</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># è§£ææ–°é—»ç¼–å·å’Œæ–°é—»çš„æ ‡é¢˜</span></span><br><span class="line">    <span class="comment"># å¦‚ä¸‹ä¸¤ä¸ªè§£ææ–¹æ³•ä¸­æ˜¯ä¸å¯ä»¥å®ç°è¯·æ±‚ä¼ å‚ï¼</span></span><br><span class="line">    <span class="comment"># æ— æ³•å°†ä¸¤ä¸ªè§£ææ–¹æ³•è§£æçš„æ•°æ®å­˜å‚¨åˆ°åŒä¸€ä¸ªitemä¸­ï¼Œå¯ä»¥ä¾æ¬¡å­˜å‚¨åˆ°ä¸¤ä¸ªitemä¸­</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_item</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment">#æ³¨æ„ï¼šxpathè¡¨è¾¾å¼ä¸­ä¸å¯ä»¥å‡ºç°tbodyæ ‡ç­¾</span></span><br><span class="line">        li_list = response.xpath(<span class="string">&#x27;/html//div[2]/div[3]/ul[2]/li&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> li <span class="keyword">in</span> li_list:</span><br><span class="line">            new_num = li.xpath(<span class="string">&#x27;./span[1]/text()&#x27;</span>).extract_first()</span><br><span class="line">            new_title = li.xpath(<span class="string">&#x27;./span[3]/a/text()&#x27;</span>).extract_first()</span><br><span class="line"></span><br><span class="line">            item = SunproItem()</span><br><span class="line">            item[<span class="string">&#x27;title&#x27;</span>] = new_title</span><br><span class="line">            item[<span class="string">&#x27;new_num&#x27;</span>] = new_num</span><br><span class="line"></span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line"></span><br><span class="line">    <span class="comment">#è§£ææ–°é—»å†…å®¹å’Œæ–°é—»ç¼–å·</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_detail</span>(<span class="params">self,response</span>):</span><br><span class="line">        new_id = response.xpath(<span class="string">&#x27;/html//div[3]/div[2]/div[2]/div[1]/span[4]/text()&#x27;</span>).extract_first().strip().replace(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        new_content = response.xpath(<span class="string">&#x27;/html//div[3]/div[2]/div[2]/div[2]/pre/text()&#x27;</span>).extract()</span><br><span class="line">        new_content = <span class="string">&#x27;&#x27;</span>.join(new_content)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># print(new_id,new_content)</span></span><br><span class="line">        item = DetailItem()</span><br><span class="line">        item[<span class="string">&#x27;content&#x27;</span>] = new_content</span><br><span class="line">        item[<span class="string">&#x27;new_id&#x27;</span>] = new_id</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> item</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;-------------------------------pipelines.py------------------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define your item pipelines here</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Don&#x27;t forget to add your pipeline to the ITEM_PIPELINES setting</span></span><br><span class="line"><span class="comment"># See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SunproPipeline</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_item</span>(<span class="params">self, item, spider</span>):</span><br><span class="line">        <span class="comment">#å¦‚ä½•åˆ¤å®šitemçš„ç±»å‹</span></span><br><span class="line">        <span class="comment">#å°†æ•°æ®å†™å…¥æ•°æ®åº“æ—¶ï¼Œå¦‚ä½•ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§</span></span><br><span class="line">        <span class="keyword">if</span> item.__class__.__name__ == <span class="string">&#x27;DetailItem&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(item[<span class="string">&#x27;new_id&#x27;</span>],item[<span class="string">&#x27;content&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(item[<span class="string">&#x27;new_num&#x27;</span>],item[<span class="string">&#x27;title&#x27;</span>])</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    </span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;---------------------------items.py----------------------&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define here the models for your scraped items</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># See documentation in:</span></span><br><span class="line"><span class="comment"># https://doc.scrapy.org/en/latest/topics/items.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SunproItem</span>(scrapy.Item):</span><br><span class="line">    <span class="comment"># define the fields for your item here like:</span></span><br><span class="line">    title = scrapy.Field()</span><br><span class="line">    new_num = scrapy.Field()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DetailItem</span>(scrapy.Item):</span><br><span class="line">    new_id = scrapy.Field()</span><br><span class="line">    content = scrapy.Field()</span><br></pre></td></tr></table></figure>

<h2 id="13-åˆ†å¸ƒå¼æ¦‚è¿°åŠæ­å»º"><a href="#13-åˆ†å¸ƒå¼æ¦‚è¿°åŠæ­å»º" class="headerlink" title="13. åˆ†å¸ƒå¼æ¦‚è¿°åŠæ­å»º"></a>13. åˆ†å¸ƒå¼æ¦‚è¿°åŠæ­å»º</h2><p><strong>åˆ†å¸ƒå¼çˆ¬è™«ï¼š</strong></p>
<ul>
<li>æ¦‚å¿µï¼šæˆ‘ä»¬éœ€è¦æ­å»ºä¸€ä¸ªåˆ†å¸ƒå¼çš„æœºç¾¤ï¼Œè®©å…¶å¯¹ä¸€ç»„èµ„æºè¿›è¡Œåˆ†å¸ƒè”åˆçˆ¬å–ã€‚</li>
<li>ä½œç”¨ï¼šæå‡çˆ¬å–æ•°æ®çš„æ•ˆç‡</li>
</ul>
<p><strong>å¦‚ä½•å®ç°åˆ†å¸ƒå¼ï¼Ÿ</strong></p>
<ul>
<li>å®‰è£…ä¸€ä¸ªscrapy-redisçš„ç»„ä»¶</li>
<li>åŸç”Ÿçš„scrapyæ˜¯ä¸å¯ä»¥å®ç°åˆ†å¸ƒå¼çˆ¬è™«çš„ï¼Œå¿…é¡»è¦è®©scrapy-redisç»„ä»¶ä¸€èµ·å®ç°åˆ†å¸ƒå¼çˆ¬è™«ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆåŸç”Ÿçš„scrapyä¸å¯ä»¥å®ç°åˆ†å¸ƒå¼ï¼Ÿ</strong></p>
<ul>
<li>è°ƒåº¦å™¨ä¸å¯ä»¥è¢«åˆ†å¸ƒå¼æœºç¾¤å…±äº«</li>
<li>ç®¡é“ä¸å¯ä»¥è¢«åˆ†å¸ƒå¼æœºç¾¤å…±äº«</li>
</ul>
<p><strong>scrapy-redisç»„ä»¶ä½œç”¨ï¼š</strong></p>
<ul>
<li>å¯ä»¥ç»™åŸç”Ÿçš„scrapyæ¡†æ¶æä¾›å¯ä»¥è¢«å…±äº«çš„<em>ç®¡é“</em>å’Œ<em>è°ƒåº¦å™¨</em>ã€‚</li>
</ul>
<p><strong>scrapy-rediså®ç°æµç¨‹ï¼š</strong></p>
<ul>
<li><p>åˆ›å»ºä¸€ä¸ªå·¥ç¨‹</p>
</li>
<li><p>åˆ›å»ºä¸€ä¸ªåŸºäºCrawlSpiderçš„çˆ¬è™«æ–‡ä»¶</p>
</li>
<li><p>ä¿®æ”¹å½“å‰çš„çˆ¬è™«æ–‡ä»¶ï¼š</p>
<ul>
<li>å¯¼åŒ…ï¼š<code>from scrapy_redis.spiders  import  RedisCrawlSpider</code></li>
<li>å°†start_urlså’Œallowed_domainsè¿›è¡Œæ³¨é‡Š</li>
<li>æ·»åŠ ä¸€ä¸ªæ–°å±æ€§ï¼šredis_key &#x3D; â€˜   â€˜ å¯ä»¥è¢«å…±äº«çš„è°ƒåº¦å™¨é˜Ÿåˆ—çš„åç§°</li>
<li>ç¼–å†™æ•°æ®è§£æç›¸å…³çš„æ“ä½œ</li>
<li>å°†å½“å‰çˆ¬è™«ç±»çš„çˆ¶ç±»ä¿®æ”¹æˆ RedisCrawlSpider</li>
</ul>
</li>
<li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶settings</p>
<ul>
<li><p>æŒ‡å®šä½¿ç”¨å¯ä»¥è¢«å…±äº«çš„ç®¡é“ï¼š</p>
</li>
<li><p><code>ITEM_PIPELINES = &#123;   &#39;scrapy_redis.pipelines.RedisPipeline&#39;: 400 &#125;</code></p>
</li>
<li><p>æŒ‡å®šè°ƒåº¦å™¨ï¼š</p>
</li>
<li><p>å¢åŠ äº†ä¸€ä¸ªå»é‡å®¹å™¨ç±»çš„é…ç½®ï¼Œä½œç”¨æ˜¯ç”¨Redisçš„seté›†åˆæ¥å­˜å‚¨è¯·æ±‚çš„æŒ‡çº¹æ•°æ®ï¼Œä»è€Œå®ç°è¯·æ±‚å»é‡çš„æŒä¹…åŒ–</p>
<p>  <code>DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;</code></p>
<p>  ä½¿ç”¨scrapy-redisç»„ä»¶è‡ªå·±çš„è°ƒåº¦å™¨</p>
<p>  <code>SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;</code></p>
<p>  é…ç½®è°ƒåº¦å™¨æ˜¯å¦è¦æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯å½“çˆ¬è™«ç»“æŸäº†ï¼Œè¦ä¸è¦æ¸…ç©ºRedisä¸­è¯·æ±‚é˜Ÿåˆ—å’Œå»é‡æŒ‡çº¹çš„setã€‚å¦‚æœæ˜¯Trueï¼Œå°±è¡¨ç¤ºè¦æŒä¹…åŒ–å­˜å‚¨ï¼Œå°±ä¸æ¸…æ•°æ®ï¼Œå¦åˆ™æ¸…ç©ºæ•°æ®</p>
<p>  <code>SCHEDULER_PERSIST = True</code></p>
</li>
<li><p>æŒ‡å®šredisæœåŠ¡å™¨</p>
</li>
</ul>
</li>
<li><p>redisç›¸å…³æ“ä½œé…ç½®ï¼š</p>
<ul>
<li>é…ç½®redisçš„é…ç½®æ–‡ä»¶ï¼š<ul>
<li>linuxæˆ–è€…macï¼š<code>redis.conf</code></li>
<li>windowsï¼š<code>redis.windows.conf</code></li>
<li>æ‰“å¼€é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š<ul>
<li>å°†<code>bind 127.0.0.1</code>è¿›è¡Œæ³¨é‡Šæˆ–åˆ é™¤</li>
<li>å…³é—­ä¿æŠ¤æ¨¡å¼ï¼š<code>protected-mode yes</code>æ”¹ä¸ºno</li>
</ul>
</li>
</ul>
</li>
<li>ç»“åˆç€é…ç½®æ–‡ä»¶å¼€å¯redisæœåŠ¡<ul>
<li>redis-server é…ç½®æ–‡ä»¶</li>
<li>å¯åŠ¨å®¢æˆ·ç«¯ï¼šredis-cli</li>
</ul>
</li>
</ul>
</li>
<li><p>æ‰§è¡Œå·¥ç¨‹ï¼š</p>
<ul>
<li><code>scrapy  runspider  xxx.py</code></li>
</ul>
</li>
<li><p>å‘è°ƒåº¦å™¨çš„é˜Ÿåˆ—ä¸­æ”¾å…¥ä¸€ä¸ªèµ·å§‹çš„urlï¼š</p>
<ul>
<li>è°ƒåº¦å™¨çš„é˜Ÿåˆ—åœ¨redisçš„å®¢æˆ·ç«¯ä¸­</li>
<li><code>lpush  xxx  www.xxx.com</code></li>
</ul>
</li>
<li><p>çˆ¬å–åˆ°çš„æ•°æ®å­˜å‚¨åœ¨äº† redis çš„ <code>proName:items</code> è¿™ä¸ªæ•°æ®ç»“æ„ä¸­</p>
</li>
</ul>
<h2 id="14-å¢é‡å¼çˆ¬è™«"><a href="#14-å¢é‡å¼çˆ¬è™«" class="headerlink" title="14. å¢é‡å¼çˆ¬è™«"></a>14. å¢é‡å¼çˆ¬è™«</h2><ul>
<li><strong>æ¦‚å¿µï¼š</strong>ç›‘æµ‹ç½‘ç«™æ•°æ®æ›´æ–°çš„æƒ…å†µï¼Œåªä¼šçˆ¬å–ç½‘ç«™æœ€æ–°æ›´æ–°å‡ºæ¥çš„æ•°æ®ã€‚</li>
<li><strong>åˆ†æï¼š</strong><ul>
<li>æŒ‡å®šä¸€ä¸ªèµ·å§‹url</li>
<li>åŸºäºCrawlSpiderè·å–å…¶ä»–é¡µç é“¾æ¥</li>
<li>åŸºäºRuleå°†å…¶ä»–é¡µç é“¾æ¥è¿›è¡Œè¯·æ±‚</li>
<li>ä»æ¯ä¸€ä¸ªé¡µç å¯¹åº”çš„é¡µé¢æºç ä¸­è§£æå‡ºæ¯ä¸€ä¸ªç”µå½±è¯¦æƒ…é¡µçš„URL</li>
<li>æ ¸å¿ƒï¼šæ£€æµ‹ç”µå½±è¯¦æƒ…é¡µçš„urlä¹‹å‰æœ‰æ²¡æœ‰è¯·æ±‚è¿‡<ul>
<li>å°†çˆ¬å–è¿‡çš„ç”µå½±è¯¦æƒ…é¡µçš„urlå­˜å‚¨</li>
<li>å­˜å‚¨åˆ°redisçš„setæ•°æ®ç»“æ„</li>
</ul>
</li>
<li>å¯¹è¯¦æƒ…é¡µçš„urlå‘èµ·è¯·æ±‚ï¼Œç„¶åè§£æå‡ºç”µå½±çš„åç§°å’Œç®€ä»‹</li>
<li>è¿›è¡ŒæŒä¹…åŒ–å­˜å‚¨</li>
</ul>
</li>
</ul>
<hr>
<h1 id="ä¹ã€è¡¥å……â€”â€”å¼‚æ­¥ç¼–ç¨‹"><a href="#ä¹ã€è¡¥å……â€”â€”å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="ä¹ã€è¡¥å……â€”â€”å¼‚æ­¥ç¼–ç¨‹"></a>ä¹ã€è¡¥å……â€”â€”å¼‚æ­¥ç¼–ç¨‹</h1><p><strong>ä¸ºä»€ä¹ˆè¦è®²ï¼Ÿ</strong></p>
<ul>
<li>è¿™ä¸€éƒ¨åˆ†çš„çŸ¥è¯†ç‚¹ä¸å¤ªå®¹æ˜“å­¦ä¹ ï¼ˆå¼‚æ­¥éé˜³å¡ã€ asyncioï¼‰</li>
<li>å¼‚æ­¥ç›¸å…³è¯é¢˜å’Œæ¡†æ¶è¶Šæ¥è¶Šå¤šï¼Œä¾‹å¦‚ï¼štornadoã€fastapiã€django 3.x asgiã€aiohttpéƒ½åœ¨å¼‚æ­¥â†’æå‡æ€§èƒ½</li>
</ul>
<p><strong>å¦‚ä½•è®²è§£ï¼Ÿ</strong></p>
<ul>
<li>ç¬¬ä¸€éƒ¨åˆ†ï¼šåç¨‹</li>
<li>ç¬¬äºŒéƒ¨åˆ†ï¼šasyncioæ¨¡å—è¿›è¡Œå¼‚æ­¥ç¼–ç¨‹</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹</li>
</ul>
<h2 id="1-åç¨‹"><a href="#1-åç¨‹" class="headerlink" title="1. åç¨‹"></a>1. åç¨‹</h2><p>åç¨‹ä¸æ˜¯è®¡ç®—æœºæä¾›ï¼Œç¨‹åºå‘˜äººä¸ºåˆ›é€ ã€‚</p>
<p>åç¨‹ï¼ˆ Coroutineï¼‰ï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸ºå¾®çº¿ç¨‹ï¼Œæ˜¯ä¸€ç§ç”¨æˆ·æ€å†…çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æŠ€æœ¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå…¶å®å°±æ˜¯é€šè¿‡ä¸€ä¸ªçº¿ç¨‹å®ç°ä»£ç å—ç›¸äº’åˆ‡æ¢æ‰§è¡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">func1()</span><br><span class="line">func2()</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°åç¨‹çš„é›†ä¸­æ–¹æ³•ï¼š</strong></p>
<ul>
<li>greeletï¼Œæ—©æœŸæ¨¡å—</li>
<li>yieldå…³é”®å­—</li>
<li>asyncioè£…é¥°å™¨ï¼ˆpy3.4åŠä»¥åç‰ˆæœ¬ï¼‰</li>
<li>asyncã€awaitå…³é”®å­—ï¼ˆpy3.5åŠä»¥åç‰ˆæœ¬ï¼‰</li>
</ul>
<h3 id="ï¼ˆ1ï¼‰greenletå®ç°åç¨‹"><a href="#ï¼ˆ1ï¼‰greenletå®ç°åç¨‹" class="headerlink" title="ï¼ˆ1ï¼‰greenletå®ç°åç¨‹"></a>ï¼ˆ1ï¼‰greenletå®ç°åç¨‹</h3><p><code>pip install greenlet</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> greenlet <span class="keyword">import</span> greenlet</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    gr2.switch()	<span class="comment">#åˆ‡æ¢åˆ°func2å‡½æ•°</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">    gr2.switch()	<span class="comment">#åˆ‡æ¢åˆ°func2å‡½æ•°ï¼Œä»ä¸Šä¸€æ¬¡æ‰§è¡Œçš„ä½ç½®ç»§ç»­å‘åæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">    gr1.switch()	<span class="comment">#åˆ‡æ¢åˆ°func1å‡½æ•°ï¼Œä»ä¸Šä¸€æ¬¡æ‰§è¡Œçš„ä½ç½®ç»§ç»­å‘åæ‰§è¡Œ</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">gr1 = greenlet(func1)</span><br><span class="line">gr2 = greenlet(func2)</span><br><span class="line">gr1.switch()		<span class="comment">#å»æ‰§è¡Œfunc1å‡½æ•°</span></span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ2ï¼‰yieldå…³é”®å­—"><a href="#ï¼ˆ2ï¼‰yieldå…³é”®å­—" class="headerlink" title="ï¼ˆ2ï¼‰yieldå…³é”®å­—"></a>ï¼ˆ2ï¼‰yieldå…³é”®å­—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> func2()</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">f1 = func1()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> f1:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ3ï¼‰asyncioè£…é¥°å™¨"><a href="#ï¼ˆ3ï¼‰asyncioè£…é¥°å™¨" class="headerlink" title="ï¼ˆ3ï¼‰asyncioè£…é¥°å™¨"></a>ï¼ˆ3ï¼‰asyncioè£…é¥°å™¨</h3><p>&#x3D;&#x3D;é‡åˆ°IOé˜»å¡è‡ªåŠ¨åˆ‡æ¢&#x3D;&#x3D;</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">2</span>)		<span class="comment">#é‡åˆ°IOè€—æ—¶æ“ä½œï¼Œè‡ªåŠ¨åŒ–åˆ‡æ¢åˆ°tasksä¸­çš„å…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line"><span class="meta">@asyncio.coroutine</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">from</span> asyncio.sleep(<span class="number">2</span>)		<span class="comment">#é‡åˆ°IOè€—æ—¶æ“ä½œï¼Œè‡ªåŠ¨åŒ–åˆ‡æ¢åˆ°tasksä¸­çš„å…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">tasks = [</span><br><span class="line">    asyncio.ensure_future(func1()),</span><br><span class="line">    asyncio.ensure_future(func2())</span><br><span class="line">]</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ4ï¼‰asyncã€awaitå…³é”®å­—ï¼ˆæ¨èï¼‰"><a href="#ï¼ˆ4ï¼‰asyncã€awaitå…³é”®å­—ï¼ˆæ¨èï¼‰" class="headerlink" title="ï¼ˆ4ï¼‰asyncã€awaitå…³é”®å­—ï¼ˆæ¨èï¼‰"></a>ï¼ˆ4ï¼‰asyncã€awaitå…³é”®å­—ï¼ˆæ¨èï¼‰</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)		<span class="comment">#é‡åˆ°IOè€—æ—¶æ“ä½œï¼Œè‡ªåŠ¨åŒ–åˆ‡æ¢åˆ°tasksä¸­çš„å…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)		<span class="comment">#é‡åˆ°IOè€—æ—¶æ“ä½œï¼Œè‡ªåŠ¨åŒ–åˆ‡æ¢åˆ°tasksä¸­çš„å…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line">tasks = [</span><br><span class="line">    asyncio.ensure_future(func1()),</span><br><span class="line">    asyncio.ensure_future(func2())</span><br><span class="line">]</span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure>

<h2 id="2-åç¨‹çš„æ„ä¹‰"><a href="#2-åç¨‹çš„æ„ä¹‰" class="headerlink" title="2. åç¨‹çš„æ„ä¹‰"></a>2. åç¨‹çš„æ„ä¹‰</h2><p>åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¦‚æœé‡åˆ°IOç­‰å¾…çš„æ—¶é—´ï¼Œçº¿ç¨‹ä¸ä¼šç­‰å¾…ï¼Œåˆ©ç”¨ç©ºé—²çš„æ—¶é—´å»åšå…¶ä»–çš„äº‹æƒ…ã€‚</p>
<p>éœ€æ±‚ï¼šä¸‹è½½ä¸‰å¼ å›¾ç‰‡ï¼ˆç½‘ç»œIOï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;æ™®é€šçš„requestæ–¹å¼&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹ä¸‹è½½ï¼š&#x27;</span>, url)</span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½å®Œæˆ&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    file_name = url.rsplit(<span class="string">&#x27;-&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">        file_object.write(response.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url_list = [</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/210302/000706-1614614826df15.jpg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/210228/010301-1614445381005c.jpg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/190902/152344-1567409024af8c.jpg&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> url_list:</span><br><span class="line">        download_image(item)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ä½¿ç”¨aiohttpæ¨¡å—ä¸‹è½½    åç¨‹æ–¹å¼&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">session, url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å‘é€è¯·æ±‚ï¼š&#x27;</span>, url)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, verify_ssl = <span class="literal">False</span>) <span class="keyword">as</span> response:</span><br><span class="line">        content = <span class="keyword">await</span> response.content.read()</span><br><span class="line">        file_name = url.rsplit(<span class="string">&#x27;-&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">            file_object.write(content)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½å®Œæˆ&#x27;</span>, url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        url_list = [</span><br><span class="line">            <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/210302/000706-1614614826df15.jpg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/210228/010301-1614445381005c.jpg&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/190902/152344-1567409024af8c.jpg&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        tasks = [asyncio.create_task(fetch(session, url)) <span class="keyword">for</span> url <span class="keyword">in</span> url_list]</span><br><span class="line">        <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#asyncio.run(main())     #æ­£å¸¸è¿è¡Œä½†æ˜¯ä¼šæŠ¥é”™,æ¢æˆloopæ–¹å¼å°±ok</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(main())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(time.time() - start)</span><br></pre></td></tr></table></figure>

<h2 id="3-å¼‚æ­¥ç¼–ç¨‹"><a href="#3-å¼‚æ­¥ç¼–ç¨‹" class="headerlink" title="3. å¼‚æ­¥ç¼–ç¨‹"></a>3. å¼‚æ­¥ç¼–ç¨‹</h2><h3 id="ï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯"><a href="#ï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯" class="headerlink" title="ï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯"></a>ï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯</h3><p><strong>æ¦‚å¿µï¼š</strong>ç†è§£ä¸ºä¸€ä¸ªæ­»å¾ªç¯ï¼Œå»æ£€æµ‹å¹¶æ‰§è¡ŒæŸäº›ä»£ç ã€‚</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># ä¼ªä»£ç </span></span><br><span class="line">ä»»åŠ¡åˆ—è¡¨ = [ä»»åŠ¡1 , ä»»åŠ¡2 , ä»»åŠ¡3 ....]</span><br><span class="line">while True:</span><br><span class="line"><span class="code">	å¯æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼Œå·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨--&gt;å»ä»»åŠ¡åˆ—è¡¨ä¸­æ£€æµ‹æ‰€æœ‰çš„ä»»åŠ¡ï¼Œå°†â€œå¯æ‰§è¡Œâ€å’Œâ€œå·²å®Œæˆâ€çš„ä»»åŠ¡è¿”å›</span></span><br><span class="line"><span class="code">	for å°±ç»ªä»»åŠ¡ in å¯æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨:</span></span><br><span class="line"><span class="code">		æ‰§è¡Œå·²å°±ç»ªçš„ä»»åŠ¡</span></span><br><span class="line"><span class="code">    for å·²å®Œæˆçš„ä»»åŠ¡ in å·²å®Œæˆçš„ä»»åŠ¡åˆ—è¡¨:</span></span><br><span class="line"><span class="code">    	åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ç§»é™¤ å·²å®Œæˆçš„ä»»åŠ¡</span></span><br><span class="line"><span class="code">    å¦‚æœ ä»»åŠ¡åˆ—è¡¨ ä¸­çš„ä»»åŠ¡éƒ½å·²ç»å®Œæˆï¼Œåˆ™ç»ˆæ­¢å¾ªç¯ã€‚</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="comment"># å»ç”Ÿæˆæˆ–è·å–ä¸€ä¸ªäº‹ä»¶å¾ªç¯</span></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line"><span class="comment"># å°†ä»»åŠ¡taskæ”¾åˆ° ä»»åŠ¡åˆ—è¡¨</span></span><br><span class="line">loop.run_until_complete(task)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ2ï¼‰å¿«é€Ÿä¸Šæ‰‹"><a href="#ï¼ˆ2ï¼‰å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ï¼ˆ2ï¼‰å¿«é€Ÿä¸Šæ‰‹"></a>ï¼ˆ2ï¼‰å¿«é€Ÿä¸Šæ‰‹</h3><p><strong>åç¨‹å‡½æ•°ï¼š</strong>å®šä¹‰å‡½æ•°æ—¶ <code>async def å‡½æ•°å</code></p>
<p><strong>åç¨‹å¯¹è±¡ï¼š</strong>æ‰§è¡Œ åç¨‹å‡½æ•° å¾—åˆ°çš„å¯¹è±¡</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line">result = func()</span><br></pre></td></tr></table></figure>

<!--æ³¨æ„ï¼šæ‰§è¡Œåç¨‹å‡½æ•°åˆ›å»ºåç¨‹å¯¹è±¡ï¼Œå‡½æ•°å†…éƒ¨ä»£ç ä¸ä¼šæ‰§è¡Œï¼-->

<!--å¦‚æœæƒ³è¦è¿è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç ï¼Œå¿…é¡»è¦å°†åç¨‹ä»£ç äº¤ç»™äº‹ä»¶å¾ªç¯æ¥å¤„ç†ã€‚-->

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;å¿«æ¥æ‰“æˆ‘å§ï¼&#x27;</span>)</span><br><span class="line">result = func()</span><br><span class="line"></span><br><span class="line">loop = asyncio.get_event_loop()</span><br><span class="line">loop.run_until_complete(result)</span><br><span class="line"><span class="comment">#asyncio.run(result)		#python3.7</span></span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ3ï¼‰awaitå…³é”®å­—"><a href="#ï¼ˆ3ï¼‰awaitå…³é”®å­—" class="headerlink" title="ï¼ˆ3ï¼‰awaitå…³é”®å­—"></a>ï¼ˆ3ï¼‰awaitå…³é”®å­—</h3><p><code>await å¯ç­‰å¾…çš„å¯¹è±¡(åç¨‹å¯¹è±¡ã€Futureå¯¹è±¡ã€Taskå¯¹è±¡)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹ä¸€&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ¥ç©å‘€&#x27;</span>)</span><br><span class="line">    response = <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸ&#x27;</span>, response)</span><br><span class="line"></span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹äºŒ&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">others</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¿”å›å€¼&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ‰§è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#é‡åˆ°IOæ“ä½œæŒ‚èµ·å½“å‰åç¨‹ï¼ˆä»»åŠ¡ï¼‰ï¼Œç­‰IOæ“ä½œå®Œæˆä»¥åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œå½“å‰åç¨‹æŒ‚èµ·æ—¶ï¼Œäº‹ä»¶å¾ªç¯å¯ä»¥å»æ‰§è¡Œå…¶ä»–åŒºåç¨‹ï¼ˆä»»åŠ¡</span></span><br><span class="line">    response = <span class="keyword">await</span> others()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&#x27;</span>, response)</span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹ä¸‰&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">others</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;start&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¿”å›å€¼&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;æ‰§è¡Œåç¨‹å‡½æ•°å†…éƒ¨ä»£ç &#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#ä¸€ä¸ªåç¨‹å‡½æ•°ä¸­å¯ä»¥æœ‰å¤šä¸ªawaitå…³é”®å­—</span></span><br><span class="line">    response1 = <span class="keyword">await</span> others()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&#x27;</span>, response1)</span><br><span class="line"></span><br><span class="line">    response2 = <span class="keyword">await</span> others()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;IOè¯·æ±‚ç»“æŸï¼Œç»“æœä¸ºï¼š&#x27;</span>, response2)</span><br><span class="line"></span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure>

<!--awaitå°±æ˜¯ç­‰å¾…å¯¹è±¡çš„å€¼å¾—åˆ°ç»“æœä¹‹åå†ç»§ç»­å‘ä¸‹èµ°ã€‚-->

<h3 id="ï¼ˆ4ï¼‰Taskå¯¹è±¡"><a href="#ï¼ˆ4ï¼‰Taskå¯¹è±¡" class="headerlink" title="ï¼ˆ4ï¼‰Taskå¯¹è±¡"></a>ï¼ˆ4ï¼‰Taskå¯¹è±¡</h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/asyncio-task.html?highlight=task#asyncio.Task">Taskå¯¹è±¡å®˜æ–¹æ–‡æ¡£</a></p>
<p><strong>ä¸»è¦å°±æ˜¯åœ¨äº‹ä»¶å¾ªç¯ä¸­æ·»åŠ å¤šä¸ªä»»åŠ¡ã€‚</strong></p>
<p>Task ç”¨äºå¹¶å‘è°ƒåº¦åç¨‹ï¼Œ<code>é€šè¿‡asyncio.create_task(åç¨‹å¯¹è±¡)</code> çš„æ–¹å¼åˆ›å»º Task å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥è®©åç¨‹åŠ å…¥äº‹ä»¶å¾ªç¯ä¸­ç­‰å¾…è¢«è°ƒåº¦æ‰§è¡Œã€‚é™¤äº†ä½¿ç”¨ <code>asyncio.create_task()</code> å‡½æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä½å±‚çº§çš„ <code>loop.create_task()</code> æˆ–è€… <code>ensure_future()</code> å‡½æ•°ï¼Œä¸å»ºè®®æ‰‹åŠ¨å®ä¾‹åŒ– Task å¯¹è±¡</p>
<!--æ³¨æ„ï¼šasyncio.create_task() å‡½æ•°åœ¨ Python 3.7 ä¸­è¢«åŠ å…¥ï¼Œåœ¨Python 3.7ä¹‹å‰ï¼Œå¯ä»¥æ”¹ç”¨ä½å±‚çº§çš„ asyncio.ensure_future() å‡½æ•°ã€‚-->

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹1&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¿”å›å€¼&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;mainå¼€å§‹&#x27;</span>)</span><br><span class="line">    <span class="comment"># åˆ›å»ºTaskå¯¹è±¡ï¼Œå°†å½“å‰æ‰§è¡Œfuncå‡½æ•°ä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    task1 = asyncio.create_task(func())</span><br><span class="line">    <span class="comment"># åˆ›å»ºTaskå¯¹è±¡ï¼Œå°†å½“å‰æ‰§è¡Œfuncå‡½æ•°ä»»åŠ¡æ·»åŠ åˆ°äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    task2 = asyncio.create_task(func())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;mainç»“æŸ&#x27;</span>)</span><br><span class="line">    <span class="comment"># å½“æ‰§è¡ŒæŸåç¨‹é‡åˆ°IOæ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨ååˆ‡æ¢æ‰§è¡Œå…¶ä»–ä»»åŠ¡</span></span><br><span class="line">    <span class="comment"># æ­¤å¤„çš„ await æ˜¯ç­‰å¾…ç›¸å¯¹åº”çš„åç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•å¹¶è·å–ç»“æœ</span></span><br><span class="line">    ret1 = <span class="keyword">await</span> task1</span><br><span class="line">    ret2 = <span class="keyword">await</span> task2</span><br><span class="line">    <span class="built_in">print</span>(ret1,ret2)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¿”å›å€¼&#x27;</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;mainå¼€å§‹&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    task_list = [</span><br><span class="line">        asyncio.create_task(func(), name=<span class="string">&#x27;n1&#x27;</span>),</span><br><span class="line">        asyncio.create_task(func(), name=<span class="string">&#x27;n2&#x27;</span>)</span><br><span class="line">    ]	<span class="comment">#å¤šä¸ªä»»åŠ¡ï¼Œæ›´å¸¸ä½¿ç”¨åˆ—è¡¨å½¢å¼</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;mainç»“æŸ&#x27;</span>)    </span><br><span class="line">    </span><br><span class="line">    done, pending = <span class="keyword">await</span> asyncio.wait(task_list, timeout=<span class="literal">None</span>)</span><br><span class="line">    <span class="built_in">print</span>(done)</span><br><span class="line">    </span><br><span class="line">asyncio.run(main())			<span class="comment">#loopäº‹ä»¶å¾ªç¯é¦–å…ˆåˆ›å»ºï¼Œç„¶ååˆ—è¡¨æ‰åˆ›å»ºè¿›å»</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹3&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;è¿”å›å€¼&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨è¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸ºåˆ—è¡¨é‡Œçš„ä»£ç ä¼šç«‹å³åŠ åˆ°äº‹ä»¶å¾ªç¯ä¸­å»ï¼Œä½†æ˜¯æ­¤æ—¶äº‹ä»¶å¾ªç¯è¿˜æ²¡æœ‰åˆ›å»º</span></span><br><span class="line"><span class="comment"># task_list = [</span></span><br><span class="line"><span class="comment">#     asyncio.create_task(func(), name=&#x27;n1&#x27;),</span></span><br><span class="line"><span class="comment">#     asyncio.create_task(func(), name=&#x27;n2&#x27;)</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line">task_list = [</span><br><span class="line">    func(),</span><br><span class="line">    func()</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">done, pending = asyncio.run(asyncio.wait(task_list))</span><br><span class="line"><span class="built_in">print</span>(done)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ5ï¼‰asyncio-Futureå¯¹è±¡"><a href="#ï¼ˆ5ï¼‰asyncio-Futureå¯¹è±¡" class="headerlink" title="ï¼ˆ5ï¼‰asyncio.Futureå¯¹è±¡"></a>ï¼ˆ5ï¼‰asyncio.Futureå¯¹è±¡</h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/asyncio-future.html?highlight=future#asyncio.Future">asyncio.Futureå®˜æ–¹æ–‡æ¡£</a></p>
<p><strong>Task å¯¹è±¡ç»§æ‰¿ Futureï¼ŒTask å¯¹è±¡å†…éƒ¨ await ç»“æœçš„å¤„ç†æ˜¯åŸºäº Future å¯¹è±¡æ¥çš„ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹1&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># è·å–å½“å‰äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼ˆFutureå¯¹è±¡ï¼‰ï¼Œè¿™ä¸ªä»»åŠ¡ä»€ä¹ˆéƒ½ä¸å¹²</span></span><br><span class="line">    fut = loop.create_future()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#  ç­‰å¾…ä»»åŠ¡æœ€ç»ˆçš„ç»“æœï¼ˆFutureå¯¹è±¡ï¼‰,æ²¡æœ‰ç»“æœåˆ™ä¼šä¸€ç›´ç­‰ä¸‹å»ã€‚</span></span><br><span class="line">    <span class="keyword">await</span> fut</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">set_after</span>(<span class="params">fut</span>):</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">2</span>)</span><br><span class="line">    fut.set_result(<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment">#çš„è·å–å½“å‰äº‹ä»¶å¾ªç¯</span></span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼ˆTaskå¯¹è±¡ï¼‰ï¼Œç»‘å®šäº†set_afterå‡½æ•°ï¼Œå‡½æ•°å†…éƒ¨åœ¨2sä¹‹åï¼Œä¼šç»™futèµ‹å€¼</span></span><br><span class="line">    <span class="comment"># å³æ‰‹åŠ¨è®¾ç½®futureä»»åŠ¡çš„æœ€ç»ˆç»“æœï¼Œé‚£ä¹ˆfutå°±å¯ä»¥ç»“æŸäº†</span></span><br><span class="line">    <span class="keyword">await</span> loop.create_task(set_after(fut))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾… future å¯¹è±¡è·å–æœ€ç»ˆç»“æœï¼Œå¦åˆ™ä¼šä¸€ç›´ç­‰ä¸‹å»</span></span><br><span class="line">    data = <span class="keyword">await</span> fut</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ6ï¼‰concurrent-futures-Futureå¯¹è±¡"><a href="#ï¼ˆ6ï¼‰concurrent-futures-Futureå¯¹è±¡" class="headerlink" title="ï¼ˆ6ï¼‰concurrent.futures.Futureå¯¹è±¡"></a>ï¼ˆ6ï¼‰concurrent.futures.Futureå¯¹è±¡</h3><p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html?highlight=future#module-concurrent.futures">concurrent.futureså®˜æ–¹æ–‡æ¡£</a></p>
<p><strong>ä½¿ç”¨è¿›ç¨‹æ± æˆ–è€…çº¿ç¨‹æ± å®ç°å¼‚æ­¥æ“ä½œæ—¶ç”¨åˆ°çš„å¯¹è±¡ã€‚</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> Future</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.thread <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.process <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">value</span>):</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(value)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line">pool = ThreadPoolExecutor(max_workers= <span class="number">5</span>)</span><br><span class="line"><span class="comment">#åˆ›å»ºè¿›ç¨‹æ± </span></span><br><span class="line"><span class="comment">#  pool = ProcessPoolExecutor(max_workers = 5)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    fut = pool.submit(func, i)</span><br><span class="line">    <span class="built_in">print</span>(fut)</span><br></pre></td></tr></table></figure>

<p>ä»¥åå†™ä»£ç æˆ–è®¸è¿˜æœ‰äº¤å‰ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼šcrmé¡¹ç›®80%éƒ½æ˜¯å±äºåŸºäºåç¨‹å¼‚æ­¥ç¼–ç¨‹ + MySQLï¼ˆä¸æ”¯æŒï¼‰ã€çº¿ç¨‹æˆ–è€…è¿›ç¨‹åšå¼‚æ­¥ç¼–ç¨‹ã€‘</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>():</span><br><span class="line">    <span class="comment"># æŸä¸ªè€—æ—¶æ“ä½œ</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;SB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1.Run is the default loop&#x27;s executor(é»˜è®¤ThreadPoolExecutor)</span></span><br><span class="line">    <span class="comment"># step1 ï¼šå†…éƒ¨è°ƒç”¨ThreadPoolExecutor çš„ submit æ–¹æ³•å»çº¿ç¨‹æ± ä¸­ç”³è¯·ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œ func1 å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª concurrent.futures.Future å¯¹è±¡</span></span><br><span class="line">    <span class="comment"># step2 ï¼šè°ƒç”¨asyncio.wrap_future å°† concurrent.futures.Future å¯¹è±¡åŒ…è£…ä¸º asyncio.Future å¯¹è±¡</span></span><br><span class="line">    <span class="comment"># å› ä¸º concurrent.futures.Future å¯¹è±¡ä¸æ”¯æŒ await è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦åŒ…è£…ä¸º asyncio.Future å¯¹è±¡ï¼Œæ‰å¯ä»¥ä½¿ç”¨</span></span><br><span class="line">    fut = loop.run_in_executor(<span class="literal">None</span>, func1)</span><br><span class="line">    result = <span class="keyword">await</span> fut</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;default thread pool&#x27;</span>, result)</span><br><span class="line">    <span class="comment"># 2.Run in a custom thread pool:</span></span><br><span class="line">    <span class="comment"># with concurrent.futures.ThreadPoolExecutor() as pool:</span></span><br><span class="line">    <span class="comment"># result = await loop.run_in_executor(pool,func1)</span></span><br><span class="line">    <span class="comment"># print(&#x27;custom thread pool&#x27;,result)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.Run in a custom process pool:</span></span><br><span class="line">    <span class="comment"># with concurrent.futures.ThreadPoolExecutor() as pool:</span></span><br><span class="line">    <span class="comment"># result = await loop.run_in_executor(pool,func1)</span></span><br><span class="line">    <span class="comment"># print(&#x27;custom process pool&#x27;,result)</span></span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ7ï¼‰æ¡ˆä¾‹ï¼šasyncio-ä¸æ”¯æŒå¼‚æ­¥çš„æ¨¡å—"><a href="#ï¼ˆ7ï¼‰æ¡ˆä¾‹ï¼šasyncio-ä¸æ”¯æŒå¼‚æ­¥çš„æ¨¡å—" class="headerlink" title="ï¼ˆ7ï¼‰æ¡ˆä¾‹ï¼šasyncio + ä¸æ”¯æŒå¼‚æ­¥çš„æ¨¡å—"></a>ï¼ˆ7ï¼‰æ¡ˆä¾‹ï¼šasyncio + ä¸æ”¯æŒå¼‚æ­¥çš„æ¨¡å—</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è·Ÿå‰ä¸€èŠ‚ä»£ç ä¸€æ ·çš„æ•ˆæœï¼Œä½†æ˜¯æ›´è€—è´¹èµ„æº</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_image</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="comment"># å‘é€ç½‘ç»œè¯·æ±‚ï¼Œä¸‹è½½å›¾ç‰‡ï¼ˆé‡åˆ°ç½‘ç»œä¸‹è½½å›¾ç‰‡çš„IOè¯·æ±‚ï¼Œè‡ªåŠ¨åŒ–åˆ‡æ¢åˆ°å…¶ä»–ä»»åŠ¡ï¼‰</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹ä¸‹è½½&#x27;</span>, url)</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    <span class="comment"># requestsæ¨¡å—é»˜è®¤ä¸æ”¯æŒå¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥å°±ä½¿ç”¨çº¿ç¨‹æ± æ¥é…åˆå®ç°äº†</span></span><br><span class="line">    future = loop.run_in_executor(<span class="literal">None</span>, requests.get, url)</span><br><span class="line"></span><br><span class="line">    response = <span class="keyword">await</span> future</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ä¸‹è½½å®Œæˆ&#x27;</span>)</span><br><span class="line">    <span class="comment"># å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">    file_name = url.rsplit(<span class="string">&#x27;-&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_name, mode=<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file_object:</span><br><span class="line">        file_object.write(response.content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url_list = [</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/210302/000706-1614614826df15.jpg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/200910/200207-1599739327e5a8.jpg&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;https://pic.netbian.com/uploads/allimg/190902/152344-1567409024af8c.jpg&#x27;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    tasks = [download_image(url) <span class="keyword">for</span> url <span class="keyword">in</span> url_list]</span><br><span class="line"></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    loop.run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ8ï¼‰å¼‚æ­¥è¿­ä»£å™¨"><a href="#ï¼ˆ8ï¼‰å¼‚æ­¥è¿­ä»£å™¨" class="headerlink" title="ï¼ˆ8ï¼‰å¼‚æ­¥è¿­ä»£å™¨"></a>ï¼ˆ8ï¼‰å¼‚æ­¥è¿­ä»£å™¨</h3><p><strong>ä»€ä¹ˆæ˜¯å¼‚æ­¥è¿­ä»£å™¨ï¼Ÿ</strong></p>
<p>å®ç°äº† <code>__aiter__()</code> å’Œ <code>__anext__()</code> æ–¹æ³•çš„å¯¹è±¡ã€‚<code>__anext__() </code>å¿…é¡»è¿”å›ä¸€ä¸ª <code>awaitable</code> å¯¹è±¡ã€‚<code>async for</code> ä¼šå¤„ç†å¼‚æ­¥è¿­ä»£å™¨çš„ <code>__anext__() </code> æ–¹æ³•æ‰€è¿”å›çš„å¯ç­‰å¾…å¯¹è±¡ï¼Œç›´åˆ°å…¶å¼•å‘ä¸€ä¸ª <code>StopAsyncIteration</code> å¼‚å¸¸ã€‚ç”± <code>PEP 492</code> å¼•å…¥ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ï¼Ÿ</strong><br>å¯åœ¨ <code>async for</code> è¯­å¥ä¸­è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚å¿…é¡»é€šè¿‡å®ƒçš„ <code>__aiter__()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>asynchronous iterator</code>ã€‚ç”± <code>PEP 492</code> å¼•å…¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Reader</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;è‡ªå®šä¹‰å¼‚æ­¥è¿­ä»£å™¨ ï¼ˆåŒæ—¶ä¹Ÿæ˜¯ä¸€éƒ¨å¯è¿­ä»£å¯¹è±¡ï¼‰&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">readline</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># await asyncio.sleep(1)</span></span><br><span class="line">        self.count  += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.count == <span class="number">100</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> self.count</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__aiter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__anext__</span>(<span class="params">self</span>):</span><br><span class="line">        val = <span class="keyword">await</span> self.readline()</span><br><span class="line">        <span class="keyword">if</span> val == <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopAsyncIteration</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    obj = Reader()</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> item <span class="keyword">in</span> obj:</span><br><span class="line">        <span class="built_in">print</span>(item)</span><br><span class="line"></span><br><span class="line">asyncio.run( func() )</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ9ï¼‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"><a href="#ï¼ˆ9ï¼‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨" class="headerlink" title="ï¼ˆ9ï¼‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨"></a>ï¼ˆ9ï¼‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</h3><p>æ­¤ç§å¯¹è±¡é€šè¿‡å®šä¹‰ <code>__aenter__()</code> å’Œ <code>__aexit__()</code> æ–¹æ³•æ¥å¯¹ <code>async with</code> è¯­å¥ä¸­çš„ç¯å¢ƒè¿›è¡Œæ§åˆ¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AsyncContextManager</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, conn=<span class="literal">None</span></span>):</span><br><span class="line">        self.conn = conn</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">do_something</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># å¼‚æ­¥æ“ä½œæ•°æ®åº“</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">666</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aenter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># å¼‚æ­¥é“¾æ¥æ•°æ®åº“</span></span><br><span class="line">        self.conn = <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">__aexit__</span>(<span class="params">self, exc_type, exc, tb</span>):</span><br><span class="line">        <span class="comment"># å¼‚æ­¥å…³é—­æ•°æ®åº“é“¾æ¥</span></span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">func</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> AsyncContextManager() <span class="keyword">as</span> f:</span><br><span class="line">        result = <span class="keyword">await</span> f.do_something()</span><br><span class="line">        <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">asyncio.run(func())</span><br></pre></td></tr></table></figure>

<h2 id="4-uvloop"><a href="#4-uvloop" class="headerlink" title="4. uvloop"></a>4. uvloop</h2><p><strong>uvloop æ˜¯ asyncio çš„äº‹ä»¶å¾ªç¯çš„æ›¿ä»£æ–¹æ¡ˆã€‚äº‹ä»¶å¾ªç¯ &gt; é»˜è®¤ asyncio çš„äº‹ä»¶å¾ªç¯ã€‚</strong></p>
<p><code>pip install uvloop</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> uvloop</span><br><span class="line">asyncio.set_event_loop_policy(uvloop.EventLoopPolicy())</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–å†™ asyncio çš„ä»£ç ï¼Œä¸ä¹‹å‰å†™çš„ä»£ç ä¸€è‡´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†…éƒ¨çš„äº‹ä»¶å¾ªç¯è‡ªåŠ¨åŒ–ä¼šå˜ä¸º uvloop</span></span><br><span class="line">asyncio.run(...)</span><br></pre></td></tr></table></figure>

<!--æ³¨æ„ï¼šä¸€ä¸ª asgi ->uvicorn å†…éƒ¨é»˜è®¤ä½¿ç”¨çš„å°±æ˜¯uvloop -->

<h3 id="5-å®æˆ˜æ¡ˆä¾‹"><a href="#5-å®æˆ˜æ¡ˆä¾‹" class="headerlink" title="5. å®æˆ˜æ¡ˆä¾‹"></a>5. å®æˆ˜æ¡ˆä¾‹</h3><h3 id="ï¼ˆ1ï¼‰å¼‚æ­¥-redis"><a href="#ï¼ˆ1ï¼‰å¼‚æ­¥-redis" class="headerlink" title="ï¼ˆ1ï¼‰å¼‚æ­¥ redis"></a>ï¼ˆ1ï¼‰å¼‚æ­¥ redis</h3><p>åœ¨ä½¿ç”¨ python ä»£ç æ“ä½œ redis æ—¶ï¼Œé“¾æ¥&#x2F;æ“ä½œ&#x2F;æ–­å¼€éƒ½æ˜¯ç½‘ç»œIOã€‚</p>
<p><code>pip install aioredis</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä½œè€…æœªè®¾ç½® redisï¼Œæ•…æ­¤ä»£ç æœªæµ‹è¯•</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aioredis</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">address, password</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ‰§è¡Œ&#x27;</span>, address)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šåˆ›å»º redis é“¾æ¥</span></span><br><span class="line">    redis = <span class="keyword">await</span> aioredis.create_redis(address, password = password)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šåœ¨ redis ä¸­è®¾ç½®å“ˆå¸Œå€¼ carï¼Œå†…éƒ¨å†è®¾ä¸‰ä¸ªé”®å€¼å¯¹ï¼Œå³ï¼šredis = &#123;car:&#123;key1:1,key2:2,key3:33&#125;&#125;</span></span><br><span class="line">    <span class="keyword">await</span> redis.hmset_dict(<span class="string">&#x27;car&#x27;</span>, key1 = <span class="number">1</span>, key2 = <span class="number">2</span>, key3 = <span class="number">3</span>)</span><br><span class="line">	<span class="comment"># ç½‘ç»œIOæ“ä½œï¼šå» redis ä¸­è·å–å€¼</span></span><br><span class="line">    result = <span class="keyword">await</span> redis.hgetall(<span class="string">&#x27;car&#x27;</span>, encoding = <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">    redis.close()</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šå…³é—­ redis é“¾æ¥</span></span><br><span class="line">    <span class="keyword">await</span> redis.wait_closed()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸ&#x27;</span>, address)</span><br><span class="line"></span><br><span class="line">asyncio.run(execute(<span class="string">&#x27;redis://47.93.4.198:6379&#x27;</span>, <span class="string">&quot;root!2345&quot;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aioredis</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">address, password</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹æ‰§è¡Œ&#x27;</span>, address)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šå…ˆå»è¿æ¥ 47.93.4.197:6379 é‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡ï¼Œå»è¿æ¥ 47.93.4.198:6379</span></span><br><span class="line">    redis = <span class="keyword">await</span> aioredis.create_pool(address, password = password)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">await</span> redis.hmset_dict(<span class="string">&#x27;car&#x27;</span>, key1 = <span class="number">1</span>, key2 = <span class="number">2</span>, key3 = <span class="number">3</span>)</span><br><span class="line">	<span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡</span></span><br><span class="line">    result = <span class="keyword">await</span> redis.hgetall(<span class="string">&#x27;car&#x27;</span>, encoding = <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line">    redis.close()</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">await</span> redis.wait_closed()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸ&#x27;</span>, address)</span><br><span class="line">    </span><br><span class="line">task_list =[</span><br><span class="line">    execute(<span class="string">&#x27;redis://47.93.4.197:6379&#x27;</span>,<span class="string">&#x27;root!2345&#x27;</span>),</span><br><span class="line">    execute(<span class="string">&#x27;redis://47.93.4.198:6379&#x27;</span>,<span class="string">&#x27;root!2345&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">asyncio.run(asyncio.wait(task_list))</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ2ï¼‰å¼‚æ­¥MySQL"><a href="#ï¼ˆ2ï¼‰å¼‚æ­¥MySQL" class="headerlink" title="ï¼ˆ2ï¼‰å¼‚æ­¥MySQL"></a>ï¼ˆ2ï¼‰å¼‚æ­¥MySQL</h3><p><code>pip3 install aiomysql</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹1&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiomysql</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute</span>():</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šè¿æ¥ MySQL</span></span><br><span class="line">    conn = <span class="keyword">await</span> aiomysql.connect(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port= <span class="number">3306</span>, user = <span class="string">&#x27;root&#x27;</span>, password = <span class="string">&#x27;123&#x27;</span>,db= <span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šåˆ›å»º CURSOR</span></span><br><span class="line">    cur = <span class="keyword">await</span> conn.cursor()</span><br><span class="line">	<span class="comment"># ç½‘ç»œIOæ“ä½œï¼šæ‰§è¡Œ SQL</span></span><br><span class="line">    <span class="keyword">await</span> cur.execute(<span class="string">&#x27;SELECT Host,User FROM user&#x27;</span>)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šè·å–SQLç»“æœ</span></span><br><span class="line">    result = <span class="keyword">await</span> cur.fetchall()</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šå…³é—­ é“¾æ¥</span></span><br><span class="line">    <span class="keyword">await</span> cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line">asyncio.run(execute())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiomysql</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">host, password</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å¼€å§‹&#x27;</span>, host)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šå…ˆè¿197ï¼Œé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢ï¼Œå»è¿198</span></span><br><span class="line">    conn = <span class="keyword">await</span> aiomysql.connect(host = host, port= <span class="number">3306</span>, user = <span class="string">&#x27;root&#x27;</span>, password = password,db= <span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢</span></span><br><span class="line">    cur = <span class="keyword">await</span> conn.cursor()</span><br><span class="line">	<span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢</span></span><br><span class="line">    <span class="keyword">await</span> cur.execute(<span class="string">&#x27;SELECT Host,User FROM user&#x27;</span>)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢</span></span><br><span class="line">    result = <span class="keyword">await</span> cur.fetchall()</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment"># ç½‘ç»œIOæ“ä½œï¼šé‡åˆ°IOè‡ªåŠ¨åˆ‡æ¢</span></span><br><span class="line">    <span class="keyword">await</span> cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ç»“æŸ&#x27;</span>, host)</span><br><span class="line">task_list =[</span><br><span class="line">    execute(<span class="string">&#x27;47.93.4.197:6379&#x27;</span>,<span class="string">&#x27;root!2345&#x27;</span>),</span><br><span class="line">    execute(<span class="string">&#x27;47.93.4.198:6379&#x27;</span>,<span class="string">&#x27;root!2345&#x27;</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">asyncio.run(asyncio.wait(task_list))</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ3ï¼‰FastAPIæ¡†æ¶"><a href="#ï¼ˆ3ï¼‰FastAPIæ¡†æ¶" class="headerlink" title="ï¼ˆ3ï¼‰FastAPIæ¡†æ¶"></a>ï¼ˆ3ï¼‰FastAPIæ¡†æ¶</h3><p><code>pip3 install fastapi</code>   	<code>pip3 install uvicorn</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;æ™®é€šæ“ä½œæ¥å£&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span>&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    uvicorn.run(<span class="string">&quot;luffy:app&quot;</span>,host= <span class="string">&#x27;127.0.0.1&#x27;</span>,port= <span class="number">5000</span>, log_level= <span class="string">&#x27;info&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ç¤ºä¾‹2&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> aioredis <span class="keyword">import</span> Redis</span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"><span class="keyword">import</span> aioredis</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªredisçš„è¿æ¥æ±  å®é™…è¿è¡Œæ—¶æ›´æ¢è‡ªå·±çš„redis</span></span><br><span class="line">REDIS_POOL = aioredis.ConnectionPool(<span class="string">&#x27;redis://47.193.14.198:6379&#x27;</span>, password= <span class="string">&#x27;root123&#x27;</span>, minsize = <span class="number">1</span> , maxsize = <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;æ™®é€šæ“ä½œæ¥å£&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span>&#123;<span class="string">&quot;message&quot;</span>:<span class="string">&quot;Hello World&quot;</span>&#125;</span><br><span class="line"><span class="meta">@app.get(<span class="params"><span class="string">&#x27;/red&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">red</span>():</span><br><span class="line">    <span class="comment"># å¼‚æ­¥æ“ä½œæ¥å£</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;è¯·æ±‚æ¥äº†&#x27;</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿æ¥æ± è·å–ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    conn = <span class="keyword">await</span> REDIS_POOL.acquire()</span><br><span class="line">    redis = Redis(conn)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è®¾ç½®å€¼</span></span><br><span class="line">    <span class="keyword">await</span> redis.hmset_dict(<span class="string">&#x27;car&#x27;</span>,key1 = <span class="number">1</span>,key2 = <span class="number">2</span>,key3 =<span class="number">3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¯»å–å€¼</span></span><br><span class="line">    result = <span class="keyword">await</span> redis.hgetall(<span class="string">&#x27;car&#x27;</span>, encoding =<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#è¿æ¥å½’è¿˜è¿æ¥æ± </span></span><br><span class="line">    REDIS_POOL.release(conn)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    uvicorn.run(<span class="string">&quot;è„šæœ¬å:app&quot;</span>,host= <span class="string">&#x27;127.0.0.1&#x27;</span>,port= <span class="number">5000</span>, log_level= <span class="string">&#x27;info&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ï¼ˆ4ï¼‰å¼‚æ­¥çˆ¬è™«"><a href="#ï¼ˆ4ï¼‰å¼‚æ­¥çˆ¬è™«" class="headerlink" title="ï¼ˆ4ï¼‰å¼‚æ­¥çˆ¬è™«"></a>ï¼ˆ4ï¼‰å¼‚æ­¥çˆ¬è™«</h3><p><code>pip3 install aiohttp</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;ä½¿ç”¨aiohttpæ¨¡å—ä¸‹è½½    åç¨‹æ–¹å¼&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">fetch</span>(<span class="params">session, url</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;å‘é€è¯·æ±‚ï¼š&#x27;</span>, url)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, verify_ssl = <span class="literal">False</span>) <span class="keyword">as</span> response:</span><br><span class="line">        text = <span class="keyword">await</span> response.text()</span><br><span class="line">        file_name = url.rsplit(<span class="string">&#x27;-&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;å¾—åˆ°ç»“æœï¼š&#x27;</span>, url , <span class="built_in">len</span>(text))</span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        url_list = [</span><br><span class="line">            <span class="string">&#x27;https://python.org&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://www.baidu.com&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;https://www.pythonav.com&#x27;</span></span><br><span class="line">        ]</span><br><span class="line">        tasks = [asyncio.create_task(fetch(session, url)) <span class="keyword">for</span> url <span class="keyword">in</span> url_list]</span><br><span class="line">        done, pending = <span class="keyword">await</span> asyncio.wait(tasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    asyncio.run(main())    </span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://Ysnsn.github.io">å¯çˆ±çš„Wyang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://ysnsn.github.io/python-spider.html">https://ysnsn.github.io/python-spider.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://Ysnsn.github.io" target="_blank">é˜³å…‰å°é¥ºå­çš„ç©ºé—´</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">æ•™ç¨‹</a><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post-share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>èµåŠ©</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/cet6.html" title="CET6"><img class="cover" src="https://cdn.jsdelivr.net/gh//Ysnsn/img@latest/2021/ç¾å¥³%20-%2028.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">CET6</div></div><div class="info-2"><div class="info-item-1"> è¿˜æ²¡å¼€å§‹Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·  </div></div></div></a><a class="pagination-related" href="/yarn-add.html" title="yarnçš„å®‰è£…ä½¿ç”¨"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/02/02/ff728455b2c576bacb6457bd6f9ea9af.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">yarnçš„å®‰è£…ä½¿ç”¨</div></div><div class="info-2"><div class="info-item-1">       var video = document.getElementById('video');   var videoSrc = 'https://cdn.jsdelivr.net/gh/Ysnsn/video/2021/7/00.m3u8';   if (Hls.isSupported()) {     var hls = new Hls();     hls.loadSource(videoSrc);     hls.attachMedia(video);     hls.on(Hls.Events.MANIFEST_PARSED, function() {       video.play();     });   }   èƒŒæ™¯åœ¨ Node ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œä¾èµ–é€šå¸¸å®‰è£…åœ¨é¡¹ç›®çš„ node_modules æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶è€Œï¼Œè¿™ä¸ªæ–‡ä»¶çš„ç»“æ„å’Œå®é™…ä¾èµ–æ ‘å¯èƒ½æœ‰æ‰€åŒºåˆ«ï¼Œå› ä¸ºé‡å¤çš„ä¾èµ–å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·ã€‚npm å®¢æˆ·ç«¯æŠŠä¾èµ–å®‰è£…åˆ° node_modules ç›®å½•çš„è¿‡ç¨‹å…·æœ‰ä¸ç¡®å®šæ€§ã€‚è¿™æ„å‘³ç€å½“ä¾èµ–çš„å®‰è£…é¡ºåºä¸åŒæ—¶ï¼Œnode_modules ç›®å½•çš„ç»“æ„å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ç§å·®å¼‚å¯èƒ½ä¼šå¯¼è‡´ç±»...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/python-study1.html" title="pythonåŸºç¡€å­¦ä¹ ç¬”è®°(ä¸€)"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ysnsn/picture@master/111/20200822112556.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-08-22</div><div class="info-item-2">pythonåŸºç¡€å­¦ä¹ ç¬”è®°(ä¸€)</div></div><div class="info-2"><div class="info-item-1">ç»™pipè®¾ç½®æ¸…åé•œåƒæºæˆ–è®¾ç½®è‡ªå·±çš„ä»£ç† ç‚¹å‡»å±•å¼€ğŸ‘‰ å‘½ä»¤   Windowsè®¾ç½®æ–¹æ³•:  è·¯å¾„ Windows: %APPDATA%\pip\pip.iniï¼Œ%APPDATA%çš„å®é™…è·¯å¾„æˆ‘ç”µè„‘ä¸Šæ˜¯C:\Users\user_xxx\AppData\Roamingï¼Œå¯åœ¨cmdé‡Œæ‰§è¡Œecho %APPDATA%å‘½ä»¤æŸ¥çœ‹(æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å°±æ–°å»º) pip.ini *   é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š    123456[global]index-url = http://mirrors.aliyun.com/pypi/simple/ # è¿™é‡Œä½¿ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„é•œåƒæºä¹Ÿå¯ä»¥ä½¿ç”¨æ¸…åé•œåƒæº  https://pypi.tuna.tsinghua.edu.cn/simpleproxy=http://xxx.xxx.xxx.xxx:7890 # æ›¿æ¢å‡ºè‡ªå·±çš„ä»£ç†åœ°å€ï¼Œæ ¼å¼ä¸º[user:passwd@]proxy.server:port[install]trusted-host=mirrors.aliyun.com # ä¿¡ä»»é˜¿é‡Œäº‘çš„é•œåƒæºï¼Œå¦åˆ™ä¼šæœ‰è­¦å‘Š   æ•ˆæœå›¾å¦‚ä¸‹ï¼š      ğŸ¥¢å­¦ä¹ é€”å¾„  moocåµ©å¤©...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">å¯çˆ±çš„Wyang</div><div class="author-info-description">äººç”Ÿå³æ˜¯æ—…é€”ï¼Œæˆ‘ä»¬éƒ½åœ¨è·¯ä¸Š</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">40</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Ysnsn"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/Ysnsn" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:wyang0558@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSSè®¢é˜…"><i class="fas fa-rss"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2746130558&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=1370825920" target="_blank" title="ç½‘æŠ‘äº‘"><i class="fab fa-gg"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content"><marquee> Welcome to <a style="color:red" href="https://Ysnsn.github.io" target="_blank" rel="noopener">Ysnsnåšå®¢</a>ğŸ‘‰æœ¬ç«™å·²å¼€å¯Pjaxï¼Œå–œæ¬¢è¯·æ”¶è—æœ¬ç«™å‘¦ ^_^!</marquee>  <div class="social-button"> <a class="button--animated" style="text-align:center;position:relative; z-index:1;display:block;background-color:#49b1f5;color:#fff;line-height:2em;margin:auto;padding:.2em" href="https://jq.qq.com/" rel="external nofollow noreferrer" target="_blank">åŠ å…¥ QQ ç¾¤èŠ ğŸ‘</a> </div> <br></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">ä¸€ã€çˆ¬è™«åŸºç¡€ç®€ä»‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%88%AC%E8%99%AB%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1. çˆ¬è™«ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%88%AC%E8%99%AB%E5%90%88%E6%B3%95%E6%80%A7%E6%8E%A2%E7%A9%B6"><span class="toc-number">1.2.</span> <span class="toc-text">2. çˆ¬è™«åˆæ³•æ€§æ¢ç©¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%88%AC%E8%99%AB%E5%88%9D%E8%AF%95%E6%B7%B1%E5%85%A5"><span class="toc-number">1.3.</span> <span class="toc-text">3. çˆ¬è™«åˆè¯•æ·±å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-http-amp-https%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.</span> <span class="toc-text">4. http&amp;httpsåè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89http%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">ï¼ˆ1ï¼‰httpåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89https%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.2.</span> <span class="toc-text">ï¼ˆ2ï¼‰httpsåè®®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">ï¼ˆ3ï¼‰åŠ å¯†æ–¹å¼</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81requests%E6%A8%A1%E5%9D%97%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">äºŒã€requestsæ¨¡å—åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-requests%E7%AC%AC%E4%B8%80%E8%A1%80"><span class="toc-number">2.1.</span> <span class="toc-text">1. requestsç¬¬ä¸€è¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-requests%E5%B7%A9%E5%9B%BA%E6%B7%B1%E5%85%A5%E6%A1%88%E4%BE%8B%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.2.</span> <span class="toc-text">2. requestså·©å›ºæ·±å…¥æ¡ˆä¾‹ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E7%AE%80%E6%98%93%E7%BD%91%E9%A1%B5%E9%87%87%E9%9B%86%E5%99%A8"><span class="toc-number">2.2.1.</span> <span class="toc-text">ï¼ˆ1ï¼‰ç®€æ˜“ç½‘é¡µé‡‡é›†å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E7%A0%B4%E8%A7%A3%E7%99%BE%E5%BA%A6%E7%BF%BB%E8%AF%91"><span class="toc-number">2.2.2.</span> <span class="toc-text">ï¼ˆ2ï¼‰ç ´è§£ç™¾åº¦ç¿»è¯‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%B1%86%E7%93%A3%E7%94%B5%E5%BD%B1"><span class="toc-number">2.2.3.</span> <span class="toc-text">ï¼ˆ3ï¼‰è±†ç“£ç”µå½±</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BD%9C%E4%B8%9A%E2%80%94%E8%82%AF%E5%BE%B7%E5%9F%BA%E9%A4%90%E5%8E%85%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.3.</span> <span class="toc-text">3. ä½œä¸šâ€”è‚¯å¾·åŸºé¤å…æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BB%BC%E5%90%88%E7%BB%83%E4%B9%A0%E2%80%94%E8%8D%AF%E7%9B%91%E6%80%BB%E5%B1%80"><span class="toc-number">2.4.</span> <span class="toc-text">4. ç»¼åˆç»ƒä¹ â€”è¯ç›‘æ€»å±€</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">ä¸‰ã€æ•°æ®è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">1. æ•°æ®è§£ææ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96%E2%80%94%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">2. å›¾ç‰‡æ•°æ®çˆ¬å–â€”æ­£åˆ™è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%AD%A3%E5%88%99%E8%A7%A3%E6%9E%90%E6%A1%88%E4%BE%8B"><span class="toc-number">3.3.</span> <span class="toc-text">3. æ­£åˆ™è§£ææ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-bs4%E8%A7%A3%E6%9E%90%E6%A6%82%E8%BF%B0"><span class="toc-number">3.4.</span> <span class="toc-text">4. bs4è§£ææ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-bs4-%E8%A7%A3%E6%9E%90%E5%85%B7%E4%BD%93%E8%AE%B2%E8%A7%A3"><span class="toc-number">3.5.</span> <span class="toc-text">5. bs4 è§£æå…·ä½“è®²è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-bs4-%E8%A7%A3%E6%9E%90%E6%A1%88%E4%BE%8B%E5%AE%9E%E6%88%98"><span class="toc-number">3.6.</span> <span class="toc-text">6. bs4 è§£ææ¡ˆä¾‹å®æˆ˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-xpath%E8%A7%A3%E6%9E%90%E5%9F%BA%E7%A1%80"><span class="toc-number">3.7.</span> <span class="toc-text">7. xpathè§£æåŸºç¡€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-xpath%E5%AE%9E%E6%88%98-58%E4%BA%8C%E6%89%8B%E6%88%BF"><span class="toc-number">3.8.</span> <span class="toc-text">8. xpathå®æˆ˜-58äºŒæ‰‹æˆ¿</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-xpath%E8%A7%A3%E6%9E%90%E6%A1%88%E4%BE%8B"><span class="toc-number">3.9.</span> <span class="toc-text">9. xpathè§£ææ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%894k%E5%9B%BE%E7%89%87%E8%A7%A3%E6%9E%90%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.9.1.</span> <span class="toc-text">ï¼ˆ1ï¼‰4kå›¾ç‰‡è§£æä¸‹è½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%85%A8%E5%9B%BD%E5%9F%8E%E5%B8%82%E5%90%8D%E7%A7%B0%E7%88%AC%E5%8F%96"><span class="toc-number">3.9.2.</span> <span class="toc-text">ï¼ˆ2ï¼‰å…¨å›½åŸå¸‚åç§°çˆ¬å–</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-xpath%E4%BD%9C%E4%B8%9A%E2%80%94%E7%88%AC%E5%8F%96%E7%AB%99%E9%95%BF%E7%B4%A0%E6%9D%90%E4%B8%AD%E5%85%8D%E8%B4%B9%E7%AE%80%E5%8E%86%E6%A8%A1%E6%9D%BF"><span class="toc-number">3.10.</span> <span class="toc-text">10. xpathä½œä¸šâ€”çˆ¬å–ç«™é•¿ç´ æä¸­å…è´¹ç®€å†æ¨¡æ¿</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">å››ã€éªŒè¯ç </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1. éªŒè¯ç è¯†åˆ«ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%91%E6%89%93%E7%A0%81%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">4.2.</span> <span class="toc-text">2. äº‘æ‰“ç ä½¿ç”¨æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%A4%E8%AF%97%E6%96%87%E7%BD%91%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB"><span class="toc-number">4.3.</span> <span class="toc-text">3. å¤è¯—æ–‡ç½‘éªŒè¯ç è¯†åˆ«</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81requests%E6%A8%A1%E5%9D%97%E9%AB%98%E7%BA%A7"><span class="toc-number">5.</span> <span class="toc-text">äº”ã€requestsæ¨¡å—é«˜çº§</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0%E6%B5%81%E7%A8%8B%E6%A2%B3%E7%90%86"><span class="toc-number">5.1.</span> <span class="toc-text">1. æ¨¡æ‹Ÿç™»å½•å®ç°æµç¨‹æ¢³ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BA%BA%E4%BA%BA%E7%BD%91%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95"><span class="toc-number">5.2.</span> <span class="toc-text">2. äººäººç½‘æ¨¡æ‹Ÿç™»å½•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95cookie%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">3. æ¨¡æ‹Ÿç™»å½•cookieæ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BB%A3%E7%90%86%E7%90%86%E8%AE%BA%E8%AE%B2%E8%A7%A3"><span class="toc-number">5.4.</span> <span class="toc-text">4. ä»£ç†ç†è®ºè®²è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BB%A3%E7%90%86%E5%9C%A8%E7%88%AC%E8%99%AB%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">5.5.</span> <span class="toc-text">5. ä»£ç†åœ¨çˆ¬è™«ä¸­çš„åº”ç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E9%AB%98%E6%80%A7%E8%83%BD%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB"><span class="toc-number">6.</span> <span class="toc-text">å…­ã€é«˜æ€§èƒ½å¼‚æ­¥çˆ¬è™«</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">1. å¼‚æ­¥çˆ¬è™«æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%9A%E7%BA%BF%E7%A8%8Band%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="toc-number">6.2.</span> <span class="toc-text">2. å¤šçº¿ç¨‹andå¤šçº¿ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E6%B1%A0and%E8%BF%9B%E7%A8%8B%E6%B1%A0"><span class="toc-number">6.3.</span> <span class="toc-text">3. çº¿ç¨‹æ± andè¿›ç¨‹æ± </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">6.4.</span> <span class="toc-text">4. çº¿ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E6%A1%88%E4%BE%8B%E5%BA%94%E7%94%A8"><span class="toc-number">6.5.</span> <span class="toc-text">5. çº¿ç¨‹æ± æ¡ˆä¾‹åº”ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%9B%9E%E9%A1%BE"><span class="toc-number">6.6.</span> <span class="toc-text">6. åç¨‹ç›¸å…³æ¦‚å¿µå›é¡¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E5%9B%9E%E9%A1%BE"><span class="toc-number">6.7.</span> <span class="toc-text">7. åç¨‹ç›¸å…³æ“ä½œå›é¡¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%BC%82%E6%AD%A5%E5%8D%8F%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.8.</span> <span class="toc-text">8. å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-aiohttp-%E6%A8%A1%E5%9D%97%E5%BC%95%E5%87%BA"><span class="toc-number">6.9.</span> <span class="toc-text">9. aiohttp æ¨¡å—å¼•å‡º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-aiohttp-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E5%BC%82%E6%AD%A5%E5%8D%8F%E7%A8%8B%E5%AE%9E%E7%8E%B0%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB"><span class="toc-number">6.10.</span> <span class="toc-text">10. aiohttp + å¤šä»»åŠ¡å¼‚æ­¥åç¨‹å®ç°å¼‚æ­¥çˆ¬è™«</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">ä¸ƒã€åŠ¨æ€åŠ è½½æ•°æ®å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-selenium%E7%AE%80%E4%BB%8B"><span class="toc-number">7.1.</span> <span class="toc-text">1. seleniumç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-selenium%E5%88%9D%E8%AF%95"><span class="toc-number">7.2.</span> <span class="toc-text">2. seleniumåˆè¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-selenium%E5%85%B6%E4%BB%96%E8%87%AA%E5%8A%A8%E5%8C%96%E6%93%8D%E4%BD%9C"><span class="toc-number">7.3.</span> <span class="toc-text">3. seleniumå…¶ä»–è‡ªåŠ¨åŒ–æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-iframe-%E5%A4%84%E7%90%86-%E5%8A%A8%E4%BD%9C%E9%93%BE"><span class="toc-number">7.4.</span> <span class="toc-text">4. iframe å¤„ç†+åŠ¨ä½œé“¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-selenium%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95QQ%E7%A9%BA%E9%97%B4"><span class="toc-number">7.5.</span> <span class="toc-text">5. seleniumæ¨¡æ‹Ÿç™»å½•QQç©ºé—´</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%97%A0%E5%A4%B4%E6%B5%8F%E8%A7%88%E5%99%A8-%E8%A7%84%E9%81%BF%E6%93%8D%E4%BD%9C"><span class="toc-number">7.6.</span> <span class="toc-text">6. æ— å¤´æµè§ˆå™¨+è§„é¿æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E8%B6%85%E7%BA%A7%E9%B9%B0%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">7.7.</span> <span class="toc-text">7. è¶…çº§é¹°çš„åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-12306%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95"><span class="toc-number">7.8.</span> <span class="toc-text">8. 12306æ¨¡æ‹Ÿç™»å½•</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81scrapy%E6%A1%86%E6%9E%B6"><span class="toc-number">8.</span> <span class="toc-text">å…«ã€scrapyæ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-scrapy%E6%A1%86%E6%9E%B6%E5%88%9D%E8%AF%86"><span class="toc-number">8.1.</span> <span class="toc-text">1. scrapyæ¡†æ¶åˆè¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-scrapy%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">2. scrapyåŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-scrapy%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90%E6%93%8D%E4%BD%9C"><span class="toc-number">8.3.</span> <span class="toc-text">3. scrapyæ•°æ®è§£ææ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%9F%BA%E4%BA%8E%E7%BB%88%E7%AB%AF%E6%8C%87%E4%BB%A4%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">8.4.</span> <span class="toc-text">4. åŸºäºç»ˆç«¯æŒ‡ä»¤çš„æŒä¹…åŒ–å­˜å‚¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E5%9F%BA%E4%BA%8E%E7%AE%A1%E9%81%93%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">8.5.</span> <span class="toc-text">5. åŸºäºç®¡é“æŒä¹…åŒ–å­˜å‚¨æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%A8%E7%AB%99%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96"><span class="toc-number">8.6.</span> <span class="toc-text">6. å…¨ç«™æ•°æ®çˆ¬å–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BA%94%E5%A4%A7%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">8.7.</span> <span class="toc-text">7. äº”å¤§æ ¸å¿ƒç»„ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E8%AF%B7%E6%B1%82%E4%BC%A0%E5%8F%82"><span class="toc-number">8.8.</span> <span class="toc-text">8. è¯·æ±‚ä¼ å‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-scrapy%E5%9B%BE%E7%89%87%E7%88%AC%E5%8F%96"><span class="toc-number">8.9.</span> <span class="toc-text">9. scrapyå›¾ç‰‡çˆ¬å–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">8.10.</span> <span class="toc-text">10. ä¸­é—´ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%BD%91%E6%98%93%E6%96%B0%E9%97%BB"><span class="toc-number">8.11.</span> <span class="toc-text">11. ç½‘æ˜“æ–°é—»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-CrawlSpider%E7%9A%84%E5%85%A8%E7%AB%99%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96"><span class="toc-number">8.12.</span> <span class="toc-text">12. CrawlSpiderçš„å…¨ç«™æ•°æ®çˆ¬å–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-%E5%88%86%E5%B8%83%E5%BC%8F%E6%A6%82%E8%BF%B0%E5%8F%8A%E6%90%AD%E5%BB%BA"><span class="toc-number">8.13.</span> <span class="toc-text">13. åˆ†å¸ƒå¼æ¦‚è¿°åŠæ­å»º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-%E5%A2%9E%E9%87%8F%E5%BC%8F%E7%88%AC%E8%99%AB"><span class="toc-number">8.14.</span> <span class="toc-text">14. å¢é‡å¼çˆ¬è™«</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E8%A1%A5%E5%85%85%E2%80%94%E2%80%94%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">9.</span> <span class="toc-text">ä¹ã€è¡¥å……â€”â€”å¼‚æ­¥ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8D%8F%E7%A8%8B"><span class="toc-number">9.1.</span> <span class="toc-text">1. åç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89greenlet%E5%AE%9E%E7%8E%B0%E5%8D%8F%E7%A8%8B"><span class="toc-number">9.1.1.</span> <span class="toc-text">ï¼ˆ1ï¼‰greenletå®ç°åç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89yield%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">9.1.2.</span> <span class="toc-text">ï¼ˆ2ï¼‰yieldå…³é”®å­—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89asyncio%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">9.1.3.</span> <span class="toc-text">ï¼ˆ3ï¼‰asyncioè£…é¥°å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89async%E3%80%81await%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="toc-number">9.1.4.</span> <span class="toc-text">ï¼ˆ4ï¼‰asyncã€awaitå…³é”®å­—ï¼ˆæ¨èï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8D%8F%E7%A8%8B%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">9.2.</span> <span class="toc-text">2. åç¨‹çš„æ„ä¹‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="toc-number">9.3.</span> <span class="toc-text">3. å¼‚æ­¥ç¼–ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="toc-number">9.3.1.</span> <span class="toc-text">ï¼ˆ1ï¼‰äº‹ä»¶å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B"><span class="toc-number">9.3.2.</span> <span class="toc-text">ï¼ˆ2ï¼‰å¿«é€Ÿä¸Šæ‰‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89await%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">9.3.3.</span> <span class="toc-text">ï¼ˆ3ï¼‰awaitå…³é”®å­—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89Task%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.3.4.</span> <span class="toc-text">ï¼ˆ4ï¼‰Taskå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89asyncio-Future%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.3.5.</span> <span class="toc-text">ï¼ˆ5ï¼‰asyncio.Futureå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%886%EF%BC%89concurrent-futures-Future%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.3.6.</span> <span class="toc-text">ï¼ˆ6ï¼‰concurrent.futures.Futureå¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%887%EF%BC%89%E6%A1%88%E4%BE%8B%EF%BC%9Aasyncio-%E4%B8%8D%E6%94%AF%E6%8C%81%E5%BC%82%E6%AD%A5%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="toc-number">9.3.7.</span> <span class="toc-text">ï¼ˆ7ï¼‰æ¡ˆä¾‹ï¼šasyncio + ä¸æ”¯æŒå¼‚æ­¥çš„æ¨¡å—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%888%EF%BC%89%E5%BC%82%E6%AD%A5%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">9.3.8.</span> <span class="toc-text">ï¼ˆ8ï¼‰å¼‚æ­¥è¿­ä»£å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%889%EF%BC%89%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">9.3.9.</span> <span class="toc-text">ï¼ˆ9ï¼‰å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-uvloop"><span class="toc-number">9.4.</span> <span class="toc-text">4. uvloop</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="toc-number">9.4.1.</span> <span class="toc-text">5. å®æˆ˜æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%BC%82%E6%AD%A5-redis"><span class="toc-number">9.4.2.</span> <span class="toc-text">ï¼ˆ1ï¼‰å¼‚æ­¥ redis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%BC%82%E6%AD%A5MySQL"><span class="toc-number">9.4.3.</span> <span class="toc-text">ï¼ˆ2ï¼‰å¼‚æ­¥MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%883%EF%BC%89FastAPI%E6%A1%86%E6%9E%B6"><span class="toc-number">9.4.4.</span> <span class="toc-text">ï¼ˆ3ï¼‰FastAPIæ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB"><span class="toc-number">9.4.5.</span> <span class="toc-text">ï¼ˆ4ï¼‰å¼‚æ­¥çˆ¬è™«</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/deepseekwin.html" title="DeepSeekç§äººçŸ¥è¯†"><img src="/img/%E5%BD%A9%E9%93%85%E7%94%BB%E5%8A%A8%E6%BC%AB%E5%A5%B3%E5%AD%A94k%E5%A3%81%E7%BA%B83840x2160_%E5%BD%BC%E5%B2%B8%E5%9B%BE%E7%BD%91.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DeepSeekç§äººçŸ¥è¯†"/></a><div class="content"><a class="title" href="/deepseekwin.html" title="DeepSeekç§äººçŸ¥è¯†">DeepSeekç§äººçŸ¥è¯†</a><time datetime="2026-01-04T07:40:42.000Z" title="å‘è¡¨äº 2026-01-04 15:40:42">2026-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/flipped.html" title="å¿ƒåŠ¨æ—¶åˆ»"><img src="/img/beauty_1722768765617.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¿ƒåŠ¨æ—¶åˆ»"/></a><div class="content"><a class="title" href="/flipped.html" title="å¿ƒåŠ¨æ—¶åˆ»">å¿ƒåŠ¨æ—¶åˆ»</a><time datetime="2025-10-25T08:23:36.000Z" title="å‘è¡¨äº 2025-10-25 16:23:36">2025-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/wyylovedsc.html" title="æœ€å¯çˆ±çš„äºº"><img src="/img/1c2ec7a13872109ace758abc35470c9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="æœ€å¯çˆ±çš„äºº"/></a><div class="content"><a class="title" href="/wyylovedsc.html" title="æœ€å¯çˆ±çš„äºº">æœ€å¯çˆ±çš„äºº</a><time datetime="2025-09-16T03:09:02.000Z" title="å‘è¡¨äº 2025-09-16 11:09:02">2025-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/cet6.html" title="CET6"><img src="https://cdn.jsdelivr.net/gh//Ysnsn/img@latest/2021/ç¾å¥³%20-%2028.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CET6"/></a><div class="content"><a class="title" href="/cet6.html" title="CET6">CET6</a><time datetime="2021-09-16T05:13:54.000Z" title="å‘è¡¨äº 2021-09-16 13:13:54">2021-09-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/python-spider.html" title="Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°"><img src="https://cdn.jsdelivr.net/gh/Ysnsn/img@latest/2021/wall.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°"/></a><div class="content"><a class="title" href="/python-spider.html" title="Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°">Pythonçˆ¬è™«å­¦ä¹ ç¬”è®°</a><time datetime="2021-07-24T05:13:54.000Z" title="å‘è¡¨äº 2021-07-24 13:13:54">2021-07-24</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By å¯çˆ±çš„Wyang</span><span class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 6.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2d_models/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2d_models/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"display":{"position":"left"},"mobile":{"show":false},"model":{"scale":1.2,"jsonPath":"/live2d_models/assets/weier.model.json"},"log":false});</script></body></html>